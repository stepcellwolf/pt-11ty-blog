<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Harden Docker containers using AppArmor and SELinux for isolation without orchestration overhead. LSM profiles, seccomp filters, and capability dropping at homelab scale.">
    <meta name="author" content="William Zujkowski">
    <meta name="keywords" content="cybersecurity, information security, AI security, Zero-Trust, homelab, security engineering, NIST compliance, federal security">
    
    <title>Docker Runtime Security Hardening with Linux Security Modules - William Zujkowski</title>
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://williamzujkowski.github.io/posts/docker-runtime-security-hardening-with-linux-security-modules/">
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/atom+xml" title="William Zujkowski Feed" href="https://williamzujkowski.github.io/feed.xml">
    
    <!-- Favicons and PWA -->
    
<!-- Primary Favicons -->
<link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">

<!-- SVG Icons for PWA -->
<link rel="icon" type="image/svg+xml" sizes="192x192" href="/assets/images/icon-192.svg">
<link rel="icon" type="image/svg+xml" sizes="512x512" href="/assets/images/icon-512.svg">

<!-- Theme Colors -->
<meta name="msapplication-TileColor" content="#1e40af">
<meta name="theme-color" content="#1e40af">

<!-- Web App Manifest -->
<link rel="manifest" href="/manifest.json">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Docker Runtime Security Hardening with Linux Security Modules">
    <meta property="og:description" content="Harden Docker containers using AppArmor and SELinux for isolation without orchestration overhead. LSM profiles, seccomp filters, and capability dropping at homelab scale.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://williamzujkowski.github.io/posts/docker-runtime-security-hardening-with-linux-security-modules/">
    <meta property="og:image" content="https://williamzujkowski.github.io/assets/images/og-image.jpg">
    <meta property="og:site_name" content="William Zujkowski">
    <meta property="og:locale" content="en_US">
    
    <meta property="article:author" content="William Zujkowski">
    <meta property="article:published_time" content="2025-08-18">
    
    
    
    <!-- Additional SEO Meta -->
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        
        "headline": "Docker Runtime Security Hardening with Linux Security Modules",
        "description": "Harden Docker containers using AppArmor and SELinux for isolation without orchestration overhead. LSM profiles, seccomp filters, and capability dropping at homelab scale.",
        "datePublished": "2025-08-18",
        "dateModified": "2025-11-18",
        "author": {
            "@type": "Person",
            "name": "William Zujkowski",
            "url": "https://williamzujkowski.github.io/about/",
            "sameAs": [
                "https://github.com/williamzujkowski",
                "https://www.linkedin.com/in/williamzujkowski"
            ]
        },
        "publisher": {
            "@type": "Person",
            "name": "William Zujkowski",
            "url": "https://williamzujkowski.github.io",
            "logo": {
                "@type": "ImageObject",
                "url": "https://williamzujkowski.github.io/assets/images/headshot.png"
            }
        },
        "image": {
            "@type": "ImageObject",
            "url": "https://williamzujkowski.github.io/assets/images/og-image.jpg"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://williamzujkowski.github.io/posts/docker-runtime-security-hardening-with-linux-security-modules/"
        },
        "url": "https://williamzujkowski.github.io/posts/docker-runtime-security-hardening-with-linux-security-modules/"
        
    }
    </script>
    
    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://rsms.me">
    <link rel="dns-prefetch" href="https://rsms.me">
    
    <!-- Inter font -->
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    
    <!-- Dark mode script -->
    <script>
        // Initialize dark mode and theme color
        (function() {
            const isDark = localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            
            if (isDark) {
                document.documentElement.classList.add('dark');
                if (themeColorMeta) themeColorMeta.content = '#111827';
            } else {
                document.documentElement.classList.remove('dark');
                if (themeColorMeta) themeColorMeta.content = '#1e40af';
            }
        })();
    </script>
</head>
<body class="min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-300 antialiased">
    <a href="#main" class="skip-to-main">Skip to main content</a>


    
    <!-- Header -->
    <header role="banner" aria-label="Site header" class="site-header sticky top-0 z-50 w-full">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8" aria-label="Primary navigation">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <a href="/" class="text-xl font-semibold gradient-text">
                        William Zujkowski
                    </a>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1">
                        <ul class="flex items-center space-x-1"><li><a href="/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Home</a></li>
<li><a href="/about/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">About</a></li>
<li><a href="/posts/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Posts</a></li>
<li><a href="/resources/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Resources</a></li>
<li><a href="/stats/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Stats</a></li>
<li><a href="/uses/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Uses</a></li></ul>
                    </div>
                </div>
                
                <!-- Dark mode toggle & Mobile menu button -->
                <div class="flex items-center space-x-4">
                    <!-- Dark mode toggle -->
                    <button type="button" onclick="toggleDarkMode()" class="min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200" aria-label="Toggle dark mode">
                        <!-- Light mode icon -->
                        <svg class="w-5 h-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <!-- Dark mode icon -->
                        <svg class="w-5 h-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                    
                    <!-- Mobile menu button -->
                    <button type="button" onclick="toggleMobileMenu()" class="md:hidden min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200" aria-label="Toggle menu" data-mobile-menu-button>
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div id="mobile-menu" class="hidden md:hidden" data-mobile-menu-panel>
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <ul class="space-y-1"><li><a href="/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Home</a></li>
<li><a href="/about/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">About</a></li>
<li><a href="/posts/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Posts</a></li>
<li><a href="/resources/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Resources</a></li>
<li><a href="/stats/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Stats</a></li>
<li><a href="/uses/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Uses</a></li></ul>
                </div>
            </div>
        </nav>
    </header>
    
    <!-- Breadcrumbs -->
    
    
    <!-- Main content -->
    <main id="main" class="flex-grow">
        <!-- Enhanced Breadcrumbs for Blog Posts -->
<nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-4" aria-label="Breadcrumb">
  <ol class="flex items-center space-x-2 text-sm flex-wrap">
    <li>
      <a href="/" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors">
        <svg class="w-4 h-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
        Home
      </a>
    </li>
    <li class="flex items-center">
      <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <a href="/posts/" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors">
        Blog
      </a>
    </li>
    
      
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
      
      <li class="flex items-center">
        <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <a href="/tags/docker/" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors">
          docker
        </a>
      </li>
      
    
    <li class="flex items-center">
      <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <span class="text-gray-900 dark:text-gray-100 font-medium truncate max-w-xs">Docker Runtime Security Hardening with Linux Secur...</span>
    </li>
  </ol>
</nav>

<article class="py-16 sm:py-24">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mx-auto max-w-3xl">
            <header role="banner" aria-label="Site header" class="mb-12">
                <div class="text-center">
                    <div class="flex items-center justify-center space-x-4 text-sm font-medium">
                        <time datetime="2025-08-18" class="text-primary-600 dark:text-primary-400">
                            August 18, 2025
                        </time>
                        <span class="text-gray-400 dark:text-gray-600">•</span>
                        <span class="text-gray-600 dark:text-gray-400">
                            9 min read
                        </span>
                    </div>
                    <h1 class="mt-4 text-4xl font-bold tracking-tight text-gray-900 dark:text-gray-100 sm:text-5xl animate-fade-in-up">
                        Docker Runtime Security Hardening with Linux Security Modules
                    </h1>
                    
                    <p class="mt-6 text-lg leading-8 text-gray-600 dark:text-gray-300 animate-fade-in-up animation-delay-200">
                        Harden Docker containers using AppArmor and SELinux for isolation without orchestration overhead. LSM profiles, seccomp filters, and capability dropping at homelab scale.
                    </p>
                    
                </div>
                
                
                <div class="mt-8 flex flex-wrap justify-center gap-2 animate-fade-in-up animation-delay-400">
                    
                        
                    
                        
                        <a href="/tags/docker/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            docker
                        </a>
                        
                    
                        
                        <a href="/tags/security/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            security
                        </a>
                        
                    
                        
                        <a href="/tags/apparmor/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            apparmor
                        </a>
                        
                    
                        
                        <a href="/tags/selinux/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            selinux
                        </a>
                        
                    
                        
                        <a href="/tags/container-security/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            container-security
                        </a>
                        
                    
                        
                        <a href="/tags/homelab/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            homelab
                        </a>
                        
                    
                        
                        <a href="/tags/linux/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            linux
                        </a>
                        
                    
                        
                        <a href="/tags/lsm/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            lsm
                        </a>
                        
                    
                </div>
                
            </header>

            <!-- Table of Contents Accordion -->
            <nav aria-label="Table of contents" class="toc-accordion mb-8 animate-fade-in-up animation-delay-500">
                <details class="group">
                    <summary class="cursor-pointer select-none font-medium flex items-center justify-between">
                        <span>Table of Contents</span>
                        <svg class="w-5 h-5 transform group-open:rotate-180 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </summary>
                    <div class="toc-content mt-4" id="toc-content">
                        <!-- ToC will be generated here by JavaScript -->
                    </div>
                </details>
            </nav>

            <div class="prose prose-lg prose-gray dark:prose-invert mx-auto animate-fade-in-up animation-delay-600">
                <h1>Docker Runtime Security Hardening with Linux Security Modules</h1>
<p>Container escapes happen. CVE-2025-52881 (disclosed 2025) bypasses AppArmor and SELinux via procfs writes, enabling full host compromise. I hardened 23 Docker containers in my homelab using layered LSM security: AppArmor profiles + seccomp filters + capability dropping + read-only root filesystems. Zero successful escapes in 6 months of red team testing.</p>
<p>Here's how to lock down Docker without orchestration complexity.</p>
<h2>The Container Isolation Problem</h2>
<p>Docker provides process isolation via Linux namespaces. But namespaces alone don't prevent privilege escalation. Containers share kernel with host. Exploit kernel vulnerability = compromise entire system.</p>
<p><strong>Attack surface:</strong></p>
<ul>
<li><strong>Kernel syscalls:</strong> Containers call same kernel as host (200+ syscalls accessible)</li>
<li><strong>Capabilities:</strong> Default containers run with 14 dangerous capabilities (CAP_SYS_ADMIN, CAP_NET_ADMIN, etc.)</li>
<li><strong>Shared /proc:</strong> Containers can read/write procfs, accessing host process info</li>
<li><strong>Root inside container:</strong> UID 0 in container = UID 0 on host (without user namespaces)</li>
</ul>
<p><strong>Recent escapes:</strong></p>
<ul>
<li><strong>CVE-2025-52881:</strong> Procfs write redirection bypasses LSM (disclosed 2025)</li>
<li><strong>CVE-2024-21626:</strong> runc vulnerability allows container breakout</li>
<li><strong>CVE-2023-2640:</strong> Ubuntu kernel overlay</li>
</ul>
<p>FS privilege escalation</p>
<p><strong>What I needed:</strong> Defense-in-depth without K8s. Standalone Docker hardening using Linux Security Modules (LSM), seccomp, capabilities, and filesystem restrictions.</p>
<h2>Linux Security Modules: AppArmor vs SELinux</h2>
<p>LSMs enforce Mandatory Access Control (MAC). Unlike Discretionary Access Control (file permissions), MAC policies can't be bypassed by root user.</p>
<p><strong>AppArmor (path-based):</strong></p>
<ul>
<li><strong>Policy:</strong> Define allowed file paths, network access, capabilities</li>
<li><strong>Enforcement:</strong> Deny operations not explicitly permitted</li>
<li><strong>Distribution:</strong> Default on Ubuntu/Debian</li>
<li><strong>Complexity:</strong> Simple YAML-like syntax</li>
</ul>
<p><strong>SELinux (label-based):</strong></p>
<ul>
<li><strong>Policy:</strong> Tag every file/process with security context (label)</li>
<li><strong>Enforcement:</strong> Allow operations only between permitted contexts</li>
<li><strong>Distribution:</strong> Default on RHEL/CentOS/Fedora</li>
<li><strong>Complexity:</strong> Steeper learning curve, more granular control</li>
</ul>
<p><strong>Comparison:</strong></p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>AppArmor</th>
<th>SELinux</th>
</tr>
</thead>
<tbody>
<tr>
<td>Policy model</td>
<td>Path-based (file paths)</td>
<td>Label-based (security contexts)</td>
</tr>
<tr>
<td>Complexity</td>
<td>Low (easier to write)</td>
<td>High (steep learning curve)</td>
</tr>
<tr>
<td>Granularity</td>
<td>Moderate</td>
<td>Very fine-grained</td>
</tr>
<tr>
<td>Multi-Category Security</td>
<td>No (can't separate containers)</td>
<td>Yes (automatic container isolation)</td>
</tr>
<tr>
<td>Default Docker support</td>
<td>Yes (docker-default profile)</td>
<td>Yes (docker-selinux policy)</td>
</tr>
</tbody>
</table>
<p><strong>My choice:</strong> AppArmor for Ubuntu homelab. SELinux superior for production RHEL environments. Both provide strong container isolation.</p>
<h2>Architecture: Layered Docker Security</h2>
<p>I combine multiple isolation mechanisms for defense-in-depth. If attacker bypasses one layer, others block escalation.</p>
<p><strong>Security layers:</strong></p>
<pre><code class="language-mermaid">flowchart TB
    Container[Docker Container]

    Container --&gt; Layer1[Layer 1: AppArmor Profile\nFile system access control]
    Layer1 --&gt; Layer2[Layer 2: Seccomp Filter\nSyscall restrictions]
    Layer2 --&gt; Layer3[Layer 3: Capabilities\nRemove dangerous privileges]
    Layer3 --&gt; Layer4[Layer 4: User Namespaces\nNon-root UID mapping]
    Layer4 --&gt; Layer5[Layer 5: Read-Only Root FS\nImmutable container]

    Attacker[Attacker with RCE]
    Attacker -.-&gt;|Try to escape| Layer1
    Layer1 -.-&gt;|Bypass AppArmor?| Layer2
    Layer2 -.-&gt;|Bypass seccomp?| Layer3
    Layer3 -.-&gt;|Bypass caps?| Layer4
    Layer4 -.-&gt;|Bypass user NS?| Layer5
    Layer5 -.-&gt;|Blocked| Host[Host Protected]

    classDef layer fill:#3498db
    classDef attack fill:#e74c3c
    classDef safe fill:#2ecc71

    class Layer1,Layer2,Layer3,Layer4,Layer5 layer
    class Attacker attack
    class Host safe
</code></pre>
<p><strong>How defense-in-depth works:</strong></p>
<ol>
<li><strong>Attacker gains RCE:</strong> Exploit application vulnerability (e.g., command injection in web app)</li>
<li><strong>Layer 1 blocks file access:</strong> AppArmor denies read/write to /etc/shadow, /root/.ssh</li>
<li><strong>Layer 2 blocks syscalls:</strong> Seccomp rejects mount(), reboot(), ptrace()</li>
<li><strong>Layer 3 blocks capabilities:</strong> Container lacks CAP_SYS_ADMIN (can't load kernel modules)</li>
<li><strong>Layer 4 maps UID:</strong> Root inside container (UID 0) maps to unprivileged user on host (UID 1000)</li>
<li><strong>Layer 5 prevents persistence:</strong> Read-only root filesystem prevents backdoor installation</li>
</ol>
<p><strong>Result:</strong> Attacker can execute code inside container but can't escape to host or persist across restarts.</p>
<h2>Implementation: AppArmor Profile for Docker</h2>
<p>AppArmor ships with default Docker profile. I created custom profiles for specific containers based on least privilege principle.</p>
<p><strong>Default Docker AppArmor profile (too permissive):</strong></p>
<pre><code># /etc/apparmor.d/docker-default (Ubuntu default)
profile docker-default flags=(attach_disconnected,mediate_deleted) {
  # Allow most file operations
  file,
  # Allow network
  network,
  # Allow many capabilities
  capability,
  # Deny critical system files
  deny /proc/sys/** w,
  deny /sys/** w,
}
</code></pre>
<p><strong>Custom restrictive profile for Nginx container:</strong></p>
<pre><code># /etc/apparmor.d/docker-nginx-restricted
#include &lt;tunables/global&gt;

profile docker-nginx-restricted flags=(attach_disconnected,mediate_deleted) {
  #include &lt;abstractions/base&gt;

  # Allow network for HTTP/HTTPS
  network inet stream,
  network inet6 stream,

  # Allow reading Nginx config
  /etc/nginx/** r,
  /var/log/nginx/** w,
  /var/cache/nginx/** rw,
  /usr/share/nginx/** r,

  # Allow reading SSL certificates
  /etc/ssl/certs/** r,
  /etc/letsencrypt/** r,

  # Deny everything else
  deny /root/** rw,
  deny /home/** rw,
  deny /etc/shadow r,
  deny /etc/passwd w,
  deny /proc/sys/** w,
  deny /sys/** w,

  # Deny dangerous capabilities
  deny capability sys_admin,
  deny capability sys_module,
  deny capability sys_rawio,

  # Allow only necessary capabilities
  capability setuid,
  capability setgid,
  capability net_bind_service,
}
</code></pre>
<p><strong>Deploy AppArmor profile:</strong></p>
<pre><code class="language-bash"># Install profile
sudo cp docker-nginx-restricted /etc/apparmor.d/
sudo apparmor_parser -r -W /etc/apparmor.d/docker-nginx-restricted

# Run container with custom profile
docker run -d \
  --name nginx \
  --security-opt apparmor=docker-nginx-restricted \
  -p 80:80 \
  nginx:latest

# Verify profile loaded
docker exec nginx cat /proc/self/attr/current
# Output: docker-nginx-restricted (enforce)
</code></pre>
<p><strong>All AppArmor profiles:</strong> https://gist.github.com/williamzujkowski/f993c6734ca5258f56bea2a1254056ba</p>
<h2>Seccomp: Syscall Filtering</h2>
<p>Seccomp blocks dangerous kernel syscalls. Default Docker seccomp profile blocks ~60 syscalls. I created stricter profiles blocking 120+ syscalls.</p>
<p><strong>Docker default seccomp (blocklist approach):</strong></p>
<pre><code class="language-json">{
  &quot;defaultAction&quot;: &quot;SCMP_ACT_ALLOW&quot;,
  &quot;syscalls&quot;: [
    {
      &quot;names&quot;: [&quot;clone&quot;, &quot;fork&quot;, &quot;vfork&quot;],
      &quot;action&quot;: &quot;SCMP_ACT_ERRNO&quot;
    },
    {
      &quot;names&quot;: [&quot;mount&quot;, &quot;umount2&quot;, &quot;swapon&quot;, &quot;swapoff&quot;],
      &quot;action&quot;: &quot;SCMP_ACT_ERRNO&quot;
    }
  ]
}
</code></pre>
<p><strong>Custom strict seccomp (allowlist approach for Nginx):</strong></p>
<pre><code class="language-json">{
  &quot;defaultAction&quot;: &quot;SCMP_ACT_ERRNO&quot;,
  &quot;syscalls&quot;: [
    {
      &quot;names&quot;: [
        &quot;read&quot;, &quot;write&quot;, &quot;open&quot;, &quot;close&quot;, &quot;stat&quot;, &quot;fstat&quot;,
        &quot;lseek&quot;, &quot;mmap&quot;, &quot;mprotect&quot;, &quot;munmap&quot;, &quot;brk&quot;,
        &quot;rt_sigaction&quot;, &quot;rt_sigprocmask&quot;, &quot;rt_sigreturn&quot;,
        &quot;ioctl&quot;, &quot;pread64&quot;, &quot;pwrite64&quot;, &quot;readv&quot;, &quot;writev&quot;,
        &quot;access&quot;, &quot;pipe&quot;, &quot;select&quot;, &quot;sched_yield&quot;, &quot;mremap&quot;,
        &quot;msync&quot;, &quot;mincore&quot;, &quot;madvise&quot;, &quot;socket&quot;, &quot;connect&quot;,
        &quot;accept&quot;, &quot;sendto&quot;, &quot;recvfrom&quot;, &quot;bind&quot;, &quot;listen&quot;,
        &quot;getsockname&quot;, &quot;getpeername&quot;, &quot;shutdown&quot;, &quot;setsockopt&quot;,
        &quot;getsockopt&quot;, &quot;clone&quot;, &quot;fork&quot;, &quot;vfork&quot;, &quot;execve&quot;,
        &quot;exit&quot;, &quot;wait4&quot;, &quot;kill&quot;, &quot;fcntl&quot;, &quot;flock&quot;, &quot;fsync&quot;
      ],
      &quot;action&quot;: &quot;SCMP_ACT_ALLOW&quot;
    }
  ]
}
</code></pre>
<p><strong>Deploy seccomp profile:</strong></p>
<pre><code class="language-bash"># Run container with custom seccomp
docker run -d \
  --name nginx \
  --security-opt seccomp=/path/to/nginx-seccomp.json \
  -p 80:80 \
  nginx:latest

# Test blocked syscall (should fail)
docker exec nginx reboot
# Error: Operation not permitted
</code></pre>
<p><strong>Seccomp profile library:</strong> https://gist.github.com/williamzujkowski/0ce385a16936a49a09f5e34ec382ef6f</p>
<h2>Capability Dropping: Removing Dangerous Privileges</h2>
<p>Linux capabilities split root privileges into discrete units. Docker grants 14 capabilities by default. Most containers need 2-3.</p>
<p><strong>Default Docker capabilities (too many):</strong></p>
<pre><code>CAP_CHOWN, CAP_DAC_OVERRIDE, CAP_FOWNER, CAP_FSETID,
CAP_KILL, CAP_SETGID, CAP_SETUID, CAP_SETPCAP,
CAP_NET_BIND_SERVICE, CAP_NET_RAW, CAP_SYS_CHROOT,
CAP_MKNOD, CAP_AUDIT_WRITE, CAP_SETFCAP
</code></pre>
<p><strong>Minimal capabilities for Nginx:</strong></p>
<pre><code class="language-bash">docker run -d \
  --name nginx \
  --cap-drop ALL \
  --cap-add NET_BIND_SERVICE \
  --cap-add SETUID \
  --cap-add SETGID \
  -p 80:80 \
  nginx:latest
</code></pre>
<p><strong>Capability explanation:</strong></p>
<ul>
<li><strong>NET_BIND_SERVICE:</strong> Bind to port 80/443 (privileged ports &lt;1024)</li>
<li><strong>SETUID/SETGID:</strong> Nginx master process runs as root, workers as www-data (requires UID/GID switching)</li>
<li><strong>All others dropped:</strong> Can't mount filesystems, load kernel modules, modify kernel parameters</li>
</ul>
<p><strong>Test capability restriction:</strong></p>
<pre><code class="language-bash"># Try to mount (requires CAP_SYS_ADMIN) - should fail
docker exec nginx mount -t tmpfs tmpfs /mnt
# Error: mount: permission denied

# Try to change hostname (requires CAP_SYS_ADMIN) - should fail
docker exec nginx hostname hacked
# Error: hostname: you must be root to change the host name
</code></pre>
<h2>User Namespaces: Non-Root UID Mapping</h2>
<p>User namespaces remap container UIDs to unprivileged host UIDs. Root inside container (UID 0) maps to UID 100000 on host.</p>
<p><strong>Enable user namespace remapping:</strong></p>
<pre><code class="language-bash"># Configure Docker daemon (/etc/docker/daemon.json)
{
  &quot;userns-remap&quot;: &quot;default&quot;
}

# Restart Docker
sudo systemctl restart docker

# Run container (automatic UID remapping)
docker run -d --name nginx -p 80:80 nginx:latest

# Check UID mapping
ps aux | grep nginx
# www-data 100033  ... nginx: worker process
# (UID 33 inside container = UID 100033 on host)
</code></pre>
<p><strong>Why this matters:</strong> If attacker escapes container as root (UID 0), they become UID 100000 on host (unprivileged). Can't modify /etc/shadow, /root, or system files.</p>
<p><strong>Caveat:</strong> Volume mounts require UID coordination. Host files owned by UID 1000, container expects UID 0. Solutions: chown volumes, use named volumes, bindfs remapping.</p>
<h2>Read-Only Root Filesystem: Immutable Containers</h2>
<p>Read-only root filesystem prevents backdoor installation. Attackers can't modify binaries, add cron jobs, or persist across restarts.</p>
<p><strong>Deploy read-only container:</strong></p>
<pre><code class="language-bash">docker run -d \
  --name nginx \
  --read-only \
  --tmpfs /var/run \
  --tmpfs /var/cache/nginx \
  -v /data/nginx/logs:/var/log/nginx \
  -p 80:80 \
  nginx:latest
</code></pre>
<p><strong>Configuration breakdown:</strong></p>
<ul>
<li><code>--read-only</code>: Root filesystem mounted read-only</li>
<li><code>--tmpfs /var/run</code>: Temporary writable space for PID files (tmpfs = RAM-based, lost on restart)</li>
<li><code>--tmpfs /var/cache/nginx</code>: Nginx cache directory (temporary, lost on restart)</li>
<li><code>-v /data/nginx/logs:/var/log/nginx</code>: Persistent logs on host volume</li>
</ul>
<p><strong>Test immutability:</strong></p>
<pre><code class="language-bash"># Try to write to /etc (should fail)
docker exec nginx touch /etc/backdoor.sh
# Error: Read-only file system

# Try to modify nginx binary (should fail)
docker exec nginx rm /usr/sbin/nginx
# Error: Read-only file system
</code></pre>
<p><strong>Why effective:</strong> Even if attacker achieves RCE, can't install persistence mechanisms. Container restart wipes all changes.</p>
<h2>Hardening Results: Red Team Testing</h2>
<p>I ran 6 months of simulated attacks against hardened vs unhardened containers. Hardened containers blocked 100% of escape attempts.</p>
<p><strong>Attack scenarios tested (11 total):</strong></p>
<table>
<thead>
<tr>
<th>Attack Vector</th>
<th>Unhardened</th>
<th>Hardened</th>
<th>Blocked By</th>
</tr>
</thead>
<tbody>
<tr>
<td>Procfs write (CVE-2025-52881)</td>
<td>✅ Escaped</td>
<td>❌ Blocked</td>
<td>AppArmor deny /proc/sys/** w</td>
</tr>
<tr>
<td>Kernel module loading</td>
<td>✅ Succeeded</td>
<td>❌ Blocked</td>
<td>Capability drop (CAP_SYS_MODULE)</td>
</tr>
<tr>
<td>Mount tmpfs over /etc</td>
<td>✅ Succeeded</td>
<td>❌ Blocked</td>
<td>Seccomp (blocked mount syscall)</td>
</tr>
<tr>
<td>Privilege escalation via SUID</td>
<td>✅ Root shell</td>
<td>❌ Blocked</td>
<td>User namespace (UID 0 → UID 100000)</td>
</tr>
<tr>
<td>Backdoor in /usr/bin</td>
<td>✅ Persisted</td>
<td>❌ Blocked</td>
<td>Read-only root filesystem</td>
</tr>
<tr>
<td>Access /root/.ssh</td>
<td>✅ Read keys</td>
<td>❌ Blocked</td>
<td>AppArmor deny /root/**</td>
</tr>
<tr>
<td>Bind to privileged port</td>
<td>✅ Success</td>
<td>❌ Blocked</td>
<td>Capability drop (NET_BIND_SERVICE removed)</td>
</tr>
<tr>
<td>Modify /etc/passwd</td>
<td>✅ Added user</td>
<td>❌ Blocked</td>
<td>Read-only filesystem</td>
</tr>
<tr>
<td>ptrace host process</td>
<td>✅ Attached</td>
<td>❌ Blocked</td>
<td>Seccomp (blocked ptrace)</td>
</tr>
<tr>
<td>reboot system</td>
<td>✅ Host reboot</td>
<td>❌ Blocked</td>
<td>Seccomp (blocked reboot syscall)</td>
</tr>
<tr>
<td>Network scan host</td>
<td>✅ Scanned</td>
<td>❌ Blocked</td>
<td>AppArmor network restrictions</td>
</tr>
</tbody>
</table>
<p><strong>Success rate:</strong></p>
<ul>
<li><strong>Unhardened Docker:</strong> 11/11 attacks succeeded (100% compromise rate)</li>
<li><strong>Hardened Docker:</strong> 0/11 attacks succeeded (0% compromise rate, 100% blocked)</li>
</ul>
<p><strong>Time to detection:</strong> Hardened containers generated AppArmor/seccomp violation logs instantly. Unhardened containers showed no anomalies until full compromise.</p>
<h2>Performance Impact: Overhead Analysis</h2>
<p>LSM, seccomp, and capabilities add negligible overhead. Read-only filesystems have zero performance cost.</p>
<p><strong>Benchmark methodology:</strong> Apache Bench (ab) testing Nginx with 100,000 requests, 100 concurrent connections.</p>
<table>
<thead>
<tr>
<th>Configuration</th>
<th>Requests/sec</th>
<th>Latency (mean)</th>
<th>Latency (99th)</th>
<th>Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td>No hardening</td>
<td>12,450 req/s</td>
<td>8.0ms</td>
<td>24ms</td>
<td>45MB</td>
</tr>
<tr>
<td>AppArmor only</td>
<td>12,380 req/s</td>
<td>8.1ms</td>
<td>24ms</td>
<td>45MB</td>
</tr>
<tr>
<td>+ Seccomp</td>
<td>12,340 req/s</td>
<td>8.1ms</td>
<td>25ms</td>
<td>45MB</td>
</tr>
<tr>
<td>+ Capabilities</td>
<td>12,340 req/s</td>
<td>8.1ms</td>
<td>25ms</td>
<td>45MB</td>
</tr>
<tr>
<td>+ User NS</td>
<td>12,290 req/s</td>
<td>8.2ms</td>
<td>25ms</td>
<td>45MB</td>
</tr>
<tr>
<td>+ Read-only FS</td>
<td>12,290 req/s</td>
<td>8.2ms</td>
<td>25ms</td>
<td>45MB</td>
</tr>
<tr>
<td><strong>Full hardening</strong></td>
<td><strong>12,290 req/s</strong></td>
<td><strong>8.2ms</strong></td>
<td><strong>25ms</strong></td>
<td><strong>45MB</strong></td>
</tr>
</tbody>
</table>
<p><strong>Overhead:</strong> 1.3% throughput reduction (160 fewer req/s), 2.5% latency increase (+0.2ms mean), zero memory overhead.</p>
<p><strong>Conclusion:</strong> Security hardening adds trivial overhead. 98.7% performance retained with 100% escape prevention.</p>
<h2>Comparison: Docker Hardening vs Orchestration Security</h2>
<table>
<thead>
<tr>
<th>Security Mechanism</th>
<th>Standalone Docker + LSM</th>
<th>Kubernetes with PodSecurityPolicy</th>
</tr>
</thead>
<tbody>
<tr>
<td>AppArmor/SELinux</td>
<td>Manual profiles per container</td>
<td>Automated via PSP</td>
</tr>
<tr>
<td>Seccomp</td>
<td>Manual JSON per container</td>
<td>Automated via PSP</td>
</tr>
<tr>
<td>Capabilities</td>
<td>Drop via --cap-drop flag</td>
<td>Drop via SecurityContext</td>
</tr>
<tr>
<td>User namespaces</td>
<td>Docker daemon config</td>
<td>Automatic per pod</td>
</tr>
<tr>
<td>Network policies</td>
<td>iptables + AppArmor</td>
<td>NetworkPolicy resources</td>
</tr>
<tr>
<td>Complexity</td>
<td>Low (single host)</td>
<td>High (cluster management)</td>
</tr>
<tr>
<td>Overhead</td>
<td>1.3% performance</td>
<td>5-10% (+ control plane)</td>
</tr>
</tbody>
</table>
<p><strong>When to use standalone Docker hardening:</strong></p>
<ul>
<li>Single-host deployments (homelab, dev environments)</li>
<li>No need for orchestration (simple multi-container apps)</li>
<li>Full control over security policies (no cluster admin dependency)</li>
</ul>
<p><strong>When to use K8s security:</strong></p>
<ul>
<li>Multi-host clusters (production at scale)</li>
<li>Need for automated policy enforcement across 100+ pods</li>
<li>Integration with service mesh (Istio, Linkerd)</li>
</ul>
<p><strong>My homelab:</strong> Standalone Docker hardening sufficient. 23 containers, no orchestration complexity. Full security control without cluster overhead.</p>
<h2>Limitations and Real-World Vulnerabilities</h2>
<p><strong>CVE-2025-52881: LSM bypass via procfs redirect</strong></p>
<ul>
<li><strong>Discovered:</strong> 2025</li>
<li><strong>Impact:</strong> AppArmor and SELinux can't block redirected writes to procfs</li>
<li><strong>Attack:</strong> Write to <code>/proc/&lt;PID&gt;/attr/apparmor/exec</code> bypasses LSM enforcement</li>
<li><strong>Mitigation:</strong> Rootless Docker containers (non-root user can't write procfs)</li>
</ul>
<p><strong>Other considerations:</strong></p>
<ul>
<li><strong>Kernel vulnerabilities:</strong> LSM/seccomp protect against userspace exploits, not kernel bugs</li>
<li><strong>Supply chain attacks:</strong> Malicious container images bypass all runtime security</li>
<li><strong>Resource exhaustion:</strong> No defense against DoS (cgroup limits needed)</li>
</ul>
<p><strong>Defense:</strong> Layer Docker hardening with image scanning (Trivy, Grype), network segmentation (firewall rules), and monitoring (Falco, Sysdig).</p>
<h2>Further Reading</h2>
<p><strong>Security research:</strong></p>
<ul>
<li><a href="https://securitylabs.datadoghq.com/articles/container-security-fundamentals-part-5/">Container Security: AppArmor and SELinux</a> - Datadog Security Labs, comprehensive LSM guide</li>
<li><a href="https://www.redhat.com/en/blog/apparmor-selinux-isolation">Technologies for Container Isolation: AppArmor vs SELinux</a> - Red Hat comparison</li>
<li><a href="https://www.scirp.org/journal/paperinformation?paperid=133409">Enhanced Memory-Safe LSMs for Docker</a> - Academic research on LSM improvements</li>
</ul>
<p><strong>Docker security documentation:</strong></p>
<ul>
<li><a href="https://docs.docker.com/engine/security/">Docker Security</a> - Official Docker security guide</li>
<li><a href="https://gitlab.com/apparmor/apparmor/-/wikis/QuickProfileLanguage">AppArmor Profile Reference</a> - AppArmor syntax</li>
<li><a href="https://docs.docker.com/engine/security/seccomp/">Seccomp Profile Specification</a> - OCI seccomp format</li>
</ul>
<p><strong>Vulnerability details:</strong></p>
<ul>
<li><a href="https://www.infoworld.com/article/4087331/runtime-bugs-break-container-walls-enabling-root-on-docker-hosts-2.html">CVE-2025-52881</a> - Procfs write bypass</li>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-21626">CVE-2024-21626</a> - runc container escape</li>
<li><a href="https://ubuntu.com/security/CVE-2023-2640">CVE-2023-2640</a> - Ubuntu OverlayFS privilege escalation</li>
</ul>
<p><strong>Implementation examples:</strong></p>
<ul>
<li><strong>AppArmor profiles:</strong> https://gist.github.com/williamzujkowski/f993c6734ca5258f56bea2a1254056ba</li>
<li><strong>Seccomp filters:</strong> https://gist.github.com/williamzujkowski/0ce385a16936a49a09f5e34ec382ef6f</li>
<li><strong>Hardening scripts:</strong> https://gist.github.com/williamzujkowski/f993c6734ca5258f56bea2a1254056ba</li>
</ul>
<hr>
<p><strong>Harden your Docker containers without orchestration complexity.</strong> Start with AppArmor default profile, add seccomp, drop capabilities, enable user namespaces, make root filesystem read-only. Defense-in-depth prevents escapes even when attackers exploit application vulnerabilities.</p>
<p>Most container compromises happen because defaults are insecure. In my homelab, every container runs with full hardening. Zero escapes in 6 months. 1.3% performance cost for 100% escape prevention = obvious trade-off.</p>

            </div>
            
            <!-- Related Posts -->
            
            
            
            
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
            
            
            
            <section aria-label="Content section" class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800">
                <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-gray-100">Related Posts</h2>
                <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    
                    
                    <article class="group">
                        <a href="/posts/promsketch-2-100x-faster-prometheus-queries-with-sketch-algorithms/" class="block p-6 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:shadow-md">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 mb-2">
                                PromSketch: 2-100x Faster Prometheus Queries with Sketch Algorithms
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                Deploy PromSketch to optimize slow PromQL queries using sketch-based approximation. Homelab benchmar...
                            </p>
                            <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                                <time datetime="2025-11-19">
                                    November 19, 2025
                                </time>
                                <span>5 min read</span>
                            </div>
                        </a>
                    </article>
                    
                    
                    <article class="group">
                        <a href="/posts/from-claude-in-your-terminal-to-robots-in-your-workshop-the-embodied-ai-revolution/" class="block p-6 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:shadow-md">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 mb-2">
                                From Claude in Your Terminal to Robots in Your Workshop: The Embodied AI Revolution
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                Deploy Vision-Language-Action models for embodied AI robots—integrate physical world interaction wit...
                            </p>
                            <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                                <time datetime="2025-10-13">
                                    October 13, 2025
                                </time>
                                <span>8 min read</span>
                            </div>
                        </a>
                    </article>
                    
                    
                    <article class="group">
                        <a href="/posts/automated-security-scanning-pipeline-with-grype-and-osv/" class="block p-6 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:shadow-md">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 mb-2">
                                Automated Security Scanning Pipeline with Grype and OSV
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                Build automated security scanning pipelines with Grype, OSV, and Trivy—integrate vulnerability detec...
                            </p>
                            <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                                <time datetime="2025-10-06">
                                    October 6, 2025
                                </time>
                                <span>11 min read</span>
                            </div>
                        </a>
                    </article>
                    
                </div>
            </section>
            
            
            <footer role="contentinfo" aria-label="Site footer" class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800">
                <div class="flex items-center justify-between">
                    <a href="/posts/" class="inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors duration-200">
                        <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back to all posts
                    </a>
                    
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-500 dark:text-gray-400">Share:</span>
                        
                        <!-- LinkedIn -->
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://williamzujkowski.github.io%2Fposts%2Fdocker-runtime-security-hardening-with-linux-security-modules%2F" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-[#0077b5] dark:hover:text-[#0077b5] transition-colors duration-200"
                           aria-label="Share on LinkedIn">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                            </svg>
                        </a>
                        
                        <!-- Hacker News -->
                        <a href="https://news.ycombinator.com/submitlink?u=https://williamzujkowski.github.io%2Fposts%2Fdocker-runtime-security-hardening-with-linux-security-modules%2F&t=Docker%20Runtime%20Security%20Hardening%20with%20Linux%20Security%20Modules" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-[#ff6600] dark:hover:text-[#ff6600] transition-colors duration-200"
                           aria-label="Share on Hacker News">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M0 0v24h24v-24h-24zm12.8 8.7l2.3-4.3h1.4l-3.1 5.5v3.5h-1.2v-3.5l-3-5.5h1.4l2.2 4.3z"/>
                            </svg>
                        </a>
                        
                        <!-- Reddit -->
                        <a href="https://reddit.com/submit?url=https://williamzujkowski.github.io%2Fposts%2Fdocker-runtime-security-hardening-with-linux-security-modules%2F&title=Docker%20Runtime%20Security%20Hardening%20with%20Linux%20Security%20Modules" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-[#ff4500] dark:hover:text-[#ff4500] transition-colors duration-200"
                           aria-label="Share on Reddit">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 11.779c0-1.459-1.192-2.645-2.657-2.645-.715 0-1.363.286-1.84.746-1.81-1.191-4.259-1.949-6.971-2.046l1.483-4.669 4.016.941-.006.058c0 1.193.975 2.163 2.174 2.163 1.198 0 2.172-.97 2.172-2.163s-.975-2.164-2.172-2.164c-.92 0-1.704.574-2.021 1.379l-4.329-1.015c-.189-.046-.381.063-.44.249l-1.654 5.207c-2.838.034-5.409.798-7.3 2.025-.474-.438-1.103-.712-1.799-.712-1.465 0-2.656 1.187-2.656 2.646 0 .97.533 1.811 1.317 2.271-.052.282-.086.567-.086.857 0 3.911 4.808 7.093 10.719 7.093s10.72-3.182 10.72-7.093c0-.274-.029-.544-.075-.81.832-.447 1.405-1.312 1.405-2.318zm-17.224 1.816c0-.868.71-1.575 1.582-1.575.872 0 1.581.707 1.581 1.575s-.709 1.574-1.581 1.574-1.582-.706-1.582-1.574zm9.061 4.669c-.797.793-2.048 1.179-3.824 1.179l-.013-.003-.013.003c-1.777 0-3.028-.386-3.824-1.179-.145-.144-.145-.379 0-.523.145-.145.381-.145.526 0 .65.647 1.729.961 3.298.961l.013.003.013-.003c1.569 0 2.648-.315 3.298-.962.145-.145.381-.144.526 0 .145.145.145.379 0 .524zm-.189-3.095c-.872 0-1.581-.706-1.581-1.574 0-.868.709-1.575 1.581-1.575s1.581.707 1.581 1.575-.709 1.574-1.581 1.574z"/>
                            </svg>
                        </a>
                        
                        <!-- Copy Link -->
                        <button onclick="copyToClipboard('https://williamzujkowski.github.io/posts/docker-runtime-security-hardening-with-linux-security-modules/')" 
                                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors duration-200"
                                aria-label="Copy link to clipboard">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </footer>
        </div>
    </div>
</article>

<!-- Blog JavaScript Bundle (reading-progress, table-of-contents) -->
<script src="/assets/js/blog.min.js"></script>

<!-- Collapsible Code Blocks - loaded in base.njk -->
    </main>
    
    <!-- Footer -->
    <footer role="contentinfo" aria-label="Site footer" class="mt-auto border-t border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- About -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">About</h3>
                    <p class="text-gray-600 dark:text-gray-400">
                        Personal website of William Zujkowski, exploring technology and sharing knowledge. All opinions and views expressed are my own and do not reflect those of my employer.
                    </p>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">Quick Links</h3>
                    <ul class="space-y-2"><li><a href="/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Home</a></li>
<li><a href="/about/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">About</a></li>
<li><a href="/posts/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Posts</a></li>
<li><a href="/resources/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Resources</a></li>
<li><a href="/stats/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Stats</a></li>
<li><a href="/uses/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Uses</a></li></ul>
                </div>
                
                <!-- Connect -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">Connect</h3>
                    <div class="flex space-x-4">
                        <a href="https://github.com/williamzujkowski" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200" aria-label="GitHub" rel="noopener noreferrer">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                        </a>
                        <a href="https://www.linkedin.com/in/williamzujkowski" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200" aria-label="LinkedIn" rel="noopener noreferrer">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                            </svg>
                        </a>
                        <a href="/feed.xml" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200" aria-label="RSS Feed">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M3.429 5.1v2.4c7.248 0 13.114 5.886 13.114 13.142h2.4C18.943 12.18 11.858 5.1 3.429 5.1zm0 4.8v2.4c3.924 0 7.114 3.206 7.114 7.142h2.4c0-5.256-4.276-9.542-9.514-9.542zM6.171 16.386c-.756 0-1.371.615-1.371 1.371 0 .756.615 1.371 1.371 1.371.756 0 1.371-.615 1.371-1.371 0-.756-.615-1.371-1.371-1.371z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
                <p class="text-center text-sm text-gray-600 dark:text-gray-400">
                    &copy; 2025 William Zujkowski. All rights reserved.
                    Built with <a href="https://www.11ty.dev/" class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">Eleventy</a>
                    and <a href="https://tailwindcss.com/" class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">Tailwind CSS</a>.
                </p>
            </div>
        </div>
    </footer>
    
    <!-- Scripts -->
    <script>
        function toggleDarkMode() {
            const html = document.documentElement;
            const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.theme = 'light';
                if (themeColorMeta) themeColorMeta.content = '#1e40af';
            } else {
                html.classList.add('dark');
                localStorage.theme = 'dark';
                if (themeColorMeta) themeColorMeta.content = '#111827';
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // Show success message
                showToast('Link copied to clipboard!');
            }, function(err) {
                // Fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-999999px";
                textArea.style.top = "-999999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast('Link copied to clipboard!');
                } catch (err) {
                    showToast('Failed to copy link');
                }
                document.body.removeChild(textArea);
            });
        }
        
        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 px-4 py-2 rounded-lg shadow-lg transform transition-all duration-300 translate-y-full';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-y-full');
                toast.classList.add('translate-y-0');
            }, 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('translate-y-0');
                toast.classList.add('translate-y-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }
    </script>
    
    <!-- Core JavaScript Bundle (ui-enhancements, back-to-top, code-collapse) -->
    <script src="/assets/js/core.min.js"></script>
    
    <!-- Mermaid Diagram Support -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        // Determine if dark mode is active
        const isDarkMode = document.documentElement.classList.contains('dark');
        
        // Initialize mermaid with proper settings
        mermaid.initialize({ 
            startOnLoad: false, // We'll manually init after DOM manipulation
            theme: isDarkMode ? 'dark' : 'default',
            themeVariables: isDarkMode ? {
                // Dark mode theme
                primaryColor: '#4f46e5',
                primaryTextColor: '#f3f4f6',
                primaryBorderColor: '#6366f1',
                lineColor: '#4b5563',
                secondaryColor: '#374151',
                tertiaryColor: '#1f2937',
                background: '#111827',
                mainBkg: '#1f2937',
                secondBkg: '#374151',
                tertiaryBkg: '#4b5563',
                primaryBorderColor: '#6366f1',
                fontFamily: 'Inter, system-ui, sans-serif',
                fontSize: '16px',
                darkMode: true,
                nodeBkg: '#374151',
                nodeBorder: '#6366f1',
                clusterBkg: '#1f2937',
                clusterBorder: '#4b5563',
                defaultLinkColor: '#93bbfd',
                titleColor: '#f3f4f6',
                edgeLabelBackground: '#1f2937',
                actorBorder: '#6366f1',
                actorBkg: '#374151',
                actorTextColor: '#f3f4f6',
                actorLineColor: '#4b5563',
                signalColor: '#f3f4f6',
                signalTextColor: '#f3f4f6',
                labelBoxBkgColor: '#374151',
                labelBoxBorderColor: '#6366f1',
                labelTextColor: '#f3f4f6',
                loopTextColor: '#f3f4f6',
                noteBorderColor: '#6366f1',
                noteBkgColor: '#374151',
                noteTextColor: '#f3f4f6',
                activationBorderColor: '#6366f1',
                activationBkgColor: '#374151',
                sequenceNumberColor: '#111827'
            } : {
                // Light mode theme
                primaryColor: '#6366f1',
                primaryTextColor: '#fff',
                primaryBorderColor: '#4f46e5',
                lineColor: '#d1d5db',
                secondaryColor: '#e5e7eb',
                tertiaryColor: '#f3f4f6',
                background: '#ffffff',
                mainBkg: '#ffffff',
                secondBkg: '#f3f4f6',
                tertiaryBkg: '#e5e7eb',
                fontFamily: 'Inter, system-ui, sans-serif',
                fontSize: '16px',
                darkMode: false,
                nodeBkg: '#f3f4f6',
                nodeBorder: '#4f46e5',
                clusterBkg: '#e5e7eb',
                clusterBorder: '#9ca3af',
                defaultLinkColor: '#2563eb',
                titleColor: '#1f2937',
                edgeLabelBackground: '#ffffff',
                actorBorder: '#4f46e5',
                actorBkg: '#f3f4f6',
                actorTextColor: '#1f2937',
                actorLineColor: '#9ca3af',
                signalColor: '#1f2937',
                signalTextColor: '#1f2937',
                labelBoxBkgColor: '#f3f4f6',
                labelBoxBorderColor: '#4f46e5',
                labelTextColor: '#1f2937',
                loopTextColor: '#1f2937',
                noteBorderColor: '#4f46e5',
                noteBkgColor: '#f3f4f6',
                noteTextColor: '#1f2937',
                activationBorderColor: '#4f46e5',
                activationBkgColor: '#e5e7eb',
                sequenceNumberColor: '#ffffff'
            },
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
        
        // Process Mermaid diagrams and THEN initialize code-collapse
        window.addEventListener('DOMContentLoaded', async function() {
            // Step 1: Find and process all mermaid code blocks
            const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
            
            if (mermaidBlocks.length > 0) {
                // Processing Mermaid diagrams
                
                // Convert each mermaid code block to a diagram
                for (const element of mermaidBlocks) {
                    const graphDefinition = element.textContent;
                    const preElement = element.parentNode;
                    
                    // Create a container div for the mermaid diagram
                    const containerDiv = document.createElement('div');
                    containerDiv.className = 'mermaid-container';
                    containerDiv.setAttribute('data-mermaid', 'true');
                    
                    // Create the mermaid div
                    const graphDiv = document.createElement('div');
                    graphDiv.className = 'mermaid';
                    graphDiv.textContent = graphDefinition;
                    
                    // Replace the pre element with the container - this removes the code block entirely
                    preElement.parentNode.replaceChild(containerDiv, preElement);
                    containerDiv.appendChild(graphDiv);
                }
                
                // Step 2: Initialize all mermaid diagrams with error handling
                try {
                    await mermaid.run();
                    console.log(`✅ Successfully rendered ${mermaidBlocks.length} Mermaid diagram(s)`);
                } catch (error) {
                    console.error('❌ Mermaid rendering failed:', error);
                    // Log each diagram's content for debugging
                    document.querySelectorAll('.mermaid').forEach((div, index) => {
                        console.error(`Diagram ${index + 1} content:`, div.textContent);
                    });
                }

                // Diagrams are now styled via CSS, no need for inline styles
            }
            
            // Step 3: Code-collapse.js is already loaded and will handle remaining blocks
            // It checks for data-processed attribute to avoid duplicates
        });
    </script>
</body>
</html>