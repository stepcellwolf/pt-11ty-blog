{"version":3,"sources":["../../../src/memory/enhanced-session-serializer.js"],"sourcesContent":["/**\n * Enhanced session serializer that extends the HiveMindSessionManager\n * with advanced TypeScript-compatible serialization capabilities\n */\n\nimport {\n  AdvancedSerializer,\n  createSessionSerializer,\n  SerializationError,\n  DeserializationError\n} from './advanced-serializer.js';\n\n/**\n * Session-specific serialization utilities\n */\nexport class SessionSerializer {\n  constructor(options = {}) {\n    this.serializer = createSessionSerializer({\n      preserveUndefined: true,\n      preserveFunctions: false, // Security: never serialize functions in sessions\n      preserveSymbols: true,\n      enableCompression: options.enableCompression !== false,\n      maxDepth: options.maxDepth || 50,\n      ...options\n    });\n\n    this.compressionThreshold = options.compressionThreshold || 1024; // 1KB\n    this.enableValidation = options.enableValidation !== false;\n    this.enableMigration = options.enableMigration !== false;\n  }\n\n  /**\n   * Serialize session data with enhanced TypeScript support\n   */\n  serializeSessionData(sessionData) {\n    try {\n      // Pre-process session data for better serialization\n      const processedData = this._preprocessSessionData(sessionData);\n      \n      // Add session metadata for validation and migration\n      const enhancedData = {\n        ...processedData,\n        __session_meta__: {\n          version: '2.0.0',\n          timestamp: new Date().toISOString(),\n          serializer: 'SessionSerializer',\n          nodeVersion: process.version,\n          platform: process.platform,\n          compressionEnabled: this.serializer.options.enableCompression\n        }\n      };\n\n      return this.serializer.serializeSessionData(enhancedData);\n    } catch (error) {\n      throw new SerializationError(`Session serialization failed: ${error.message}`, {\n        sessionId: sessionData?.id,\n        originalError: error\n      });\n    }\n  }\n\n  /**\n   * Deserialize session data with validation and migration support\n   */\n  deserializeSessionData(serializedData, options = {}) {\n    try {\n      const data = this.serializer.deserializeSessionData(serializedData);\n      \n      // Handle metadata and validation\n      if (data.__session_meta__) {\n        const meta = data.__session_meta__;\n        \n        // Version migration if needed\n        if (this.enableMigration && meta.version !== '2.0.0') {\n          console.log(`[SessionSerializer] Migrating session data from v${meta.version} to v2.0.0`);\n          this._migrateSessionData(data, meta.version);\n        }\n        \n        // Remove metadata\n        delete data.__session_meta__;\n      }\n\n      // Post-process to restore complex types\n      return this._postprocessSessionData(data, options);\n    } catch (error) {\n      // Attempt fallback deserialization for older formats\n      if (options.allowFallback !== false) {\n        try {\n          console.warn('[SessionSerializer] Attempting fallback deserialization for legacy format');\n          return this._deserializeLegacySession(serializedData);\n        } catch (fallbackError) {\n          console.error('[SessionSerializer] Fallback deserialization also failed:', fallbackError.message);\n        }\n      }\n      \n      throw new DeserializationError(`Session deserialization failed: ${error.message}`, {\n        originalError: error\n      });\n    }\n  }\n\n  /**\n   * Serialize checkpoint data with type preservation\n   */\n  serializeCheckpointData(checkpointData) {\n    try {\n      // Enhanced checkpoint with additional metadata\n      const enhancedCheckpoint = {\n        ...checkpointData,\n        __checkpoint_meta__: {\n          serializedAt: new Date().toISOString(),\n          version: '2.0.0',\n          type: 'checkpoint'\n        }\n      };\n\n      return this.serializer.serialize(enhancedCheckpoint);\n    } catch (error) {\n      throw new SerializationError(`Checkpoint serialization failed: ${error.message}`, {\n        checkpointName: checkpointData?.name,\n        originalError: error\n      });\n    }\n  }\n\n  /**\n   * Deserialize checkpoint data with type restoration\n   */\n  deserializeCheckpointData(serializedData) {\n    try {\n      const data = this.serializer.deserialize(serializedData);\n      \n      // Remove checkpoint metadata\n      if (data.__checkpoint_meta__) {\n        delete data.__checkpoint_meta__;\n      }\n      \n      return data;\n    } catch (error) {\n      // Fallback to basic JSON parsing for legacy checkpoints\n      try {\n        return JSON.parse(serializedData);\n      } catch (fallbackError) {\n        throw new DeserializationError(`Checkpoint deserialization failed: ${error.message}`, {\n          originalError: error,\n          fallbackError: fallbackError.message\n        });\n      }\n    }\n  }\n\n  /**\n   * Serialize session metadata with complex type support\n   */\n  serializeMetadata(metadata) {\n    try {\n      if (!metadata || typeof metadata !== 'object') {\n        return JSON.stringify(metadata);\n      }\n\n      // Use advanced serializer for complex metadata\n      return this.serializer.serialize(metadata);\n    } catch (error) {\n      console.warn('[SessionSerializer] Metadata serialization failed, using fallback:', error.message);\n      return JSON.stringify(this._simplifyMetadata(metadata));\n    }\n  }\n\n  /**\n   * Deserialize session metadata with type restoration\n   */\n  deserializeMetadata(serializedMetadata) {\n    if (!serializedMetadata) return {};\n    \n    try {\n      // Try advanced deserialization first\n      return this.serializer.deserialize(serializedMetadata);\n    } catch (error) {\n      try {\n        // Fallback to basic JSON parsing\n        return JSON.parse(serializedMetadata);\n      } catch (fallbackError) {\n        console.warn('[SessionSerializer] Metadata deserialization failed:', error.message);\n        return {};\n      }\n    }\n  }\n\n  /**\n   * Serialize log data with structured formatting\n   */\n  serializeLogData(logData) {\n    if (!logData) return null;\n    \n    try {\n      // Handle different log data types\n      if (typeof logData === 'string') {\n        return logData;\n      }\n      \n      // Use advanced serializer for complex log data\n      return this.serializer.serialize(logData);\n    } catch (error) {\n      console.warn('[SessionSerializer] Log data serialization failed:', error.message);\n      return JSON.stringify(this._sanitizeLogData(logData));\n    }\n  }\n\n  /**\n   * Deserialize log data with error recovery\n   */\n  deserializeLogData(serializedLogData) {\n    if (!serializedLogData) return null;\n    \n    try {\n      // Try advanced deserialization\n      return this.serializer.deserialize(serializedLogData);\n    } catch (error) {\n      try {\n        // Fallback to JSON parsing\n        return JSON.parse(serializedLogData);\n      } catch (fallbackError) {\n        // Return as-is if all parsing fails\n        return serializedLogData;\n      }\n    }\n  }\n\n  /**\n   * Pre-process session data before serialization\n   */\n  _preprocessSessionData(sessionData) {\n    if (!sessionData || typeof sessionData !== 'object') {\n      return sessionData;\n    }\n\n    const processed = { ...sessionData };\n\n    // Handle special session fields\n    if (processed.created_at && !(processed.created_at instanceof Date)) {\n      processed.created_at = new Date(processed.created_at);\n    }\n    \n    if (processed.updated_at && !(processed.updated_at instanceof Date)) {\n      processed.updated_at = new Date(processed.updated_at);\n    }\n\n    if (processed.paused_at && !(processed.paused_at instanceof Date)) {\n      processed.paused_at = new Date(processed.paused_at);\n    }\n\n    if (processed.resumed_at && !(processed.resumed_at instanceof Date)) {\n      processed.resumed_at = new Date(processed.resumed_at);\n    }\n\n    // Handle arrays and complex nested structures\n    if (processed.agents && Array.isArray(processed.agents)) {\n      processed.agents = processed.agents.map(agent => this._preprocessAgent(agent));\n    }\n\n    if (processed.tasks && Array.isArray(processed.tasks)) {\n      processed.tasks = processed.tasks.map(task => this._preprocessTask(task));\n    }\n\n    if (processed.checkpoints && Array.isArray(processed.checkpoints)) {\n      processed.checkpoints = processed.checkpoints.map(checkpoint => this._preprocessCheckpoint(checkpoint));\n    }\n\n    return processed;\n  }\n\n  /**\n   * Post-process session data after deserialization\n   */\n  _postprocessSessionData(sessionData, options = {}) {\n    if (!sessionData || typeof sessionData !== 'object') {\n      return sessionData;\n    }\n\n    const processed = { ...sessionData };\n\n    // Restore date objects\n    const dateFields = ['created_at', 'updated_at', 'paused_at', 'resumed_at'];\n    for (const field of dateFields) {\n      if (processed[field] && !(processed[field] instanceof Date)) {\n        processed[field] = new Date(processed[field]);\n      }\n    }\n\n    // Post-process nested structures\n    if (processed.agents && Array.isArray(processed.agents)) {\n      processed.agents = processed.agents.map(agent => this._postprocessAgent(agent));\n    }\n\n    if (processed.tasks && Array.isArray(processed.tasks)) {\n      processed.tasks = processed.tasks.map(task => this._postprocessTask(task));\n    }\n\n    if (processed.checkpoints && Array.isArray(processed.checkpoints)) {\n      processed.checkpoints = processed.checkpoints.map(checkpoint => this._postprocessCheckpoint(checkpoint));\n    }\n\n    return processed;\n  }\n\n  /**\n   * Agent-specific preprocessing\n   */\n  _preprocessAgent(agent) {\n    if (!agent || typeof agent !== 'object') return agent;\n    \n    const processed = { ...agent };\n    \n    // Handle agent timestamps\n    if (processed.created_at) processed.created_at = new Date(processed.created_at);\n    if (processed.updated_at) processed.updated_at = new Date(processed.updated_at);\n    if (processed.last_active) processed.last_active = new Date(processed.last_active);\n    \n    // Handle agent configuration\n    if (processed.config && typeof processed.config === 'object') {\n      processed.config = { ...processed.config };\n    }\n    \n    return processed;\n  }\n\n  /**\n   * Task-specific preprocessing\n   */\n  _preprocessTask(task) {\n    if (!task || typeof task !== 'object') return task;\n    \n    const processed = { ...task };\n    \n    // Handle task timestamps\n    if (processed.created_at) processed.created_at = new Date(processed.created_at);\n    if (processed.updated_at) processed.updated_at = new Date(processed.updated_at);\n    if (processed.started_at) processed.started_at = new Date(processed.started_at);\n    if (processed.completed_at) processed.completed_at = new Date(processed.completed_at);\n    \n    return processed;\n  }\n\n  /**\n   * Checkpoint-specific preprocessing\n   */\n  _preprocessCheckpoint(checkpoint) {\n    if (!checkpoint || typeof checkpoint !== 'object') return checkpoint;\n    \n    const processed = { ...checkpoint };\n    \n    // Handle checkpoint timestamps\n    if (processed.created_at) processed.created_at = new Date(processed.created_at);\n    \n    return processed;\n  }\n\n  /**\n   * Agent-specific postprocessing\n   */\n  _postprocessAgent(agent) {\n    return this._preprocessAgent(agent); // Same logic for now\n  }\n\n  /**\n   * Task-specific postprocessing\n   */\n  _postprocessTask(task) {\n    return this._preprocessTask(task); // Same logic for now\n  }\n\n  /**\n   * Checkpoint-specific postprocessing\n   */\n  _postprocessCheckpoint(checkpoint) {\n    return this._preprocessCheckpoint(checkpoint); // Same logic for now\n  }\n\n  /**\n   * Migrate session data between versions\n   */\n  _migrateSessionData(data, fromVersion) {\n    switch (fromVersion) {\n      case '1.0.0':\n        // Add new fields introduced in v2.0.0\n        if (!data.version) data.version = '2.0.0';\n        if (!data.capabilities) data.capabilities = [];\n        break;\n      \n      default:\n        console.warn(`[SessionSerializer] Unknown session version: ${fromVersion}`);\n    }\n  }\n\n  /**\n   * Fallback deserialization for legacy session formats\n   */\n  _deserializeLegacySession(serializedData) {\n    try {\n      const data = JSON.parse(serializedData);\n      \n      // Basic cleanup for common legacy issues\n      return this._cleanupLegacyData(data);\n    } catch (error) {\n      throw new DeserializationError(`Legacy session deserialization failed: ${error.message}`);\n    }\n  }\n\n  /**\n   * Clean up legacy data structures\n   */\n  _cleanupLegacyData(data) {\n    if (!data || typeof data !== 'object') return data;\n    \n    const cleaned = { ...data };\n    \n    // Convert string dates to Date objects\n    const dateFields = ['created_at', 'updated_at', 'paused_at', 'resumed_at'];\n    for (const field of dateFields) {\n      if (cleaned[field] && typeof cleaned[field] === 'string') {\n        try {\n          cleaned[field] = new Date(cleaned[field]);\n        } catch (error) {\n          console.warn(`[SessionSerializer] Failed to parse date field ${field}:`, error.message);\n        }\n      }\n    }\n    \n    // Handle stringified JSON fields\n    const jsonFields = ['metadata', 'checkpoint_data'];\n    for (const field of jsonFields) {\n      if (cleaned[field] && typeof cleaned[field] === 'string') {\n        try {\n          cleaned[field] = JSON.parse(cleaned[field]);\n        } catch (error) {\n          console.warn(`[SessionSerializer] Failed to parse JSON field ${field}:`, error.message);\n        }\n      }\n    }\n    \n    return cleaned;\n  }\n\n  /**\n   * Simplify metadata for fallback serialization\n   */\n  _simplifyMetadata(metadata) {\n    if (!metadata || typeof metadata !== 'object') return metadata;\n    \n    const simplified = {};\n    \n    for (const [key, value] of Object.entries(metadata)) {\n      try {\n        // Only include JSON-serializable values\n        JSON.stringify(value);\n        simplified[key] = value;\n      } catch (error) {\n        simplified[key] = `[Non-serializable: ${typeof value}]`;\n      }\n    }\n    \n    return simplified;\n  }\n\n  /**\n   * Sanitize log data for safe serialization\n   */\n  _sanitizeLogData(logData) {\n    if (!logData || typeof logData !== 'object') return logData;\n    \n    const sanitized = {};\n    \n    for (const [key, value] of Object.entries(logData)) {\n      if (typeof value === 'function') {\n        sanitized[key] = '[Function]';\n      } else if (typeof value === 'symbol') {\n        sanitized[key] = `[Symbol: ${value.toString()}]`;\n      } else if (value instanceof Error) {\n        sanitized[key] = {\n          name: value.name,\n          message: value.message,\n          stack: value.stack\n        };\n      } else {\n        try {\n          JSON.stringify(value);\n          sanitized[key] = value;\n        } catch (error) {\n          sanitized[key] = `[Non-serializable: ${typeof value}]`;\n        }\n      }\n    }\n    \n    return sanitized;\n  }\n\n  /**\n   * Get serialization statistics\n   */\n  getStats() {\n    return {\n      compressionEnabled: this.serializer.options.enableCompression,\n      compressionThreshold: this.compressionThreshold,\n      maxDepth: this.serializer.options.maxDepth,\n      validationEnabled: this.enableValidation,\n      migrationEnabled: this.enableMigration\n    };\n  }\n}\n\n/**\n * Factory function for creating session serializers\n */\nexport function createEnhancedSessionSerializer(options = {}) {\n  return new SessionSerializer(options);\n}\n\n/**\n * Global session serializer instance\n */\nexport const sessionSerializer = new SessionSerializer();\n\nexport default SessionSerializer;"],"names":["createSessionSerializer","SerializationError","DeserializationError","SessionSerializer","options","serializer","preserveUndefined","preserveFunctions","preserveSymbols","enableCompression","maxDepth","compressionThreshold","enableValidation","enableMigration","serializeSessionData","sessionData","processedData","_preprocessSessionData","enhancedData","__session_meta__","version","timestamp","Date","toISOString","nodeVersion","process","platform","compressionEnabled","error","message","sessionId","id","originalError","deserializeSessionData","serializedData","data","meta","console","log","_migrateSessionData","_postprocessSessionData","allowFallback","warn","_deserializeLegacySession","fallbackError","serializeCheckpointData","checkpointData","enhancedCheckpoint","__checkpoint_meta__","serializedAt","type","serialize","checkpointName","name","deserializeCheckpointData","deserialize","JSON","parse","serializeMetadata","metadata","stringify","_simplifyMetadata","deserializeMetadata","serializedMetadata","serializeLogData","logData","_sanitizeLogData","deserializeLogData","serializedLogData","processed","created_at","updated_at","paused_at","resumed_at","agents","Array","isArray","map","agent","_preprocessAgent","tasks","task","_preprocessTask","checkpoints","checkpoint","_preprocessCheckpoint","dateFields","field","_postprocessAgent","_postprocessTask","_postprocessCheckpoint","last_active","config","started_at","completed_at","fromVersion","capabilities","_cleanupLegacyData","cleaned","jsonFields","simplified","key","value","Object","entries","sanitized","toString","Error","stack","getStats","validationEnabled","migrationEnabled","createEnhancedSessionSerializer","sessionSerializer"],"mappings":"AAKA,SAEEA,uBAAuB,EACvBC,kBAAkB,EAClBC,oBAAoB,QACf,2BAA2B;AAKlC,OAAO,MAAMC;IACX,YAAYC,UAAU,CAAC,CAAC,CAAE;QACxB,IAAI,CAACC,UAAU,GAAGL,wBAAwB;YACxCM,mBAAmB;YACnBC,mBAAmB;YACnBC,iBAAiB;YACjBC,mBAAmBL,QAAQK,iBAAiB,KAAK;YACjDC,UAAUN,QAAQM,QAAQ,IAAI;YAC9B,GAAGN,OAAO;QACZ;QAEA,IAAI,CAACO,oBAAoB,GAAGP,QAAQO,oBAAoB,IAAI;QAC5D,IAAI,CAACC,gBAAgB,GAAGR,QAAQQ,gBAAgB,KAAK;QACrD,IAAI,CAACC,eAAe,GAAGT,QAAQS,eAAe,KAAK;IACrD;IAKAC,qBAAqBC,WAAW,EAAE;QAChC,IAAI;YAEF,MAAMC,gBAAgB,IAAI,CAACC,sBAAsB,CAACF;YAGlD,MAAMG,eAAe;gBACnB,GAAGF,aAAa;gBAChBG,kBAAkB;oBAChBC,SAAS;oBACTC,WAAW,IAAIC,OAAOC,WAAW;oBACjClB,YAAY;oBACZmB,aAAaC,QAAQL,OAAO;oBAC5BM,UAAUD,QAAQC,QAAQ;oBAC1BC,oBAAoB,IAAI,CAACtB,UAAU,CAACD,OAAO,CAACK,iBAAiB;gBAC/D;YACF;YAEA,OAAO,IAAI,CAACJ,UAAU,CAACS,oBAAoB,CAACI;QAC9C,EAAE,OAAOU,OAAO;YACd,MAAM,IAAI3B,mBAAmB,CAAC,8BAA8B,EAAE2B,MAAMC,OAAO,EAAE,EAAE;gBAC7EC,WAAWf,aAAagB;gBACxBC,eAAeJ;YACjB;QACF;IACF;IAKAK,uBAAuBC,cAAc,EAAE9B,UAAU,CAAC,CAAC,EAAE;QACnD,IAAI;YACF,MAAM+B,OAAO,IAAI,CAAC9B,UAAU,CAAC4B,sBAAsB,CAACC;YAGpD,IAAIC,KAAKhB,gBAAgB,EAAE;gBACzB,MAAMiB,OAAOD,KAAKhB,gBAAgB;gBAGlC,IAAI,IAAI,CAACN,eAAe,IAAIuB,KAAKhB,OAAO,KAAK,SAAS;oBACpDiB,QAAQC,GAAG,CAAC,CAAC,iDAAiD,EAAEF,KAAKhB,OAAO,CAAC,UAAU,CAAC;oBACxF,IAAI,CAACmB,mBAAmB,CAACJ,MAAMC,KAAKhB,OAAO;gBAC7C;gBAGA,OAAOe,KAAKhB,gBAAgB;YAC9B;YAGA,OAAO,IAAI,CAACqB,uBAAuB,CAACL,MAAM/B;QAC5C,EAAE,OAAOwB,OAAO;YAEd,IAAIxB,QAAQqC,aAAa,KAAK,OAAO;gBACnC,IAAI;oBACFJ,QAAQK,IAAI,CAAC;oBACb,OAAO,IAAI,CAACC,yBAAyB,CAACT;gBACxC,EAAE,OAAOU,eAAe;oBACtBP,QAAQT,KAAK,CAAC,6DAA6DgB,cAAcf,OAAO;gBAClG;YACF;YAEA,MAAM,IAAI3B,qBAAqB,CAAC,gCAAgC,EAAE0B,MAAMC,OAAO,EAAE,EAAE;gBACjFG,eAAeJ;YACjB;QACF;IACF;IAKAiB,wBAAwBC,cAAc,EAAE;QACtC,IAAI;YAEF,MAAMC,qBAAqB;gBACzB,GAAGD,cAAc;gBACjBE,qBAAqB;oBACnBC,cAAc,IAAI3B,OAAOC,WAAW;oBACpCH,SAAS;oBACT8B,MAAM;gBACR;YACF;YAEA,OAAO,IAAI,CAAC7C,UAAU,CAAC8C,SAAS,CAACJ;QACnC,EAAE,OAAOnB,OAAO;YACd,MAAM,IAAI3B,mBAAmB,CAAC,iCAAiC,EAAE2B,MAAMC,OAAO,EAAE,EAAE;gBAChFuB,gBAAgBN,gBAAgBO;gBAChCrB,eAAeJ;YACjB;QACF;IACF;IAKA0B,0BAA0BpB,cAAc,EAAE;QACxC,IAAI;YACF,MAAMC,OAAO,IAAI,CAAC9B,UAAU,CAACkD,WAAW,CAACrB;YAGzC,IAAIC,KAAKa,mBAAmB,EAAE;gBAC5B,OAAOb,KAAKa,mBAAmB;YACjC;YAEA,OAAOb;QACT,EAAE,OAAOP,OAAO;YAEd,IAAI;gBACF,OAAO4B,KAAKC,KAAK,CAACvB;YACpB,EAAE,OAAOU,eAAe;gBACtB,MAAM,IAAI1C,qBAAqB,CAAC,mCAAmC,EAAE0B,MAAMC,OAAO,EAAE,EAAE;oBACpFG,eAAeJ;oBACfgB,eAAeA,cAAcf,OAAO;gBACtC;YACF;QACF;IACF;IAKA6B,kBAAkBC,QAAQ,EAAE;QAC1B,IAAI;YACF,IAAI,CAACA,YAAY,OAAOA,aAAa,UAAU;gBAC7C,OAAOH,KAAKI,SAAS,CAACD;YACxB;YAGA,OAAO,IAAI,CAACtD,UAAU,CAAC8C,SAAS,CAACQ;QACnC,EAAE,OAAO/B,OAAO;YACdS,QAAQK,IAAI,CAAC,sEAAsEd,MAAMC,OAAO;YAChG,OAAO2B,KAAKI,SAAS,CAAC,IAAI,CAACC,iBAAiB,CAACF;QAC/C;IACF;IAKAG,oBAAoBC,kBAAkB,EAAE;QACtC,IAAI,CAACA,oBAAoB,OAAO,CAAC;QAEjC,IAAI;YAEF,OAAO,IAAI,CAAC1D,UAAU,CAACkD,WAAW,CAACQ;QACrC,EAAE,OAAOnC,OAAO;YACd,IAAI;gBAEF,OAAO4B,KAAKC,KAAK,CAACM;YACpB,EAAE,OAAOnB,eAAe;gBACtBP,QAAQK,IAAI,CAAC,wDAAwDd,MAAMC,OAAO;gBAClF,OAAO,CAAC;YACV;QACF;IACF;IAKAmC,iBAAiBC,OAAO,EAAE;QACxB,IAAI,CAACA,SAAS,OAAO;QAErB,IAAI;YAEF,IAAI,OAAOA,YAAY,UAAU;gBAC/B,OAAOA;YACT;YAGA,OAAO,IAAI,CAAC5D,UAAU,CAAC8C,SAAS,CAACc;QACnC,EAAE,OAAOrC,OAAO;YACdS,QAAQK,IAAI,CAAC,sDAAsDd,MAAMC,OAAO;YAChF,OAAO2B,KAAKI,SAAS,CAAC,IAAI,CAACM,gBAAgB,CAACD;QAC9C;IACF;IAKAE,mBAAmBC,iBAAiB,EAAE;QACpC,IAAI,CAACA,mBAAmB,OAAO;QAE/B,IAAI;YAEF,OAAO,IAAI,CAAC/D,UAAU,CAACkD,WAAW,CAACa;QACrC,EAAE,OAAOxC,OAAO;YACd,IAAI;gBAEF,OAAO4B,KAAKC,KAAK,CAACW;YACpB,EAAE,OAAOxB,eAAe;gBAEtB,OAAOwB;YACT;QACF;IACF;IAKAnD,uBAAuBF,WAAW,EAAE;QAClC,IAAI,CAACA,eAAe,OAAOA,gBAAgB,UAAU;YACnD,OAAOA;QACT;QAEA,MAAMsD,YAAY;YAAE,GAAGtD,WAAW;QAAC;QAGnC,IAAIsD,UAAUC,UAAU,IAAI,CAAED,CAAAA,UAAUC,UAAU,YAAYhD,IAAG,GAAI;YACnE+C,UAAUC,UAAU,GAAG,IAAIhD,KAAK+C,UAAUC,UAAU;QACtD;QAEA,IAAID,UAAUE,UAAU,IAAI,CAAEF,CAAAA,UAAUE,UAAU,YAAYjD,IAAG,GAAI;YACnE+C,UAAUE,UAAU,GAAG,IAAIjD,KAAK+C,UAAUE,UAAU;QACtD;QAEA,IAAIF,UAAUG,SAAS,IAAI,CAAEH,CAAAA,UAAUG,SAAS,YAAYlD,IAAG,GAAI;YACjE+C,UAAUG,SAAS,GAAG,IAAIlD,KAAK+C,UAAUG,SAAS;QACpD;QAEA,IAAIH,UAAUI,UAAU,IAAI,CAAEJ,CAAAA,UAAUI,UAAU,YAAYnD,IAAG,GAAI;YACnE+C,UAAUI,UAAU,GAAG,IAAInD,KAAK+C,UAAUI,UAAU;QACtD;QAGA,IAAIJ,UAAUK,MAAM,IAAIC,MAAMC,OAAO,CAACP,UAAUK,MAAM,GAAG;YACvDL,UAAUK,MAAM,GAAGL,UAAUK,MAAM,CAACG,GAAG,CAACC,CAAAA,QAAS,IAAI,CAACC,gBAAgB,CAACD;QACzE;QAEA,IAAIT,UAAUW,KAAK,IAAIL,MAAMC,OAAO,CAACP,UAAUW,KAAK,GAAG;YACrDX,UAAUW,KAAK,GAAGX,UAAUW,KAAK,CAACH,GAAG,CAACI,CAAAA,OAAQ,IAAI,CAACC,eAAe,CAACD;QACrE;QAEA,IAAIZ,UAAUc,WAAW,IAAIR,MAAMC,OAAO,CAACP,UAAUc,WAAW,GAAG;YACjEd,UAAUc,WAAW,GAAGd,UAAUc,WAAW,CAACN,GAAG,CAACO,CAAAA,aAAc,IAAI,CAACC,qBAAqB,CAACD;QAC7F;QAEA,OAAOf;IACT;IAKA7B,wBAAwBzB,WAAW,EAAEX,UAAU,CAAC,CAAC,EAAE;QACjD,IAAI,CAACW,eAAe,OAAOA,gBAAgB,UAAU;YACnD,OAAOA;QACT;QAEA,MAAMsD,YAAY;YAAE,GAAGtD,WAAW;QAAC;QAGnC,MAAMuE,aAAa;YAAC;YAAc;YAAc;YAAa;SAAa;QAC1E,KAAK,MAAMC,SAASD,WAAY;YAC9B,IAAIjB,SAAS,CAACkB,MAAM,IAAI,CAAElB,CAAAA,SAAS,CAACkB,MAAM,YAAYjE,IAAG,GAAI;gBAC3D+C,SAAS,CAACkB,MAAM,GAAG,IAAIjE,KAAK+C,SAAS,CAACkB,MAAM;YAC9C;QACF;QAGA,IAAIlB,UAAUK,MAAM,IAAIC,MAAMC,OAAO,CAACP,UAAUK,MAAM,GAAG;YACvDL,UAAUK,MAAM,GAAGL,UAAUK,MAAM,CAACG,GAAG,CAACC,CAAAA,QAAS,IAAI,CAACU,iBAAiB,CAACV;QAC1E;QAEA,IAAIT,UAAUW,KAAK,IAAIL,MAAMC,OAAO,CAACP,UAAUW,KAAK,GAAG;YACrDX,UAAUW,KAAK,GAAGX,UAAUW,KAAK,CAACH,GAAG,CAACI,CAAAA,OAAQ,IAAI,CAACQ,gBAAgB,CAACR;QACtE;QAEA,IAAIZ,UAAUc,WAAW,IAAIR,MAAMC,OAAO,CAACP,UAAUc,WAAW,GAAG;YACjEd,UAAUc,WAAW,GAAGd,UAAUc,WAAW,CAACN,GAAG,CAACO,CAAAA,aAAc,IAAI,CAACM,sBAAsB,CAACN;QAC9F;QAEA,OAAOf;IACT;IAKAU,iBAAiBD,KAAK,EAAE;QACtB,IAAI,CAACA,SAAS,OAAOA,UAAU,UAAU,OAAOA;QAEhD,MAAMT,YAAY;YAAE,GAAGS,KAAK;QAAC;QAG7B,IAAIT,UAAUC,UAAU,EAAED,UAAUC,UAAU,GAAG,IAAIhD,KAAK+C,UAAUC,UAAU;QAC9E,IAAID,UAAUE,UAAU,EAAEF,UAAUE,UAAU,GAAG,IAAIjD,KAAK+C,UAAUE,UAAU;QAC9E,IAAIF,UAAUsB,WAAW,EAAEtB,UAAUsB,WAAW,GAAG,IAAIrE,KAAK+C,UAAUsB,WAAW;QAGjF,IAAItB,UAAUuB,MAAM,IAAI,OAAOvB,UAAUuB,MAAM,KAAK,UAAU;YAC5DvB,UAAUuB,MAAM,GAAG;gBAAE,GAAGvB,UAAUuB,MAAM;YAAC;QAC3C;QAEA,OAAOvB;IACT;IAKAa,gBAAgBD,IAAI,EAAE;QACpB,IAAI,CAACA,QAAQ,OAAOA,SAAS,UAAU,OAAOA;QAE9C,MAAMZ,YAAY;YAAE,GAAGY,IAAI;QAAC;QAG5B,IAAIZ,UAAUC,UAAU,EAAED,UAAUC,UAAU,GAAG,IAAIhD,KAAK+C,UAAUC,UAAU;QAC9E,IAAID,UAAUE,UAAU,EAAEF,UAAUE,UAAU,GAAG,IAAIjD,KAAK+C,UAAUE,UAAU;QAC9E,IAAIF,UAAUwB,UAAU,EAAExB,UAAUwB,UAAU,GAAG,IAAIvE,KAAK+C,UAAUwB,UAAU;QAC9E,IAAIxB,UAAUyB,YAAY,EAAEzB,UAAUyB,YAAY,GAAG,IAAIxE,KAAK+C,UAAUyB,YAAY;QAEpF,OAAOzB;IACT;IAKAgB,sBAAsBD,UAAU,EAAE;QAChC,IAAI,CAACA,cAAc,OAAOA,eAAe,UAAU,OAAOA;QAE1D,MAAMf,YAAY;YAAE,GAAGe,UAAU;QAAC;QAGlC,IAAIf,UAAUC,UAAU,EAAED,UAAUC,UAAU,GAAG,IAAIhD,KAAK+C,UAAUC,UAAU;QAE9E,OAAOD;IACT;IAKAmB,kBAAkBV,KAAK,EAAE;QACvB,OAAO,IAAI,CAACC,gBAAgB,CAACD;IAC/B;IAKAW,iBAAiBR,IAAI,EAAE;QACrB,OAAO,IAAI,CAACC,eAAe,CAACD;IAC9B;IAKAS,uBAAuBN,UAAU,EAAE;QACjC,OAAO,IAAI,CAACC,qBAAqB,CAACD;IACpC;IAKA7C,oBAAoBJ,IAAI,EAAE4D,WAAW,EAAE;QACrC,OAAQA;YACN,KAAK;gBAEH,IAAI,CAAC5D,KAAKf,OAAO,EAAEe,KAAKf,OAAO,GAAG;gBAClC,IAAI,CAACe,KAAK6D,YAAY,EAAE7D,KAAK6D,YAAY,GAAG,EAAE;gBAC9C;YAEF;gBACE3D,QAAQK,IAAI,CAAC,CAAC,6CAA6C,EAAEqD,aAAa;QAC9E;IACF;IAKApD,0BAA0BT,cAAc,EAAE;QACxC,IAAI;YACF,MAAMC,OAAOqB,KAAKC,KAAK,CAACvB;YAGxB,OAAO,IAAI,CAAC+D,kBAAkB,CAAC9D;QACjC,EAAE,OAAOP,OAAO;YACd,MAAM,IAAI1B,qBAAqB,CAAC,uCAAuC,EAAE0B,MAAMC,OAAO,EAAE;QAC1F;IACF;IAKAoE,mBAAmB9D,IAAI,EAAE;QACvB,IAAI,CAACA,QAAQ,OAAOA,SAAS,UAAU,OAAOA;QAE9C,MAAM+D,UAAU;YAAE,GAAG/D,IAAI;QAAC;QAG1B,MAAMmD,aAAa;YAAC;YAAc;YAAc;YAAa;SAAa;QAC1E,KAAK,MAAMC,SAASD,WAAY;YAC9B,IAAIY,OAAO,CAACX,MAAM,IAAI,OAAOW,OAAO,CAACX,MAAM,KAAK,UAAU;gBACxD,IAAI;oBACFW,OAAO,CAACX,MAAM,GAAG,IAAIjE,KAAK4E,OAAO,CAACX,MAAM;gBAC1C,EAAE,OAAO3D,OAAO;oBACdS,QAAQK,IAAI,CAAC,CAAC,+CAA+C,EAAE6C,MAAM,CAAC,CAAC,EAAE3D,MAAMC,OAAO;gBACxF;YACF;QACF;QAGA,MAAMsE,aAAa;YAAC;YAAY;SAAkB;QAClD,KAAK,MAAMZ,SAASY,WAAY;YAC9B,IAAID,OAAO,CAACX,MAAM,IAAI,OAAOW,OAAO,CAACX,MAAM,KAAK,UAAU;gBACxD,IAAI;oBACFW,OAAO,CAACX,MAAM,GAAG/B,KAAKC,KAAK,CAACyC,OAAO,CAACX,MAAM;gBAC5C,EAAE,OAAO3D,OAAO;oBACdS,QAAQK,IAAI,CAAC,CAAC,+CAA+C,EAAE6C,MAAM,CAAC,CAAC,EAAE3D,MAAMC,OAAO;gBACxF;YACF;QACF;QAEA,OAAOqE;IACT;IAKArC,kBAAkBF,QAAQ,EAAE;QAC1B,IAAI,CAACA,YAAY,OAAOA,aAAa,UAAU,OAAOA;QAEtD,MAAMyC,aAAa,CAAC;QAEpB,KAAK,MAAM,CAACC,KAAKC,MAAM,IAAIC,OAAOC,OAAO,CAAC7C,UAAW;YACnD,IAAI;gBAEFH,KAAKI,SAAS,CAAC0C;gBACfF,UAAU,CAACC,IAAI,GAAGC;YACpB,EAAE,OAAO1E,OAAO;gBACdwE,UAAU,CAACC,IAAI,GAAG,CAAC,mBAAmB,EAAE,OAAOC,MAAM,CAAC,CAAC;YACzD;QACF;QAEA,OAAOF;IACT;IAKAlC,iBAAiBD,OAAO,EAAE;QACxB,IAAI,CAACA,WAAW,OAAOA,YAAY,UAAU,OAAOA;QAEpD,MAAMwC,YAAY,CAAC;QAEnB,KAAK,MAAM,CAACJ,KAAKC,MAAM,IAAIC,OAAOC,OAAO,CAACvC,SAAU;YAClD,IAAI,OAAOqC,UAAU,YAAY;gBAC/BG,SAAS,CAACJ,IAAI,GAAG;YACnB,OAAO,IAAI,OAAOC,UAAU,UAAU;gBACpCG,SAAS,CAACJ,IAAI,GAAG,CAAC,SAAS,EAAEC,MAAMI,QAAQ,GAAG,CAAC,CAAC;YAClD,OAAO,IAAIJ,iBAAiBK,OAAO;gBACjCF,SAAS,CAACJ,IAAI,GAAG;oBACfhD,MAAMiD,MAAMjD,IAAI;oBAChBxB,SAASyE,MAAMzE,OAAO;oBACtB+E,OAAON,MAAMM,KAAK;gBACpB;YACF,OAAO;gBACL,IAAI;oBACFpD,KAAKI,SAAS,CAAC0C;oBACfG,SAAS,CAACJ,IAAI,GAAGC;gBACnB,EAAE,OAAO1E,OAAO;oBACd6E,SAAS,CAACJ,IAAI,GAAG,CAAC,mBAAmB,EAAE,OAAOC,MAAM,CAAC,CAAC;gBACxD;YACF;QACF;QAEA,OAAOG;IACT;IAKAI,WAAW;QACT,OAAO;YACLlF,oBAAoB,IAAI,CAACtB,UAAU,CAACD,OAAO,CAACK,iBAAiB;YAC7DE,sBAAsB,IAAI,CAACA,oBAAoB;YAC/CD,UAAU,IAAI,CAACL,UAAU,CAACD,OAAO,CAACM,QAAQ;YAC1CoG,mBAAmB,IAAI,CAAClG,gBAAgB;YACxCmG,kBAAkB,IAAI,CAAClG,eAAe;QACxC;IACF;AACF;AAKA,OAAO,SAASmG,gCAAgC5G,UAAU,CAAC,CAAC;IAC1D,OAAO,IAAID,kBAAkBC;AAC/B;AAKA,OAAO,MAAM6G,oBAAoB,IAAI9G,oBAAoB;AAEzD,eAAeA,kBAAkB"}