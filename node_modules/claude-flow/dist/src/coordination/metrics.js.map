{"version":3,"sources":["../../../src/coordination/metrics.ts"],"sourcesContent":["/**\n * Metrics and monitoring for coordination performance\n */\n\nimport type { ILogger } from '../core/logger.js';\nimport type { IEventBus } from '../core/event-bus.js';\nimport { SystemEvents } from '../utils/types.js';\n\nexport interface CoordinationMetrics {\n  timestamp: Date;\n\n  // Task metrics\n  taskMetrics: {\n    totalTasks: number;\n    activeTasks: number;\n    completedTasks: number;\n    failedTasks: number;\n    cancelledTasks: number;\n    avgTaskDuration: number;\n    taskThroughput: number; // tasks/minute\n    tasksByPriority: Record<string, number>;\n    tasksByType: Record<string, number>;\n  };\n\n  // Agent metrics\n  agentMetrics: {\n    totalAgents: number;\n    activeAgents: number;\n    idleAgents: number;\n    busyAgents: number;\n    agentUtilization: number; // percentage\n    avgTasksPerAgent: number;\n    agentsByType: Record<string, number>;\n  };\n\n  // Resource metrics\n  resourceMetrics: {\n    totalResources: number;\n    lockedResources: number;\n    freeResources: number;\n    resourceUtilization: number; // percentage\n    avgLockDuration: number;\n    lockContention: number; // waiting requests\n    deadlockCount: number;\n  };\n\n  // Coordination metrics\n  coordinationMetrics: {\n    messagesSent: number;\n    messagesReceived: number;\n    messageLatency: number; // avg ms\n    conflictsDetected: number;\n    conflictsResolved: number;\n    workStealingEvents: number;\n    circuitBreakerTrips: number;\n  };\n\n  // Performance metrics\n  performanceMetrics: {\n    coordinationLatency: number; // avg ms\n    schedulingLatency: number; // avg ms\n    memoryUsage: number; // MB\n    cpuUsage: number; // percentage\n    errorRate: number; // errors/minute\n  };\n}\n\nexport interface MetricsSample {\n  timestamp: Date;\n  metric: string;\n  value: number;\n  tags?: Record<string, string>;\n}\n\n/**\n * Metrics collector for coordination system\n */\nexport class CoordinationMetricsCollector {\n  private samples: MetricsSample[] = [];\n  private taskStartTimes = new Map<string, Date>();\n  private messageStartTimes = new Map<string, Date>();\n  private lockStartTimes = new Map<string, Date>();\n  private collectionInterval?: number;\n\n  // Counters\n  private counters = {\n    totalTasks: 0,\n    completedTasks: 0,\n    failedTasks: 0,\n    cancelledTasks: 0,\n    messagesSent: 0,\n    messagesReceived: 0,\n    conflictsDetected: 0,\n    conflictsResolved: 0,\n    workStealingEvents: 0,\n    circuitBreakerTrips: 0,\n    deadlockCount: 0,\n    errors: 0,\n  };\n\n  // Gauges\n  private gauges = {\n    activeTasks: 0,\n    activeAgents: 0,\n    idleAgents: 0,\n    busyAgents: 0,\n    lockedResources: 0,\n    freeResources: 0,\n    lockContention: 0,\n  };\n\n  // Histograms (for calculating averages)\n  private histograms = {\n    taskDurations: [] as number[],\n    messageDurations: [] as number[],\n    lockDurations: [] as number[],\n    coordinationLatencies: [] as number[],\n    schedulingLatencies: [] as number[],\n  };\n\n  constructor(\n    private logger: ILogger,\n    private eventBus: IEventBus,\n    private collectionIntervalMs = 30000, // 30 seconds\n  ) {\n    this.setupEventHandlers();\n  }\n\n  /**\n   * Start metrics collection\n   */\n  start(): void {\n    this.logger.info('Starting coordination metrics collection');\n\n    this.collectionInterval = setInterval(() => {\n      this.collectMetrics();\n    }, this.collectionIntervalMs);\n  }\n\n  /**\n   * Stop metrics collection\n   */\n  stop(): void {\n    if (this.collectionInterval) {\n      clearInterval(this.collectionInterval);\n      delete this.collectionInterval;\n    }\n\n    this.logger.info('Stopped coordination metrics collection');\n  }\n\n  /**\n   * Record a metric sample\n   */\n  recordMetric(metric: string, value: number, tags?: Record<string, string>): void {\n    const sample: MetricsSample = {\n      timestamp: new Date(),\n      metric,\n      value,\n    };\n\n    if (tags !== undefined) {\n      sample.tags = tags;\n    }\n\n    this.samples.push(sample);\n\n    // Keep only last 10000 samples to prevent memory bloat\n    if (this.samples.length > 10000) {\n      this.samples = this.samples.slice(-5000);\n    }\n  }\n\n  /**\n   * Get current metrics snapshot\n   */\n  getCurrentMetrics(): CoordinationMetrics {\n    const now = new Date();\n    const minuteAgo = new Date(now.getTime() - 60000);\n\n    // Calculate throughput (items per minute)\n    const recentSamples = this.samples.filter((s) => s.timestamp >= minuteAgo);\n    const taskCompletions = recentSamples.filter((s) => s.metric === 'task.completed').length;\n    const errorCount = recentSamples.filter((s) => s.metric === 'error').length;\n\n    return {\n      timestamp: now,\n\n      taskMetrics: {\n        totalTasks: this.counters.totalTasks,\n        activeTasks: this.gauges.activeTasks,\n        completedTasks: this.counters.completedTasks,\n        failedTasks: this.counters.failedTasks,\n        cancelledTasks: this.counters.cancelledTasks,\n        avgTaskDuration: this.average(this.histograms.taskDurations),\n        taskThroughput: taskCompletions,\n        tasksByPriority: this.getTasksByPriority(),\n        tasksByType: this.getTasksByType(),\n      },\n\n      agentMetrics: {\n        totalAgents: this.gauges.activeAgents + this.gauges.idleAgents,\n        activeAgents: this.gauges.activeAgents,\n        idleAgents: this.gauges.idleAgents,\n        busyAgents: this.gauges.busyAgents,\n        agentUtilization: this.calculateAgentUtilization(),\n        avgTasksPerAgent: this.calculateAvgTasksPerAgent(),\n        agentsByType: this.getAgentsByType(),\n      },\n\n      resourceMetrics: {\n        totalResources: this.gauges.lockedResources + this.gauges.freeResources,\n        lockedResources: this.gauges.lockedResources,\n        freeResources: this.gauges.freeResources,\n        resourceUtilization: this.calculateResourceUtilization(),\n        avgLockDuration: this.average(this.histograms.lockDurations),\n        lockContention: this.gauges.lockContention,\n        deadlockCount: this.counters.deadlockCount,\n      },\n\n      coordinationMetrics: {\n        messagesSent: this.counters.messagesSent,\n        messagesReceived: this.counters.messagesReceived,\n        messageLatency: this.average(this.histograms.messageDurations),\n        conflictsDetected: this.counters.conflictsDetected,\n        conflictsResolved: this.counters.conflictsResolved,\n        workStealingEvents: this.counters.workStealingEvents,\n        circuitBreakerTrips: this.counters.circuitBreakerTrips,\n      },\n\n      performanceMetrics: {\n        coordinationLatency: this.average(this.histograms.coordinationLatencies),\n        schedulingLatency: this.average(this.histograms.schedulingLatencies),\n        memoryUsage: this.getMemoryUsage(),\n        cpuUsage: this.getCpuUsage(),\n        errorRate: errorCount,\n      },\n    };\n  }\n\n  /**\n   * Get metric history for a specific metric\n   */\n  getMetricHistory(metric: string, since?: Date): MetricsSample[] {\n    const cutoff = since || new Date(Date.now() - 3600000); // 1 hour ago\n\n    return this.samples.filter((s) => s.metric === metric && s.timestamp >= cutoff);\n  }\n\n  /**\n   * Get top metrics by value\n   */\n  getTopMetrics(limit = 10): Array<{ metric: string; value: number; timestamp: Date }> {\n    const recent = this.samples.filter(\n      (s) => s.timestamp >= new Date(Date.now() - 300000), // 5 minutes\n    );\n\n    const byMetric = new Map<string, number>();\n    const timestamps = new Map<string, Date>();\n\n    for (const sample of recent) {\n      byMetric.set(sample.metric, (byMetric.get(sample.metric) || 0) + sample.value);\n      timestamps.set(sample.metric, sample.timestamp);\n    }\n\n    return Array.from(byMetric.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, limit)\n      .map(([metric, value]) => ({\n        metric,\n        value,\n        timestamp: timestamps.get(metric)!,\n      }));\n  }\n\n  /**\n   * Set up event handlers to collect metrics\n   */\n  private setupEventHandlers(): void {\n    // Task events\n    this.eventBus.on(SystemEvents.TASK_CREATED, () => {\n      this.counters.totalTasks++;\n      this.recordMetric('task.created', 1);\n    });\n\n    this.eventBus.on(SystemEvents.TASK_STARTED, (data: any) => {\n      this.taskStartTimes.set(data.taskId, new Date());\n      this.gauges.activeTasks++;\n      this.recordMetric('task.started', 1);\n    });\n\n    this.eventBus.on(SystemEvents.TASK_COMPLETED, (data: any) => {\n      this.counters.completedTasks++;\n      this.gauges.activeTasks = Math.max(0, this.gauges.activeTasks - 1);\n\n      const startTime = this.taskStartTimes.get(data.taskId);\n      if (startTime) {\n        const duration = new Date().getTime() - startTime.getTime();\n        this.histograms.taskDurations.push(duration);\n        this.taskStartTimes.delete(data.taskId);\n      }\n\n      this.recordMetric('task.completed', 1);\n    });\n\n    this.eventBus.on(SystemEvents.TASK_FAILED, (data: any) => {\n      this.counters.failedTasks++;\n      this.gauges.activeTasks = Math.max(0, this.gauges.activeTasks - 1);\n      this.taskStartTimes.delete(data.taskId);\n      this.recordMetric('task.failed', 1);\n    });\n\n    this.eventBus.on(SystemEvents.TASK_CANCELLED, (data: any) => {\n      this.counters.cancelledTasks++;\n      this.gauges.activeTasks = Math.max(0, this.gauges.activeTasks - 1);\n      this.taskStartTimes.delete(data.taskId);\n      this.recordMetric('task.cancelled', 1);\n    });\n\n    // Agent events\n    this.eventBus.on(SystemEvents.AGENT_SPAWNED, () => {\n      this.gauges.activeAgents++;\n      this.recordMetric('agent.spawned', 1);\n    });\n\n    this.eventBus.on(SystemEvents.AGENT_TERMINATED, () => {\n      this.gauges.activeAgents = Math.max(0, this.gauges.activeAgents - 1);\n      this.recordMetric('agent.terminated', 1);\n    });\n\n    this.eventBus.on(SystemEvents.AGENT_IDLE, () => {\n      this.gauges.idleAgents++;\n      this.gauges.busyAgents = Math.max(0, this.gauges.busyAgents - 1);\n      this.recordMetric('agent.idle', 1);\n    });\n\n    this.eventBus.on(SystemEvents.AGENT_ACTIVE, () => {\n      this.gauges.busyAgents++;\n      this.gauges.idleAgents = Math.max(0, this.gauges.idleAgents - 1);\n      this.recordMetric('agent.active', 1);\n    });\n\n    // Resource events\n    this.eventBus.on(SystemEvents.RESOURCE_ACQUIRED, (data: any) => {\n      this.lockStartTimes.set(data.resourceId, new Date());\n      this.gauges.lockedResources++;\n      this.gauges.freeResources = Math.max(0, this.gauges.freeResources - 1);\n      this.recordMetric('resource.acquired', 1);\n    });\n\n    this.eventBus.on(SystemEvents.RESOURCE_RELEASED, (data: any) => {\n      this.gauges.freeResources++;\n      this.gauges.lockedResources = Math.max(0, this.gauges.lockedResources - 1);\n\n      const startTime = this.lockStartTimes.get(data.resourceId);\n      if (startTime) {\n        const duration = new Date().getTime() - startTime.getTime();\n        this.histograms.lockDurations.push(duration);\n        this.lockStartTimes.delete(data.resourceId);\n      }\n\n      this.recordMetric('resource.released', 1);\n    });\n\n    // Deadlock events\n    this.eventBus.on(SystemEvents.DEADLOCK_DETECTED, () => {\n      this.counters.deadlockCount++;\n      this.recordMetric('deadlock.detected', 1);\n    });\n\n    // Message events\n    this.eventBus.on(SystemEvents.MESSAGE_SENT, (data: any) => {\n      this.counters.messagesSent++;\n      this.messageStartTimes.set(data.message.id, new Date());\n      this.recordMetric('message.sent', 1);\n    });\n\n    this.eventBus.on(SystemEvents.MESSAGE_RECEIVED, (data: any) => {\n      this.counters.messagesReceived++;\n\n      const startTime = this.messageStartTimes.get(data.message.id);\n      if (startTime) {\n        const duration = new Date().getTime() - startTime.getTime();\n        this.histograms.messageDurations.push(duration);\n        this.messageStartTimes.delete(data.message.id);\n      }\n\n      this.recordMetric('message.received', 1);\n    });\n\n    // Conflict events\n    this.eventBus.on('conflict:resource', () => {\n      this.counters.conflictsDetected++;\n      this.recordMetric('conflict.detected', 1);\n    });\n\n    this.eventBus.on('conflict:resolved', () => {\n      this.counters.conflictsResolved++;\n      this.recordMetric('conflict.resolved', 1);\n    });\n\n    // Work stealing events\n    this.eventBus.on('workstealing:request', () => {\n      this.counters.workStealingEvents++;\n      this.recordMetric('workstealing.event', 1);\n    });\n\n    // Circuit breaker events\n    this.eventBus.on('circuitbreaker:state-change', (data: any) => {\n      if (data.to === 'open') {\n        this.counters.circuitBreakerTrips++;\n        this.recordMetric('circuitbreaker.trip', 1);\n      }\n    });\n\n    // Error events\n    this.eventBus.on(SystemEvents.SYSTEM_ERROR, () => {\n      this.counters.errors++;\n      this.recordMetric('error', 1);\n    });\n  }\n\n  /**\n   * Collect comprehensive metrics\n   */\n  private collectMetrics(): void {\n    const metrics = this.getCurrentMetrics();\n\n    // Emit metrics event\n    this.eventBus.emit('metrics:coordination', metrics);\n\n    // Log summary\n    this.logger.debug('Coordination metrics collected', {\n      activeTasks: metrics.taskMetrics.activeTasks,\n      activeAgents: metrics.agentMetrics.activeAgents,\n      lockedResources: metrics.resourceMetrics.lockedResources,\n      taskThroughput: metrics.taskMetrics.taskThroughput,\n    });\n  }\n\n  /**\n   * Calculate average from array of numbers\n   */\n  private average(values: number[]): number {\n    if (values.length === 0) return 0;\n    return values.reduce((sum, val) => sum + val, 0) / values.length;\n  }\n\n  /**\n   * Get tasks grouped by priority\n   */\n  private getTasksByPriority(): Record<string, number> {\n    const priorities = ['low', 'medium', 'high', 'critical'];\n    const result: Record<string, number> = {};\n\n    for (const priority of priorities) {\n      result[priority] = this.samples.filter(\n        (s) => s.metric === 'task.created' && s.tags?.priority === priority,\n      ).length;\n    }\n\n    return result;\n  }\n\n  /**\n   * Get tasks grouped by type\n   */\n  private getTasksByType(): Record<string, number> {\n    const types = new Set<string>();\n\n    for (const sample of this.samples) {\n      if (sample.metric === 'task.created' && sample.tags?.type) {\n        types.add(sample.tags.type);\n      }\n    }\n\n    const result: Record<string, number> = {};\n    for (const type of types) {\n      result[type] = this.samples.filter(\n        (s) => s.metric === 'task.created' && s.tags?.type === type,\n      ).length;\n    }\n\n    return result;\n  }\n\n  /**\n   * Get agents grouped by type\n   */\n  private getAgentsByType(): Record<string, number> {\n    const types = new Set<string>();\n\n    for (const sample of this.samples) {\n      if (sample.metric === 'agent.spawned' && sample.tags?.type) {\n        types.add(sample.tags.type);\n      }\n    }\n\n    const result: Record<string, number> = {};\n    for (const type of types) {\n      result[type] = this.samples.filter(\n        (s) => s.metric === 'agent.spawned' && s.tags?.type === type,\n      ).length;\n    }\n\n    return result;\n  }\n\n  /**\n   * Calculate agent utilization percentage\n   */\n  private calculateAgentUtilization(): number {\n    const totalAgents = this.gauges.activeAgents + this.gauges.idleAgents;\n    if (totalAgents === 0) return 0;\n    return (this.gauges.busyAgents / totalAgents) * 100;\n  }\n\n  /**\n   * Calculate average tasks per agent\n   */\n  private calculateAvgTasksPerAgent(): number {\n    const totalAgents = this.gauges.activeAgents + this.gauges.idleAgents;\n    if (totalAgents === 0) return 0;\n    return this.gauges.activeTasks / totalAgents;\n  }\n\n  /**\n   * Calculate resource utilization percentage\n   */\n  private calculateResourceUtilization(): number {\n    const totalResources = this.gauges.lockedResources + this.gauges.freeResources;\n    if (totalResources === 0) return 0;\n    return (this.gauges.lockedResources / totalResources) * 100;\n  }\n\n  /**\n   * Get current memory usage in MB\n   */\n  private getMemoryUsage(): number {\n    if (typeof process !== 'undefined' && process.memoryUsage) {\n      return process.memoryUsage().heapUsed / 1024 / 1024;\n    }\n    return 0;\n  }\n\n  /**\n   * Get current CPU usage percentage\n   */\n  private getCpuUsage(): number {\n    if (typeof process !== 'undefined' && process.cpuUsage) {\n      const usage = process.cpuUsage();\n      return (usage.user + usage.system) / 1000000; // Convert to seconds\n    }\n    return 0;\n  }\n\n  /**\n   * Clear all metrics data\n   */\n  clearMetrics(): void {\n    this.samples = [];\n    this.taskStartTimes.clear();\n    this.messageStartTimes.clear();\n    this.lockStartTimes.clear();\n\n    // Reset counters\n    for (const key in this.counters) {\n      (this.counters as any)[key] = 0;\n    }\n\n    // Reset gauges\n    for (const key in this.gauges) {\n      (this.gauges as any)[key] = 0;\n    }\n\n    // Clear histograms\n    for (const key in this.histograms) {\n      (this.histograms as any)[key] = [];\n    }\n\n    this.logger.info('Coordination metrics cleared');\n  }\n}\n"],"names":["SystemEvents","CoordinationMetricsCollector","samples","taskStartTimes","Map","messageStartTimes","lockStartTimes","collectionInterval","counters","totalTasks","completedTasks","failedTasks","cancelledTasks","messagesSent","messagesReceived","conflictsDetected","conflictsResolved","workStealingEvents","circuitBreakerTrips","deadlockCount","errors","gauges","activeTasks","activeAgents","idleAgents","busyAgents","lockedResources","freeResources","lockContention","histograms","taskDurations","messageDurations","lockDurations","coordinationLatencies","schedulingLatencies","logger","eventBus","collectionIntervalMs","setupEventHandlers","start","info","setInterval","collectMetrics","stop","clearInterval","recordMetric","metric","value","tags","sample","timestamp","Date","undefined","push","length","slice","getCurrentMetrics","now","minuteAgo","getTime","recentSamples","filter","s","taskCompletions","errorCount","taskMetrics","avgTaskDuration","average","taskThroughput","tasksByPriority","getTasksByPriority","tasksByType","getTasksByType","agentMetrics","totalAgents","agentUtilization","calculateAgentUtilization","avgTasksPerAgent","calculateAvgTasksPerAgent","agentsByType","getAgentsByType","resourceMetrics","totalResources","resourceUtilization","calculateResourceUtilization","avgLockDuration","coordinationMetrics","messageLatency","performanceMetrics","coordinationLatency","schedulingLatency","memoryUsage","getMemoryUsage","cpuUsage","getCpuUsage","errorRate","getMetricHistory","since","cutoff","getTopMetrics","limit","recent","byMetric","timestamps","set","get","Array","from","entries","sort","a","b","map","on","TASK_CREATED","TASK_STARTED","data","taskId","TASK_COMPLETED","Math","max","startTime","duration","delete","TASK_FAILED","TASK_CANCELLED","AGENT_SPAWNED","AGENT_TERMINATED","AGENT_IDLE","AGENT_ACTIVE","RESOURCE_ACQUIRED","resourceId","RESOURCE_RELEASED","DEADLOCK_DETECTED","MESSAGE_SENT","message","id","MESSAGE_RECEIVED","to","SYSTEM_ERROR","metrics","emit","debug","values","reduce","sum","val","priorities","result","priority","types","Set","type","add","process","heapUsed","usage","user","system","clearMetrics","clear","key"],"mappings":"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"}