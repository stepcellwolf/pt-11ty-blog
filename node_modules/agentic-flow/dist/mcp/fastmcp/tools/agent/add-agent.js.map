{"version":3,"file":"add-agent.js","sourceRoot":"","sources":["../../../../../src/mcp/fastmcp/tools/agent/add-agent.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\nimport { ToolDefinition, ToolContext } from '../../types/index.js';\nimport { writeFileSync, existsSync, mkdirSync } from 'fs';\nimport { join } from 'path';\n\nconst addAgentSchema = z.object({\n  name: z.string().describe('Agent name (kebab-case, e.g., custom-researcher)'),\n  description: z.string().describe('Agent description'),\n  systemPrompt: z.string().describe('System prompt/instructions for the agent'),\n  category: z.string().optional().default('custom').describe('Agent category'),\n  capabilities: z.array(z.string()).optional().describe('Agent capabilities/features'),\n  outputFormat: z.string().optional().describe('Expected output format')\n});\n\nexport const addAgentTool: ToolDefinition = {\n  name: 'agent_add',\n  description: 'Add a new custom agent defined in markdown format',\n  parameters: addAgentSchema,\n\n  async execute({ name, description, systemPrompt, category, capabilities, outputFormat }: z.infer<typeof addAgentSchema>, { onProgress }: ToolContext) {\n    try {\n      onProgress?.({ progress: 0.2, message: `Creating custom agent: ${name}` });\n\n      // Validate name format\n      if (!/^[a-z0-9-]+$/.test(name)) {\n        throw new Error('Agent name must be kebab-case (lowercase, numbers, hyphens only)');\n      }\n\n      // Create agents directory if it doesn't exist\n      const agentsDir = join(process.cwd(), '.claude', 'agents', category);\n      if (!existsSync(agentsDir)) {\n        mkdirSync(agentsDir, { recursive: true });\n      }\n\n      onProgress?.({ progress: 0.4, message: 'Generating agent markdown...' });\n\n      // Generate markdown content\n      const markdown = `# ${name.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}\n\n## Description\n${description}\n\n## System Prompt\n${systemPrompt}\n\n${capabilities && capabilities.length > 0 ? `## Capabilities\n${capabilities.map(c => `- ${c}`).join('\\n')}\n` : ''}\n\n${outputFormat ? `## Output Format\n${outputFormat}\n` : ''}\n\n## Usage\n\\`\\`\\`bash\nnpx agentic-flow --agent ${name} --task \"Your task here\"\n\\`\\`\\`\n\n## MCP Tool Usage\n\\`\\`\\`json\n{\n  \"name\": \"agent_execute\",\n  \"arguments\": {\n    \"agent\": \"${name}\",\n    \"task\": \"Your task here\",\n    \"stream\": false\n  }\n}\n\\`\\`\\`\n\n---\n*Generated: ${new Date().toISOString()}*\n*Category: ${category}*\n`;\n\n      const filePath = join(agentsDir, `${name}.md`);\n\n      // Check if agent already exists\n      if (existsSync(filePath)) {\n        throw new Error(`Agent '${name}' already exists at ${filePath}`);\n      }\n\n      onProgress?.({ progress: 0.7, message: 'Writing agent file...' });\n\n      // Write the markdown file\n      writeFileSync(filePath, markdown, 'utf8');\n\n      onProgress?.({ progress: 1.0, message: 'Agent created successfully' });\n\n      return {\n        content: [{\n          type: 'text',\n          text: JSON.stringify({\n            success: true,\n            agent: name,\n            category,\n            filePath,\n            description,\n            capabilities: capabilities || [],\n            message: `Agent '${name}' created successfully at ${filePath}`,\n            timestamp: new Date().toISOString()\n          }, null, 2)\n        }]\n      };\n    } catch (error: any) {\n      return {\n        content: [{\n          type: 'text',\n          text: JSON.stringify({\n            success: false,\n            agent: name,\n            error: error.message,\n            timestamp: new Date().toISOString()\n          }, null, 2)\n        }],\n        isError: true\n      };\n    }\n  }\n};\n"]}