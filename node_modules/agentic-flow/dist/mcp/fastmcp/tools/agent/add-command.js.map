{"version":3,"file":"add-command.js","sourceRoot":"","sources":["../../../../../src/mcp/fastmcp/tools/agent/add-command.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\nimport { ToolDefinition, ToolContext } from '../../types/index.js';\nimport { writeFileSync, existsSync, mkdirSync } from 'fs';\nimport { join } from 'path';\n\nconst addCommandSchema = z.object({\n  name: z.string().describe('Command name (kebab-case, e.g., custom-deploy)'),\n  description: z.string().describe('Command description'),\n  usage: z.string().describe('Command usage example'),\n  parameters: z.array(z.object({\n    name: z.string(),\n    type: z.string(),\n    required: z.boolean(),\n    description: z.string()\n  })).optional().describe('Command parameters'),\n  examples: z.array(z.string()).optional().describe('Usage examples'),\n  notes: z.string().optional().describe('Additional notes or warnings')\n});\n\nexport const addCommandTool: ToolDefinition = {\n  name: 'command_add',\n  description: 'Add a new custom command defined in markdown format',\n  parameters: addCommandSchema,\n\n  async execute({ name, description, usage, parameters, examples, notes }: z.infer<typeof addCommandSchema>, { onProgress }: ToolContext) {\n    try {\n      onProgress?.({ progress: 0.2, message: `Creating custom command: ${name}` });\n\n      // Validate name format\n      if (!/^[a-z0-9-]+$/.test(name)) {\n        throw new Error('Command name must be kebab-case (lowercase, numbers, hyphens only)');\n      }\n\n      // Create commands directory if it doesn't exist\n      const commandsDir = join(process.cwd(), '.claude', 'commands');\n      if (!existsSync(commandsDir)) {\n        mkdirSync(commandsDir, { recursive: true });\n      }\n\n      onProgress?.({ progress: 0.4, message: 'Generating command markdown...' });\n\n      // Generate markdown content\n      const markdown = `# ${name.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')} Command\n\n## Description\n${description}\n\n## Usage\n\\`\\`\\`bash\n${usage}\n\\`\\`\\`\n\n${parameters && parameters.length > 0 ? `## Parameters\n| Name | Type | Required | Description |\n|------|------|----------|-------------|\n${parameters.map(p => `| \\`${p.name}\\` | ${p.type} | ${p.required ? 'Yes' : 'No'} | ${p.description} |`).join('\\n')}\n` : ''}\n\n${examples && examples.length > 0 ? `## Examples\n\n${examples.map((ex, i) => `### Example ${i + 1}\n\\`\\`\\`bash\n${ex}\n\\`\\`\\`\n`).join('\\n')}` : ''}\n\n${notes ? `## Notes\n${notes}\n` : ''}\n\n## MCP Tool Usage\n\\`\\`\\`json\n{\n  \"name\": \"command_execute\",\n  \"arguments\": {\n    \"command\": \"${name}\",\n    \"args\": []\n  }\n}\n\\`\\`\\`\n\n---\n*Generated: ${new Date().toISOString()}*\n`;\n\n      const filePath = join(commandsDir, `${name}.md`);\n\n      // Check if command already exists\n      if (existsSync(filePath)) {\n        throw new Error(`Command '${name}' already exists at ${filePath}`);\n      }\n\n      onProgress?.({ progress: 0.7, message: 'Writing command file...' });\n\n      // Write the markdown file\n      writeFileSync(filePath, markdown, 'utf8');\n\n      onProgress?.({ progress: 1.0, message: 'Command created successfully' });\n\n      return {\n        content: [{\n          type: 'text',\n          text: JSON.stringify({\n            success: true,\n            command: name,\n            filePath,\n            description,\n            parameters: parameters || [],\n            examples: examples || [],\n            message: `Command '${name}' created successfully at ${filePath}`,\n            timestamp: new Date().toISOString()\n          }, null, 2)\n        }]\n      };\n    } catch (error: any) {\n      return {\n        content: [{\n          type: 'text',\n          text: JSON.stringify({\n            success: false,\n            command: name,\n            error: error.message,\n            timestamp: new Date().toISOString()\n          }, null, 2)\n        }],\n        isError: true\n      };\n    }\n  }\n};\n"]}