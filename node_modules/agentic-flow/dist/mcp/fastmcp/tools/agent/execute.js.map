{"version":3,"file":"execute.js","sourceRoot":"","sources":["../../../../../src/mcp/fastmcp/tools/agent/execute.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AAExB,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AAEzC,MAAM,kBAAkB,GAAG,CAAC,CAAC,MAAM,CAAC;IAClC,KAAK,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,2DAA2D,CAAC;IACvF,IAAI,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,gCAAgC,CAAC;IAC3D,MAAM,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,mCAAmC,CAAC;CAC5F,CAAC,CAAC;AAEH,MAAM,CAAC,MAAM,gBAAgB,GAAmB;IAC9C,IAAI,EAAE,eAAe;IACrB,WAAW,EAAE,0EAA0E;IACvF,UAAU,EAAE,kBAAkB;IAE9B,KAAK,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAsC,EAAE,EAAE,UAAU,EAAe;QACpG,IAAI,CAAC;YACH,UAAU,EAAE,CAAC,EAAE,QAAQ,EAAE,GAAG,EAAE,OAAO,EAAE,mBAAmB,KAAK,EAAE,EAAE,CAAC,CAAC;YAErE,gBAAgB;YAChB,MAAM,UAAU,GAAG,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC;YAC5C,MAAM,GAAG,GAAG,6BAA6B,KAAK,aAAa,IAAI,KAAK,UAAU,EAAE,CAAC,IAAI,EAAE,CAAC;YAExF,UAAU,EAAE,CAAC,EAAE,QAAQ,EAAE,GAAG,EAAE,OAAO,EAAE,oBAAoB,EAAE,CAAC,CAAC;YAE/D,0CAA0C;YAC1C,MAAM,MAAM,GAAG,QAAQ,CAAC,GAAG,EAAE;gBAC3B,QAAQ,EAAE,MAAM;gBAChB,SAAS,EAAE,EAAE,GAAG,IAAI,GAAG,IAAI,EAAE,cAAc;gBAC3C,OAAO,EAAE,MAAM,EAAE,mBAAmB;gBACpC,GAAG,EAAE,EAAE,GAAG,OAAO,CAAC,GAAG,EAAE;aACxB,CAAC,CAAC;YAEH,UAAU,EAAE,CAAC,EAAE,QAAQ,EAAE,GAAG,EAAE,OAAO,EAAE,2BAA2B,EAAE,CAAC,CAAC;YAEtE,OAAO;gBACL,OAAO,EAAE,CAAC;wBACR,IAAI,EAAE,MAAM;wBACZ,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;4BACnB,OAAO,EAAE,IAAI;4BACb,KAAK;4BACL,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC;4BAC5B,MAAM,EAAE,MAAM;4BACd,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;yBACpC,EAAE,IAAI,EAAE,CAAC,CAAC;qBACZ,CAAC;aACH,CAAC;QACJ,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,OAAO;gBACL,OAAO,EAAE,CAAC;wBACR,IAAI,EAAE,MAAM;wBACZ,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;4BACnB,OAAO,EAAE,KAAK;4BACd,KAAK;4BACL,KAAK,EAAE,KAAK,CAAC,OAAO;4BACpB,MAAM,EAAE,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE;4BAChC,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;yBACpC,EAAE,IAAI,EAAE,CAAC,CAAC;qBACZ,CAAC;gBACF,OAAO,EAAE,IAAI;aACd,CAAC;QACJ,CAAC;IACH,CAAC;CACF,CAAC","sourcesContent":["import { z } from 'zod';\nimport { ToolDefinition, ToolContext } from '../../types/index.js';\nimport { execSync } from 'child_process';\n\nconst executeAgentSchema = z.object({\n  agent: z.string().describe('Agent name to execute (e.g., coder, researcher, reviewer)'),\n  task: z.string().describe('Task description for the agent'),\n  stream: z.boolean().optional().default(false).describe('Enable real-time streaming output')\n});\n\nexport const executeAgentTool: ToolDefinition = {\n  name: 'agent_execute',\n  description: 'Execute a specific agent with a task (equivalent to --agent CLI command)',\n  parameters: executeAgentSchema,\n\n  async execute({ agent, task, stream }: z.infer<typeof executeAgentSchema>, { onProgress }: ToolContext) {\n    try {\n      onProgress?.({ progress: 0.1, message: `Starting agent: ${agent}` });\n\n      // Build command\n      const streamFlag = stream ? '--stream' : '';\n      const cmd = `npx agentic-flow --agent \"${agent}\" --task \"${task}\" ${streamFlag}`.trim();\n\n      onProgress?.({ progress: 0.3, message: 'Executing agent...' });\n\n      // Execute with timeout and capture output\n      const result = execSync(cmd, {\n        encoding: 'utf8',\n        maxBuffer: 10 * 1024 * 1024, // 10MB buffer\n        timeout: 300000, // 5 minute timeout\n        env: { ...process.env }\n      });\n\n      onProgress?.({ progress: 1.0, message: 'Agent execution completed' });\n\n      return {\n        content: [{\n          type: 'text',\n          text: JSON.stringify({\n            success: true,\n            agent,\n            task: task.substring(0, 100),\n            output: result,\n            timestamp: new Date().toISOString()\n          }, null, 2)\n        }]\n      };\n    } catch (error: any) {\n      return {\n        content: [{\n          type: 'text',\n          text: JSON.stringify({\n            success: false,\n            agent,\n            error: error.message,\n            stderr: error.stderr?.toString(),\n            timestamp: new Date().toISOString()\n          }, null, 2)\n        }],\n        isError: true\n      };\n    }\n  }\n};\n"]}