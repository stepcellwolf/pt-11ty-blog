{"version":3,"file":"cli-standalone-proxy.js","sourceRoot":"","sources":["../src/cli-standalone-proxy.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n/**\n * Agentic Flow - Standalone Anthropic Proxy Server\n *\n * Run Gemini, OpenRouter, or other providers through an Anthropic-compatible proxy\n * for use with Claude Code, Cursor, and other tools that support ANTHROPIC_BASE_URL\n *\n * Usage:\n *   npx agentic-flow proxy --provider gemini --port 3000\n *   npx agentic-flow proxy --provider openrouter --model \"openai/gpt-4o-mini\" --port 3000\n *\n * Then in Claude Code or Cursor:\n *   export ANTHROPIC_BASE_URL=http://localhost:3000\n *   export ANTHROPIC_API_KEY=sk-ant-proxy-dummy-key  # Any value works\n */\n\nimport dotenv from 'dotenv';\nimport { parseArgs } from 'util';\nimport { AnthropicToGeminiProxy } from './proxy/anthropic-to-gemini.js';\nimport { AnthropicToOpenRouterProxy } from './proxy/anthropic-to-openrouter.js';\n\n// Load environment variables\ndotenv.config();\n\ninterface ProxyOptions {\n  provider: 'gemini' | 'openrouter';\n  port: number;\n  model?: string;\n}\n\nfunction parseArguments(): ProxyOptions {\n  const { values } = parseArgs({\n    options: {\n      provider: {\n        type: 'string',\n        short: 'p',\n        default: 'gemini'\n      },\n      port: {\n        type: 'string',\n        short: 'P',\n        default: '3000'\n      },\n      model: {\n        type: 'string',\n        short: 'm'\n      },\n      help: {\n        type: 'boolean',\n        short: 'h'\n      }\n    },\n    strict: false,\n    allowPositionals: true\n  });\n\n  if (values.help) {\n    console.log(`\nAgentic Flow - Standalone Anthropic Proxy Server\n\nUSAGE:\n  npx agentic-flow proxy [OPTIONS]\n\nOPTIONS:\n  -p, --provider <provider>   Provider to use (gemini, openrouter) [default: gemini]\n  -P, --port <port>           Port to run proxy on [default: 3000]\n  -m, --model <model>         Model to use (provider-specific)\n  -h, --help                  Show this help message\n\nENVIRONMENT VARIABLES:\n  GOOGLE_GEMINI_API_KEY       Required for Gemini provider\n  OPENROUTER_API_KEY          Required for OpenRouter provider\n  COMPLETION_MODEL            Default model (optional)\n\nEXAMPLES:\n  # Start Gemini proxy on port 3000\n  npx agentic-flow proxy --provider gemini --port 3000\n\n  # Start OpenRouter proxy with GPT-4o-mini\n  npx agentic-flow proxy --provider openrouter --model \"openai/gpt-4o-mini\"\n\n  # Use with Claude Code\n  export ANTHROPIC_BASE_URL=http://localhost:3000\n  export ANTHROPIC_API_KEY=sk-ant-proxy-dummy-key\n  claude  # Claude Code will now use the proxy\n\n  # Use with Cursor (when ANTHROPIC_BASE_URL support is added)\n  export ANTHROPIC_BASE_URL=http://localhost:3000\n  export ANTHROPIC_API_KEY=sk-ant-proxy-dummy-key\n`);\n    process.exit(0);\n  }\n\n  const provider = (values.provider || 'gemini') as 'gemini' | 'openrouter';\n  const port = parseInt(values.port as string || '3000');\n  const model = values.model as string | undefined;\n\n  if (!['gemini', 'openrouter'].includes(provider)) {\n    console.error(`‚ùå Error: Invalid provider \"${provider}\". Must be \"gemini\" or \"openrouter\"`);\n    process.exit(1);\n  }\n\n  if (isNaN(port) || port < 1 || port > 65535) {\n    console.error(`‚ùå Error: Invalid port \"${values.port}\". Must be 1-65535`);\n    process.exit(1);\n  }\n\n  return { provider, port, model };\n}\n\nasync function startProxy(options: ProxyOptions) {\n  console.log(`\n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n‚ïë   Agentic Flow - Standalone Anthropic Proxy Server    ‚ïë\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n`);\n\n  if (options.provider === 'gemini') {\n    const apiKey = process.env.GOOGLE_GEMINI_API_KEY;\n    if (!apiKey) {\n      console.error(`\n‚ùå Error: GOOGLE_GEMINI_API_KEY environment variable required\n\nSet it with:\n  export GOOGLE_GEMINI_API_KEY=your-key-here\n\nOr create a .env file:\n  GOOGLE_GEMINI_API_KEY=your-key-here\n`);\n      process.exit(1);\n    }\n\n    const model = options.model || process.env.COMPLETION_MODEL || 'gemini-2.0-flash-exp';\n\n    console.log(`üöÄ Starting Gemini ‚Üí Anthropic Proxy\nüìç Port: ${options.port}\nü§ñ Model: ${model}\nüîó Gemini API: https://generativelanguage.googleapis.com\n`);\n\n    const proxy = new AnthropicToGeminiProxy({\n      geminiApiKey: apiKey,\n      defaultModel: model\n    });\n\n    proxy.start(options.port);\n\n    console.log(`\n‚úÖ Proxy server running!\n\nConfigure Claude Code:\n  export ANTHROPIC_BASE_URL=http://localhost:${options.port}\n  export ANTHROPIC_API_KEY=sk-ant-proxy-dummy-key\n  claude\n\nConfigure Cursor (when supported):\n  Settings ‚Üí API Keys ‚Üí Anthropic Base URL: http://localhost:${options.port}\n  API Key: sk-ant-proxy-dummy-key\n\nCost Savings: ~85% vs direct Anthropic API\nRate Limits: Gemini free tier = 10 req/min\n`);\n\n  } else if (options.provider === 'openrouter') {\n    const apiKey = process.env.OPENROUTER_API_KEY;\n    if (!apiKey) {\n      console.error(`\n‚ùå Error: OPENROUTER_API_KEY environment variable required\n\nSet it with:\n  export OPENROUTER_API_KEY=sk-or-v1-your-key-here\n\nGet your key at: https://openrouter.ai/keys\n`);\n      process.exit(1);\n    }\n\n    const model = options.model || process.env.COMPLETION_MODEL || 'deepseek/deepseek-chat';\n\n    console.log(`üöÄ Starting OpenRouter ‚Üí Anthropic Proxy\nüìç Port: ${options.port}\nü§ñ Model: ${model}\nüîó OpenRouter API: https://openrouter.ai/api/v1\n`);\n\n    const proxy = new AnthropicToOpenRouterProxy({\n      openrouterApiKey: apiKey,\n      defaultModel: model\n    });\n\n    proxy.start(options.port);\n\n    console.log(`\n‚úÖ Proxy server running!\n\nConfigure Claude Code:\n  export ANTHROPIC_BASE_URL=http://localhost:${options.port}\n  export ANTHROPIC_API_KEY=sk-ant-proxy-dummy-key\n  claude\n\nConfigure Cursor (when supported):\n  Settings ‚Üí API Keys ‚Üí Anthropic Base URL: http://localhost:${options.port}\n  API Key: sk-ant-proxy-dummy-key\n\nCost Savings: ~90% vs direct Anthropic API\nPopular Models:\n  - openai/gpt-4o-mini (fast, cheap)\n  - anthropic/claude-3.5-sonnet (via OpenRouter)\n  - meta-llama/llama-3.1-405b-instruct (OSS)\n`);\n  }\n\n  // Keep process running\n  process.on('SIGINT', () => {\n    console.log('\\n\\nüëã Shutting down proxy server...');\n    process.exit(0);\n  });\n}\n\n// Main execution\nconst options = parseArguments();\nstartProxy(options).catch(error => {\n  console.error('‚ùå Fatal error:', error.message);\n  process.exit(1);\n});\n"]}