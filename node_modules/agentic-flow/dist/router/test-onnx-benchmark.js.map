{"version":3,"file":"test-onnx-benchmark.js","sourceRoot":"","sources":["../../src/router/test-onnx-benchmark.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n/**\n * Comprehensive benchmark for ONNX local inference\n * Tests CPU performance against targets\n */\n\nimport { ONNXLocalProvider } from './providers/onnx-local.js';\n\ninterface BenchmarkResult {\n  test: string;\n  tokens: number;\n  latency: number;\n  tokensPerSecond: number;\n}\n\nasync function runBenchmark() {\n  console.log('ğŸ ONNX Local Inference Benchmark (Phi-4 CPU)\\n');\n  console.log('Target: 15-25 tokens/sec on CPU');\n  console.log('================================================\\n');\n\n  const provider = new ONNXLocalProvider({\n    modelPath: './models/phi-4/cpu_and_mobile/cpu-int4-rtn-block-32-acc-level-4/model.onnx',\n    executionProviders: ['cpu'],\n    maxTokens: 50,\n    temperature: 0.7\n  });\n\n  const results: BenchmarkResult[] = [];\n\n  // Test 1: Short response\n  console.log('Test 1: Short Response (Math)');\n  console.log('==============================');\n\n  const test1Start = Date.now();\n  const response1 = await provider.chat({\n    model: 'phi-4',\n    messages: [\n      { role: 'user', content: 'What is 2+2?' }\n    ],\n    maxTokens: 20\n  });\n  const test1Latency = Date.now() - test1Start;\n  const test1TPS = (response1.usage?.outputTokens || 0) / (test1Latency / 1000);\n\n  console.log(`âœ… Response: ${response1.content[0].type === 'text' ? response1.content[0].text : ''}`);\n  console.log(`â±ï¸  ${test1Latency}ms | ${test1TPS.toFixed(1)} tokens/sec\\n`);\n\n  results.push({\n    test: 'Short Math',\n    tokens: response1.usage?.outputTokens || 0,\n    latency: test1Latency,\n    tokensPerSecond: test1TPS\n  });\n\n  // Test 2: Medium response\n  console.log('Test 2: Medium Response (Reasoning)');\n  console.log('=====================================');\n\n  const test2Start = Date.now();\n  const response2 = await provider.chat({\n    model: 'phi-4',\n    messages: [\n      { role: 'user', content: 'Explain why the sky is blue in one sentence.' }\n    ],\n    maxTokens: 30\n  });\n  const test2Latency = Date.now() - test2Start;\n  const test2TPS = (response2.usage?.outputTokens || 0) / (test2Latency / 1000);\n\n  console.log(`âœ… Response: ${response2.content[0].type === 'text' ? response2.content[0].text : ''}`);\n  console.log(`â±ï¸  ${test2Latency}ms | ${test2TPS.toFixed(1)} tokens/sec\\n`);\n\n  results.push({\n    test: 'Medium Reasoning',\n    tokens: response2.usage?.outputTokens || 0,\n    latency: test2Latency,\n    tokensPerSecond: test2TPS\n  });\n\n  // Test 3: Longer response\n  console.log('Test 3: Longer Response (Creative)');\n  console.log('====================================');\n\n  const test3Start = Date.now();\n  const response3 = await provider.chat({\n    model: 'phi-4',\n    messages: [\n      { role: 'user', content: 'List 5 programming languages.' }\n    ],\n    maxTokens: 50\n  });\n  const test3Latency = Date.now() - test3Start;\n  const test3TPS = (response3.usage?.outputTokens || 0) / (test3Latency / 1000);\n\n  console.log(`âœ… Response: ${response3.content[0].type === 'text' ? response3.content[0].text : ''}`);\n  console.log(`â±ï¸  ${test3Latency}ms | ${test3TPS.toFixed(1)} tokens/sec\\n`);\n\n  results.push({\n    test: 'Longer Creative',\n    tokens: response3.usage?.outputTokens || 0,\n    latency: test3Latency,\n    tokensPerSecond: test3TPS\n  });\n\n  // Test 4: Multi-turn conversation\n  console.log('Test 4: Multi-Turn Conversation');\n  console.log('================================');\n\n  const test4Start = Date.now();\n  const response4 = await provider.chat({\n    model: 'phi-4',\n    messages: [\n      { role: 'user', content: 'Hello!' },\n      { role: 'assistant', content: 'Hello! How can I help you today?' },\n      { role: 'user', content: 'Tell me a fun fact about computers.' }\n    ],\n    maxTokens: 40\n  });\n  const test4Latency = Date.now() - test4Start;\n  const test4TPS = (response4.usage?.outputTokens || 0) / (test4Latency / 1000);\n\n  console.log(`âœ… Response: ${response4.content[0].type === 'text' ? response4.content[0].text : ''}`);\n  console.log(`â±ï¸  ${test4Latency}ms | ${test4TPS.toFixed(1)} tokens/sec\\n`);\n\n  results.push({\n    test: 'Multi-Turn',\n    tokens: response4.usage?.outputTokens || 0,\n    latency: test4Latency,\n    tokensPerSecond: test4TPS\n  });\n\n  // Summary\n  console.log('\\nğŸ“Š Benchmark Summary');\n  console.log('====================\\n');\n\n  const avgTPS = results.reduce((sum, r) => sum + r.tokensPerSecond, 0) / results.length;\n  const avgLatency = results.reduce((sum, r) => sum + r.latency, 0) / results.length;\n  const totalTokens = results.reduce((sum, r) => sum + r.tokens, 0);\n\n  console.table(results.map(r => ({\n    Test: r.test,\n    Tokens: r.tokens,\n    'Latency (ms)': r.latency,\n    'Tokens/Sec': r.tokensPerSecond.toFixed(1)\n  })));\n\n  console.log(`\\nğŸ“ˆ Performance Metrics:`);\n  console.log(`   Average Tokens/Sec: ${avgTPS.toFixed(1)}`);\n  console.log(`   Average Latency: ${avgLatency.toFixed(0)}ms`);\n  console.log(`   Total Tokens Generated: ${totalTokens}`);\n\n  console.log(`\\nğŸ¯ Target Validation:`);\n  const targetMin = 15;\n  const targetMax = 25;\n\n  if (avgTPS >= targetMin && avgTPS <= targetMax * 1.5) {\n    console.log(`   âœ… PASS: ${avgTPS.toFixed(1)} tokens/sec is within acceptable range`);\n  } else if (avgTPS < targetMin) {\n    console.log(`   âš ï¸  SLOW: ${avgTPS.toFixed(1)} tokens/sec is below target (${targetMin}+)`);\n  } else {\n    console.log(`   ğŸš€ FAST: ${avgTPS.toFixed(1)} tokens/sec exceeds target!`);\n  }\n\n  console.log(`\\nğŸ’° Cost Savings:`);\n  console.log(`   Local Inference: $0.00`);\n  console.log(`   Anthropic Equivalent: ~$${(totalTokens * 0.00003).toFixed(4)}`);\n  console.log(`   Savings: 100%`);\n\n  console.log(`\\nğŸ”’ Privacy:`);\n  console.log(`   âœ… All processing local`);\n  console.log(`   âœ… No data sent to cloud`);\n  console.log(`   âœ… GDPR/HIPAA compliant`);\n\n  await provider.dispose();\n}\n\nrunBenchmark().catch(error => {\n  console.error('âŒ Benchmark failed:', error);\n  process.exit(1);\n});\n"]}