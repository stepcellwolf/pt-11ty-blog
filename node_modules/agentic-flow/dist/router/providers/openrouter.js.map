{"version":3,"file":"openrouter.js","sourceRoot":"","sources":["../../../src/router/providers/openrouter.ts"],"names":[],"mappings":"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","sourcesContent":["// OpenRouter provider implementation\nimport axios, { AxiosInstance } from 'axios';\nimport {\n  LLMProvider,\n  ChatParams,\n  ChatResponse,\n  StreamChunk,\n  ProviderConfig,\n  ProviderError,\n  ContentBlock,\n  Tool\n} from '../types.js';\nimport { mapModelId } from '../model-mapping.js';\n\nexport class OpenRouterProvider implements LLMProvider {\n  name = 'openrouter';\n  type = 'openrouter' as const;\n  supportsStreaming = true;\n  supportsTools = true;\n  supportsMCP = false; // Requires translation\n\n  private client: AxiosInstance;\n  private config: ProviderConfig;\n\n  constructor(config: ProviderConfig) {\n    this.config = config;\n\n    if (!config.apiKey) {\n      throw new Error('OpenRouter API key is required');\n    }\n\n    this.client = axios.create({\n      baseURL: config.baseUrl || 'https://openrouter.ai/api/v1',\n      headers: {\n        'Authorization': `Bearer ${config.apiKey}`,\n        'HTTP-Referer': 'https://github.com/ruvnet/agentic-flow',\n        'X-Title': 'Agentic Flow Multi-Model Router',\n        'Content-Type': 'application/json'\n      },\n      timeout: config.timeout || 180000\n    });\n  }\n\n  validateCapabilities(features: string[]): boolean {\n    const supported = ['chat', 'streaming', 'tools'];\n    return features.every(f => supported.includes(f));\n  }\n\n  async chat(params: ChatParams): Promise<ChatResponse> {\n    try {\n      const requestBody = this.formatRequest(params);\n\n      const response = await this.client.post('/chat/completions', requestBody);\n\n      return this.formatResponse(response.data, params.model);\n    } catch (error: any) {\n      throw this.handleError(error);\n    }\n  }\n\n  async *stream(params: ChatParams): AsyncGenerator<StreamChunk> {\n    try {\n      const requestBody = this.formatRequest(params, true);\n\n      const response = await this.client.post('/chat/completions', requestBody, {\n        responseType: 'stream'\n      });\n\n      for await (const chunk of response.data) {\n        const lines = chunk.toString().split('\\n').filter((line: string) => line.trim() !== '');\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            const data = line.slice(6);\n\n            if (data === '[DONE]') {\n              yield { type: 'message_stop' };\n              return;\n            }\n\n            try {\n              const parsed = JSON.parse(data);\n              const streamChunk = this.formatStreamChunk(parsed);\n              if (streamChunk) {\n                yield streamChunk;\n              }\n            } catch (e) {\n              // Skip invalid JSON\n            }\n          }\n        }\n      }\n    } catch (error: any) {\n      throw this.handleError(error);\n    }\n  }\n\n  private formatRequest(params: ChatParams, stream = false): any {\n    const messages = params.messages.map(msg => ({\n      role: msg.role,\n      content: typeof msg.content === 'string'\n        ? msg.content\n        : msg.content.map(block => {\n            if (block.type === 'text') return { type: 'text', text: block.text };\n            if (block.type === 'tool_use') return {\n              type: 'function',\n              function: {\n                name: block.name,\n                arguments: JSON.stringify(block.input)\n              }\n            };\n            if (block.type === 'tool_result') return {\n              type: 'function_result',\n              content: block.content,\n              is_error: block.is_error\n            };\n            return block;\n          })\n    }));\n\n    // Map model ID to OpenRouter format\n    const openrouterModel = mapModelId(params.model, 'openrouter');\n\n    const body: any = {\n      model: openrouterModel,\n      messages,\n      temperature: params.temperature ?? 0.7,\n      max_tokens: params.maxTokens,\n      stream\n    };\n\n    // Add tools if provided\n    if (params.tools && params.tools.length > 0) {\n      body.tools = params.tools.map(tool => ({\n        type: 'function',\n        function: {\n          name: tool.name,\n          description: tool.description,\n          parameters: tool.input_schema\n        }\n      }));\n\n      if (params.toolChoice) {\n        if (params.toolChoice === 'auto' || params.toolChoice === 'none') {\n          body.tool_choice = params.toolChoice;\n        } else if (typeof params.toolChoice === 'object') {\n          body.tool_choice = {\n            type: 'function',\n            function: { name: params.toolChoice.name }\n          };\n        }\n      }\n    }\n\n    // Add OpenRouter-specific preferences\n    if (this.config.preferences) {\n      if (this.config.preferences.requireParameters) {\n        body.require_parameters = true;\n      }\n      if (this.config.preferences.dataCollection) {\n        body['X-Data-Collection'] = this.config.preferences.dataCollection;\n      }\n      if (this.config.preferences.order) {\n        body.provider = {\n          order: this.config.preferences.order\n        };\n      }\n    }\n\n    return body;\n  }\n\n  private formatResponse(data: any, model: string): ChatResponse {\n    const choice = data.choices[0];\n    const message = choice.message;\n\n    const content: ContentBlock[] = [];\n\n    // Handle text content\n    if (message.content) {\n      content.push({\n        type: 'text',\n        text: message.content\n      });\n    }\n\n    // Handle tool calls\n    if (message.tool_calls) {\n      for (const toolCall of message.tool_calls) {\n        content.push({\n          type: 'tool_use',\n          id: toolCall.id,\n          name: toolCall.function.name,\n          input: JSON.parse(toolCall.function.arguments)\n        });\n      }\n    }\n\n    const stopReason = this.mapFinishReason(choice.finish_reason);\n\n    return {\n      id: data.id,\n      model: data.model || model,\n      content,\n      stopReason,\n      usage: {\n        inputTokens: data.usage?.prompt_tokens || 0,\n        outputTokens: data.usage?.completion_tokens || 0\n      },\n      metadata: {\n        provider: 'openrouter',\n        cost: this.calculateCost(data.usage),\n        latency: 0 // Will be set by router\n      }\n    };\n  }\n\n  private formatStreamChunk(data: any): StreamChunk | null {\n    const choice = data.choices?.[0];\n    if (!choice) return null;\n\n    const delta = choice.delta;\n\n    if (delta?.content) {\n      return {\n        type: 'content_block_delta',\n        delta: {\n          type: 'text_delta',\n          text: delta.content\n        }\n      };\n    }\n\n    if (delta?.tool_calls) {\n      const toolCall = delta.tool_calls[0];\n      return {\n        type: 'content_block_delta',\n        delta: {\n          type: 'input_json_delta',\n          partial_json: toolCall.function?.arguments || ''\n        }\n      };\n    }\n\n    if (choice.finish_reason) {\n      return {\n        type: 'message_stop',\n        usage: data.usage ? {\n          inputTokens: data.usage.prompt_tokens || 0,\n          outputTokens: data.usage.completion_tokens || 0\n        } : undefined\n      };\n    }\n\n    return null;\n  }\n\n  private mapFinishReason(reason: string): ChatResponse['stopReason'] {\n    switch (reason) {\n      case 'stop': return 'end_turn';\n      case 'length': return 'max_tokens';\n      case 'tool_calls': return 'tool_use';\n      default: return 'end_turn';\n    }\n  }\n\n  private calculateCost(usage?: { prompt_tokens?: number; completion_tokens?: number }): number {\n    if (!usage) return 0;\n\n    // OpenRouter pricing varies by model\n    // Using average pricing: $0.01/1K input, $0.03/1K output\n    const inputCost = (usage.prompt_tokens || 0) * 0.00001;\n    const outputCost = (usage.completion_tokens || 0) * 0.00003;\n\n    return inputCost + outputCost;\n  }\n\n  private handleError(error: any): ProviderError {\n    const providerError = new Error(\n      error.response?.data?.error?.message || error.message || 'OpenRouter request failed'\n    ) as ProviderError;\n\n    providerError.provider = 'openrouter';\n    providerError.statusCode = error.response?.status;\n    providerError.retryable = error.response?.status >= 500 || error.code === 'ECONNABORTED';\n\n    return providerError;\n  }\n}\n"]}