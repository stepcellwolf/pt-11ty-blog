{"version":3,"file":"test-onnx-integration.js","sourceRoot":"","sources":["../../src/router/test-onnx-integration.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n/**\n * ONNX Integration Test - Validates agentic-flow works with ONNX\n *\n * Tests ONNX provider integration with the multi-model router\n */\n\nimport { ModelRouter } from './router.js';\n\nasync function testONNXIntegration() {\n  console.log('ðŸ§ª agentic-flow + ONNX Runtime Integration Test\\n');\n  console.log('='.repeat(60));\n  console.log('Testing: Multi-Model Router with ONNX Local Inference');\n  console.log('='.repeat(60) + '\\n');\n\n  try {\n    // Initialize router (ONNX-only mode)\n    console.log('Step 1: Router Initialization');\n    console.log('==============================');\n\n    const router = new ModelRouter();\n    const config = router.getConfig();\n\n    console.log(`âœ… Router initialized successfully`);\n    console.log(`   Version: ${config.version}`);\n    console.log(`   Default Provider: ${config.defaultProvider}`);\n    console.log(`   Fallback Chain: ${config.fallbackChain?.join(' â†’ ')}`);\n    console.log(`   Routing Mode: ${config.routing?.mode}`);\n    console.log(`   Providers Configured: ${Object.keys(config.providers).length}`);\n    console.log('');\n\n    // Test ONNX provider\n    console.log('Step 2: ONNX Provider Direct Test');\n    console.log('===================================');\n\n    // Get ONNX provider directly\n    const onnxProvider = (router as any).providers.get('onnx');\n\n    if (!onnxProvider) {\n      throw new Error('ONNX provider not initialized');\n    }\n\n    console.log(`âœ… ONNX provider found: ${onnxProvider.name}`);\n    console.log(`   Type: ${onnxProvider.type}`);\n    console.log(`   Supports Streaming: ${onnxProvider.supportsStreaming}`);\n    console.log(`   Supports Tools: ${onnxProvider.supportsTools}`);\n    console.log('');\n\n    // Test inference\n    console.log('Step 3: ONNX Inference Test');\n    console.log('=============================');\n\n    const response = await onnxProvider.chat({\n      model: 'phi-4',\n      messages: [\n        { role: 'user', content: 'What is 2+2?' }\n      ],\n      maxTokens: 20\n    });\n\n    console.log(`âœ… Inference successful`);\n    console.log(`   Response: ${response.content[0].type === 'text' ? response.content[0].text : 'N/A'}`);\n    console.log(`   Model: ${response.model}`);\n    console.log(`   Latency: ${response.metadata?.latency}ms`);\n    console.log(`   Tokens/Sec: ${response.metadata?.tokensPerSecond}`);\n    console.log(`   Cost: $${response.metadata?.cost || 0}`);\n    console.log(`   Input Tokens: ${response.usage?.inputTokens}`);\n    console.log(`   Output Tokens: ${response.usage?.outputTokens}`);\n    console.log('');\n\n    // Test router configuration\n    console.log('Step 4: Router Configuration Validation');\n    console.log('=========================================');\n\n    const onnxConfig = config.providers.onnx;\n    console.log(`âœ… ONNX Configuration:`);\n    console.log(`   Model Path: ${onnxConfig?.modelPath || 'default'}`);\n    console.log(`   Execution Providers: ${onnxConfig?.executionProviders?.join(', ')}`);\n    console.log(`   Max Tokens: ${onnxConfig?.maxTokens}`);\n    console.log(`   Temperature: ${onnxConfig?.temperature}`);\n    console.log(`   Local Inference: ${onnxConfig?.localInference}`);\n    console.log(`   GPU Acceleration: ${onnxConfig?.gpuAcceleration}`);\n    console.log('');\n\n    // Test routing rules\n    console.log('Step 5: Privacy Routing Rule Validation');\n    console.log('=========================================');\n\n    const privacyRule = config.routing?.rules?.find(r =>\n      r.condition.privacy === 'high' && r.action.provider === 'onnx'\n    );\n\n    if (privacyRule) {\n      console.log(`âœ… Privacy routing rule configured:`);\n      console.log(`   Condition: privacy = high, localOnly = ${privacyRule.condition.localOnly}`);\n      console.log(`   Action: Route to ${privacyRule.action.provider}`);\n      console.log(`   Reason: ${privacyRule.reason}`);\n    } else {\n      console.log(`âš ï¸  Privacy routing rule not found (optional)`);\n    }\n    console.log('');\n\n    // Architecture summary\n    console.log('\\n' + '='.repeat(60));\n    console.log('âœ… Integration Test Complete!');\n    console.log('='.repeat(60) + '\\n');\n\n    console.log('Integration Confirmed:');\n    console.log('  âœ“ agentic-flow multi-model router working');\n    console.log('  âœ“ ONNX Runtime provider integrated');\n    console.log('  âœ“ Local CPU inference operational');\n    console.log('  âœ“ Configuration loaded successfully');\n    console.log('  âœ“ Privacy routing rules configured');\n    console.log('');\n\n    console.log('Architecture Details:');\n    console.log('  â€¢ Router: ModelRouter class');\n    console.log('  â€¢ ONNX Provider: ONNXLocalProvider');\n    console.log('  â€¢ Model: Microsoft Phi-4-mini-instruct-onnx (INT4)');\n    console.log('  â€¢ Execution: CPU-only local inference');\n    console.log('  â€¢ KV Cache: 32-layer autoregressive generation');\n    console.log('  â€¢ Cost: $0.00 per request (100% free)');\n    console.log('');\n\n    console.log('Performance:');\n    console.log(`  â€¢ Latency: ${response.metadata?.latency}ms`);\n    console.log(`  â€¢ Throughput: ${response.metadata?.tokensPerSecond} tokens/sec`);\n    console.log(`  â€¢ Privacy: 100% local processing`);\n    console.log(`  â€¢ Cost: $0.00 (free inference)`);\n    console.log('');\n\n    console.log('Use Cases:');\n    console.log('  â€¢ Privacy-sensitive data processing');\n    console.log('  â€¢ GDPR/HIPAA compliant inference');\n    console.log('  â€¢ Offline operation (no internet)');\n    console.log('  â€¢ Zero-cost development/testing');\n    console.log('  â€¢ Medical/legal document analysis');\n    console.log('');\n\n  } catch (error) {\n    console.error('\\nâŒ Integration Test Failed!');\n    console.error('==============================');\n    console.error(error);\n    process.exit(1);\n  }\n}\n\n// Run test\ntestONNXIntegration().catch(error => {\n  console.error('Fatal error:', error);\n  process.exit(1);\n});\n"]}