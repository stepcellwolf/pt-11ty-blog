{"version":3,"file":"test-onnx.js","sourceRoot":"","sources":["../../src/router/test-onnx.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n/**\n * Test script for ONNX Runtime integration\n * Tests CPU inference with Phi-3 model\n */\n\nimport { ONNXProvider } from './providers/onnx.js';\n\nasync function testONNXProvider() {\n  console.log('üß™ Testing ONNX Runtime Provider\\n');\n\n  try {\n    // Test 1: Initialize ONNX provider\n    console.log('Test 1: Provider Initialization');\n    console.log('================================');\n\n    const provider = new ONNXProvider({\n      modelId: 'Xenova/Phi-3-mini-4k-instruct',\n      maxTokens: 100,\n      temperature: 0.7\n    });\n\n    console.log(`‚úÖ Provider initialized: ${provider.name}`);\n    console.log(`üìä Supports streaming: ${provider.supportsStreaming}`);\n    console.log(`üîß Supports tools: ${provider.supportsTools}\\n`);\n\n    // Test 2: Simple chat completion\n    console.log('Test 2: Chat Completion (CPU)');\n    console.log('==============================');\n\n    const chatParams = {\n      model: 'Xenova/Phi-3-mini-4k-instruct',\n      messages: [\n        {\n          role: 'user' as const,\n          content: 'Say \"Hello from ONNX Runtime!\" and nothing else.'\n        }\n      ],\n      maxTokens: 50,\n      temperature: 0.5\n    };\n\n    console.log(`üì§ Sending request...`);\n    console.log(`üìù Prompt: ${chatParams.messages[0].content}\\n`);\n\n    const startTime = Date.now();\n    const response = await provider.chat(chatParams);\n    const latency = Date.now() - startTime;\n\n    console.log('üì• Response received:');\n    console.log(`  Provider: ${response.metadata?.provider}`);\n    console.log(`  Model: ${response.model}`);\n    console.log(`  Latency: ${latency}ms`);\n    console.log(`  Stop Reason: ${response.stopReason}`);\n    console.log(`  Usage: ${response.usage?.inputTokens} in / ${response.usage?.outputTokens} out`);\n    console.log(`  Cost: $${response.metadata?.cost?.toFixed(6) || 0} (FREE - Local inference)`);\n    console.log(`  Execution Providers: ${response.metadata?.executionProviders?.join(', ')}`);\n    console.log(`\\n  Content:`);\n\n    for (const block of response.content) {\n      if (block.type === 'text') {\n        console.log(`    ${block.text}`);\n      }\n    }\n\n    console.log('\\n‚úÖ Test 2 passed!\\n');\n\n    // Test 3: Multi-turn conversation\n    console.log('Test 3: Multi-Turn Conversation');\n    console.log('================================');\n\n    const conversationParams = {\n      model: 'Xenova/Phi-3-mini-4k-instruct',\n      messages: [\n        {\n          role: 'user' as const,\n          content: 'What is 2+2?'\n        },\n        {\n          role: 'assistant' as const,\n          content: '4'\n        },\n        {\n          role: 'user' as const,\n          content: 'What about 2+3?'\n        }\n      ],\n      maxTokens: 50,\n      temperature: 0.3\n    };\n\n    console.log(`üì§ Multi-turn conversation...`);\n    const convResponse = await provider.chat(conversationParams);\n\n    console.log('üì• Response:');\n    console.log(`  Content: ${convResponse.content[0].type === 'text' ? convResponse.content[0].text : 'N/A'}`);\n    console.log('\\n‚úÖ Test 3 passed!\\n');\n\n    // Test 4: Model info\n    console.log('Test 4: Model Information');\n    console.log('=========================');\n\n    const modelInfo = provider.getModelInfo();\n    console.log(`üìä Model ID: ${modelInfo.modelId}`);\n    console.log(`üîß Execution Providers: ${modelInfo.executionProviders.join(', ')}`);\n    console.log(`‚ö° GPU Support: ${modelInfo.supportsGPU ? 'Yes' : 'No (CPU only)'}`);\n    console.log(`‚úì Initialized: ${modelInfo.initialized}`);\n    console.log('\\n‚úÖ Test 4 passed!\\n');\n\n    // Test 5: Performance benchmark\n    console.log('Test 5: Performance Benchmark');\n    console.log('=============================');\n\n    const benchmarkParams = {\n      model: 'Xenova/Phi-3-mini-4k-instruct',\n      messages: [\n        {\n          role: 'user' as const,\n          content: 'Count from 1 to 5.'\n        }\n      ],\n      maxTokens: 50,\n      temperature: 0.5\n    };\n\n    const benchmarkRuns = 3;\n    const latencies: number[] = [];\n\n    for (let i = 0; i < benchmarkRuns; i++) {\n      const start = Date.now();\n      await provider.chat(benchmarkParams);\n      const duration = Date.now() - start;\n      latencies.push(duration);\n      console.log(`  Run ${i + 1}: ${duration}ms`);\n    }\n\n    const avgLatency = latencies.reduce((a, b) => a + b, 0) / latencies.length;\n    const tokensPerSec = (50 / avgLatency) * 1000;\n\n    console.log(`\\nüìä Benchmark Results:`);\n    console.log(`  Average Latency: ${avgLatency.toFixed(0)}ms`);\n    console.log(`  Tokens/Second: ${tokensPerSec.toFixed(1)}`);\n    console.log('\\n‚úÖ Test 5 passed!\\n');\n\n    // Cleanup\n    await provider.dispose();\n\n    // Final summary\n    console.log('üéâ All ONNX Tests Passed!');\n    console.log('=========================');\n    console.log(`‚úÖ Provider initialization working`);\n    console.log(`‚úÖ CPU inference functional`);\n    console.log(`‚úÖ Chat completion successful`);\n    console.log(`‚úÖ Multi-turn conversations working`);\n    console.log(`‚úÖ Performance: ${tokensPerSec.toFixed(1)} tokens/sec`);\n    console.log(`‚úÖ Cost: $0.00 (100% free local inference)`);\n    console.log(`\\nüí° Next Steps:`);\n    console.log(`  1. Integrate ONNX provider into router`);\n    console.log(`  2. Add GPU support (CUDA/DirectML)`);\n    console.log(`  3. Implement model caching`);\n    console.log(`  4. Add streaming support`);\n\n  } catch (error) {\n    console.error('\\n‚ùå Test Failed!');\n    console.error('===============');\n    console.error(error);\n    process.exit(1);\n  }\n}\n\n// Run tests\ntestONNXProvider().catch(error => {\n  console.error('Fatal error:', error);\n  process.exit(1);\n});\n"]}