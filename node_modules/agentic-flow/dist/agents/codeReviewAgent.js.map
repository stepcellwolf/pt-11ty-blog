{"version":3,"file":"codeReviewAgent.js","sourceRoot":"","sources":["../../src/agents/codeReviewAgent.ts"],"names":[],"mappings":"AAAA,gCAAgC;AAChC,OAAO,EAAE,KAAK,EAAE,MAAM,gCAAgC,CAAC;AACvD,OAAO,EAAE,MAAM,EAAE,MAAM,oBAAoB,CAAC;AAC5C,OAAO,EAAE,SAAS,EAAE,MAAM,mBAAmB,CAAC;AAC9C,OAAO,EAAE,UAAU,EAAE,MAAM,oBAAoB,CAAC;AAEhD,MAAM,CAAC,KAAK,UAAU,eAAe,CAAC,KAAa,EAAE,QAAkC;IACrF,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;IAC7B,MAAM,CAAC,IAAI,CAAC,4BAA4B,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC;IAE9E,OAAO,SAAS,CAAC,KAAK,IAAI,EAAE;QAC1B,MAAM,MAAM,GAAG,KAAK,CAAC;YACnB,MAAM,EAAE,KAAK;YACb,OAAO,EAAE;gBACP,YAAY,EAAE,qEAAqE;gBACnF,GAAG,UAAU;aACd;SACF,CAAC,CAAC;QAEH,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,IAAI,KAAK,EAAE,MAAM,GAAG,IAAI,MAAM,EAAE,CAAC;YAC/B,IAAI,GAAG,CAAC,IAAI,KAAK,WAAW,EAAE,CAAC;gBAC7B,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC;gBACnG,MAAM,IAAI,KAAK,CAAC;gBAEhB,IAAI,QAAQ,IAAI,KAAK,EAAE,CAAC;oBACtB,QAAQ,CAAC,KAAK,CAAC,CAAC;gBAClB,CAAC;YACH,CAAC;QACH,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,SAAS,CAAC;QACxC,MAAM,CAAC,IAAI,CAAC,6BAA6B,EAAE;YACzC,QAAQ;YACR,YAAY,EAAE,MAAM,CAAC,MAAM;SAC5B,CAAC,CAAC;QAEH,OAAO,EAAE,MAAM,EAAE,CAAC;IACpB,CAAC,CAAC,CAAC;AACL,CAAC","sourcesContent":["// src/agents/codeReviewAgent.ts\nimport { query } from \"@anthropic-ai/claude-agent-sdk\";\nimport { logger } from \"../utils/logger.js\";\nimport { withRetry } from \"../utils/retry.js\";\nimport { toolConfig } from \"../config/tools.js\";\n\nexport async function codeReviewAgent(input: string, onStream?: (chunk: string) => void) {\n  const startTime = Date.now();\n  logger.info('Starting code review agent', { input: input.substring(0, 100) });\n\n  return withRetry(async () => {\n    const result = query({\n      prompt: input,\n      options: {\n        systemPrompt: `You review diffs and point out risks, complexity, and tests to add.`,\n        ...toolConfig\n      }\n    });\n\n    let output = '';\n    for await (const msg of result) {\n      if (msg.type === 'assistant') {\n        const chunk = msg.message.content?.map((c: any) => c.type === 'text' ? c.text : '').join('') || '';\n        output += chunk;\n\n        if (onStream && chunk) {\n          onStream(chunk);\n        }\n      }\n    }\n\n    const duration = Date.now() - startTime;\n    logger.info('Code review agent completed', {\n      duration,\n      outputLength: output.length\n    });\n\n    return { output };\n  });\n}\n"]}