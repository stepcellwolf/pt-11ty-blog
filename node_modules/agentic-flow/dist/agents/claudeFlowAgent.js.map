{"version":3,"file":"claudeFlowAgent.js","sourceRoot":"","sources":["../../src/agents/claudeFlowAgent.ts"],"names":[],"mappings":"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","sourcesContent":["// Agent with Claude Flow memory and coordination capabilities\nimport { query } from '@anthropic-ai/claude-agent-sdk';\nimport { logger } from '../utils/logger.js';\nimport { withRetry } from '../utils/retry.js';\nimport { toolConfig } from '../config/tools.js';\nimport { getMemoryConfig, getSwarmConfig } from '../config/claudeFlow.js';\n\nexport interface ClaudeFlowAgentOptions {\n  enableMemory?: boolean;\n  enableCoordination?: boolean;\n  memoryNamespace?: string;\n  swarmTopology?: 'hierarchical' | 'mesh' | 'ring' | 'star';\n  onStream?: (chunk: string) => void;\n}\n\n/**\n * Execute agent with Claude Flow memory and coordination\n */\nexport async function claudeFlowAgent(\n  agentName: string,\n  systemPrompt: string,\n  input: string,\n  options: ClaudeFlowAgentOptions = {}\n) {\n  const {\n    enableMemory = true,\n    enableCoordination = false,\n    memoryNamespace,\n    swarmTopology = 'mesh',\n    onStream\n  } = options;\n\n  const startTime = Date.now();\n  logger.info('Starting Claude Flow agent', {\n    agentName,\n    input: input.substring(0, 100),\n    enableMemory,\n    enableCoordination\n  });\n\n  // Prepare memory context if enabled\n  let memoryContext = '';\n  if (enableMemory) {\n    const memoryConfig = getMemoryConfig(memoryNamespace || agentName);\n    memoryContext = `\n\nYou have access to persistent memory via claude-flow tools:\n- Store: mcp__claude-flow__memory_usage with action=\"store\", namespace=\"${memoryConfig.namespace}\"\n- Retrieve: mcp__claude-flow__memory_usage with action=\"retrieve\", namespace=\"${memoryConfig.namespace}\"\n- Search: mcp__claude-flow__memory_search with pattern=\"search query\"\n\nUse memory to persist important information across conversations.`;\n  }\n\n  // Prepare coordination context if enabled\n  let coordinationContext = '';\n  if (enableCoordination) {\n    const swarmConfig = getSwarmConfig(swarmTopology);\n    coordinationContext = `\n\nYou have access to swarm coordination via claude-flow tools:\n- Init swarm: mcp__claude-flow__swarm_init with topology=\"${swarmConfig.topology}\"\n- Spawn agent: mcp__claude-flow__agent_spawn with type=\"researcher|coder|analyst\"\n- Orchestrate: mcp__claude-flow__task_orchestrate with task=\"description\"\n- Check status: mcp__claude-flow__swarm_status\n\nUse coordination for complex multi-agent tasks.`;\n  }\n\n  const enhancedSystemPrompt = `${systemPrompt}${memoryContext}${coordinationContext}`;\n\n  return withRetry(async () => {\n    const result = query({\n      prompt: input,\n      options: {\n        systemPrompt: enhancedSystemPrompt,\n        ...toolConfig\n      }\n    });\n\n    let output = '';\n    for await (const msg of result) {\n      if (msg.type === 'assistant') {\n        const chunk = msg.message.content\n          ?.map((c: any) => (c.type === 'text' ? c.text : ''))\n          .join('') || '';\n        output += chunk;\n        if (onStream && chunk) {\n          onStream(chunk);\n        }\n      }\n    }\n\n    const duration = Date.now() - startTime;\n    logger.info('Claude Flow agent completed', {\n      agentName,\n      duration,\n      outputLength: output.length,\n      memoryUsed: enableMemory,\n      coordinationUsed: enableCoordination\n    });\n\n    return { output };\n  });\n}\n\n/**\n * Example: Memory-enabled research agent\n */\nexport async function memoryResearchAgent(topic: string, onStream?: (chunk: string) => void) {\n  return claudeFlowAgent(\n    'memory-researcher',\n    `You are a research agent with persistent memory.\n\nResearch the given topic thoroughly and store key findings in memory for future reference.\nUse memory_usage tool to store important facts, insights, and references.`,\n    `Research topic: ${topic}`,\n    {\n      enableMemory: true,\n      enableCoordination: false,\n      onStream\n    }\n  );\n}\n\n/**\n * Example: Coordination-enabled orchestrator agent\n */\nexport async function orchestratorAgent(task: string, onStream?: (chunk: string) => void) {\n  return claudeFlowAgent(\n    'orchestrator',\n    `You are an orchestration agent that coordinates multiple specialized agents.\n\nBreak down complex tasks and delegate to specialized agents using swarm coordination.\nUse swarm_init, agent_spawn, and task_orchestrate tools to manage the workflow.`,\n    `Orchestrate task: ${task}`,\n    {\n      enableMemory: true,\n      enableCoordination: true,\n      swarmTopology: 'hierarchical',\n      onStream\n    }\n  );\n}\n\n/**\n * Example: Full-featured agent with memory and coordination\n */\nexport async function hybridAgent(\n  task: string,\n  agentName: string = 'hybrid',\n  systemPrompt: string = 'You are a versatile agent with memory and coordination capabilities.',\n  onStream?: (chunk: string) => void\n) {\n  return claudeFlowAgent(\n    agentName,\n    systemPrompt,\n    task,\n    {\n      enableMemory: true,\n      enableCoordination: true,\n      swarmTopology: 'mesh',\n      onStream\n    }\n  );\n}\n"]}