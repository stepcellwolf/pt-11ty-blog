{"version":3,"file":"pii-scrubber.js","sourceRoot":"","sources":["../../../src/reasoningbank/utils/pii-scrubber.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * PII (Personally Identifiable Information) scrubber\n * Redacts sensitive information before storing memories\n */\n\nimport { loadConfig } from './config.js';\n\n// Default PII patterns (regex-based)\nconst DEFAULT_PATTERNS = [\n  // Email addresses\n  { pattern: /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b/g, replacement: '[EMAIL]' },\n\n  // US Social Security Numbers\n  { pattern: /\\b\\d{3}-\\d{2}-\\d{4}\\b/g, replacement: '[SSN]' },\n  { pattern: /\\b\\d{9}\\b/g, replacement: '[SSN]' },\n\n  // API Keys (common patterns)\n  { pattern: /\\bsk-[a-zA-Z0-9]{48}\\b/g, replacement: '[API_KEY]' }, // Anthropic\n  { pattern: /\\bghp_[a-zA-Z0-9]{36}\\b/g, replacement: '[API_KEY]' }, // GitHub\n  { pattern: /\\bgho_[a-zA-Z0-9]{36}\\b/g, replacement: '[API_KEY]' }, // GitHub OAuth\n  { pattern: /\\bxoxb-[a-zA-Z0-9\\-]+\\b/g, replacement: '[API_KEY]' }, // Slack\n  { pattern: /\\bAKIA[0-9A-Z]{16}\\b/g, replacement: '[AWS_KEY]' }, // AWS\n\n  // Credit card numbers (basic pattern)\n  { pattern: /\\b\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}\\b/g, replacement: '[CREDIT_CARD]' },\n\n  // Phone numbers (US format)\n  { pattern: /\\b\\d{3}[-.\\s]?\\d{3}[-.\\s]?\\d{4}\\b/g, replacement: '[PHONE]' },\n  { pattern: /\\b\\(\\d{3}\\)\\s?\\d{3}[-.\\s]?\\d{4}\\b/g, replacement: '[PHONE]' },\n\n  // IP addresses\n  { pattern: /\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b/g, replacement: '[IP]' },\n\n  // URLs with tokens/keys in query params\n  { pattern: /([?&])(token|key|apikey|api_key|secret)=[^&\\s]+/gi, replacement: '$1$2=[REDACTED]' },\n\n  // JWT tokens\n  { pattern: /\\beyJ[a-zA-Z0-9_-]+\\.eyJ[a-zA-Z0-9_-]+\\.[a-zA-Z0-9_-]+\\b/g, replacement: '[JWT]' }\n];\n\n/**\n * Scrub PII from text\n *\n * @param text - Text to scrub\n * @param customPatterns - Additional custom patterns to apply\n * @returns Scrubbed text with PII redacted\n */\nexport function scrubPII(\n  text: string,\n  customPatterns?: Array<{ pattern: RegExp; replacement: string }>\n): string {\n  const config = loadConfig();\n\n  // Check if PII scrubbing is enabled\n  if (!config.governance?.pii_scrubber) {\n    return text;\n  }\n\n  let scrubbed = text;\n  const patterns = customPatterns || DEFAULT_PATTERNS;\n\n  // Apply all redaction patterns\n  for (const { pattern, replacement } of patterns) {\n    scrubbed = scrubbed.replace(pattern, replacement);\n  }\n\n  return scrubbed;\n}\n\n/**\n * Check if text contains potential PII\n *\n * @param text - Text to check\n * @returns True if PII patterns are detected\n */\nexport function containsPII(text: string): boolean {\n  for (const { pattern } of DEFAULT_PATTERNS) {\n    if (pattern.test(text)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Get statistics about redacted content\n *\n * @param original - Original text\n * @param scrubbed - Scrubbed text\n * @returns Object with redaction statistics\n */\nexport function getRedactionStats(original: string, scrubbed: string): {\n  redacted: boolean;\n  originalLength: number;\n  scrubbedLength: number;\n  patterns: string[];\n} {\n  const patterns: string[] = [];\n\n  for (const { pattern, replacement } of DEFAULT_PATTERNS) {\n    if (pattern.test(original) && scrubbed.includes(replacement)) {\n      patterns.push(replacement);\n    }\n  }\n\n  return {\n    redacted: patterns.length > 0,\n    originalLength: original.length,\n    scrubbedLength: scrubbed.length,\n    patterns\n  };\n}\n\n/**\n * Scrub PII from memory object\n * Scrubs title, description, and content fields\n */\nexport function scrubMemory(memory: {\n  title: string;\n  description: string;\n  content: string;\n  [key: string]: any;\n}): typeof memory {\n  return {\n    ...memory,\n    title: scrubPII(memory.title),\n    description: scrubPII(memory.description),\n    content: scrubPII(memory.content)\n  };\n}\n"]}