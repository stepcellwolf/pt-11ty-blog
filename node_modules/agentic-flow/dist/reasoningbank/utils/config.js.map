{"version":3,"file":"config.js","sourceRoot":"","sources":["../../../src/reasoningbank/utils/config.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,KAAK,EAAE,MAAM,MAAM,CAAC;AAC7B,OAAO,EAAE,YAAY,EAAE,UAAU,EAAE,MAAM,IAAI,CAAC;AAC9C,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,MAAM,MAAM,CAAC;AACrC,OAAO,EAAE,aAAa,EAAE,MAAM,KAAK,CAAC;AAEpC,MAAM,UAAU,GAAG,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAClD,MAAM,SAAS,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AA6DtC,IAAI,WAAW,GAA+B,IAAI,CAAC;AAEnD,wBAAwB;AACxB,MAAM,cAAc,GAAwB;IAC1C,QAAQ,EAAE;QACR,CAAC,EAAE,CAAC;QACJ,KAAK,EAAE,IAAI;QACX,IAAI,EAAE,IAAI;QACV,KAAK,EAAE,IAAI;QACX,KAAK,EAAE,IAAI;QACX,sBAAsB,EAAE,EAAE;QAC1B,SAAS,EAAE,GAAG;KACf;IACD,KAAK,EAAE;QACL,KAAK,EAAE,4BAA4B;QACnC,UAAU,EAAE,GAAG;QACf,WAAW,EAAE,CAAC;QACd,oBAAoB,EAAE,GAAG;KAC1B;IACD,OAAO,EAAE;QACP,KAAK,EAAE,SAAS;QAChB,UAAU,EAAE,SAAS;QACrB,WAAW,EAAE,SAAS;QACtB,iBAAiB,EAAE,CAAC;QACpB,iBAAiB,EAAE,CAAC;QACpB,wBAAwB,EAAE,IAAI;QAC9B,wBAAwB,EAAE,IAAI;KAC/B;IACD,WAAW,EAAE;QACX,mBAAmB,EAAE,IAAI;QACzB,uBAAuB,EAAE,IAAI;QAC7B,iBAAiB,EAAE,EAAE;QACrB,cAAc,EAAE,GAAG;QACnB,oBAAoB,EAAE,GAAG;QACzB,mBAAmB,EAAE,GAAG;KACzB;IACD,KAAK,EAAE;QACL,UAAU,EAAE,CAAC;QACb,YAAY,EAAE,CAAC;QACf,YAAY,EAAE,CAAC;QACf,0BAA0B,EAAE,IAAI;QAChC,gBAAgB,EAAE,IAAI;KACvB;IACD,UAAU,EAAE;QACV,QAAQ,EAAE,QAAQ;QAClB,KAAK,EAAE,4BAA4B;QACnC,IAAI,EAAE,IAAI;QACV,UAAU,EAAE,IAAI;QAChB,iBAAiB,EAAE,IAAI;KACxB;IACD,UAAU,EAAE;QACV,SAAS,EAAE,IAAI;QACf,YAAY,EAAE,IAAI;QAClB,aAAa,EAAE,KAAK;KACrB;IACD,QAAQ,EAAE;QACR,oBAAoB,EAAE,IAAI;QAC1B,qBAAqB,EAAE,IAAI;QAC3B,qBAAqB,EAAE,IAAI;KAC5B;CACF,CAAC;AAEF,yCAAyC;AACzC,SAAS,cAAc;IACrB,MAAM,KAAK,GAAG;QACZ,uCAAuC;QACvC,IAAI,CAAC,SAAS,EAAE,8BAA8B,CAAC;QAC/C,qCAAqC;QACrC,IAAI,CAAC,SAAS,EAAE,iCAAiC,CAAC;QAClD,2CAA2C;QAC3C,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,2BAA2B,CAAC;QAChD,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,oBAAoB,CAAC;KAC1C,CAAC;IAEF,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;QACzB,IAAI,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC;YACrB,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IAED,OAAO,IAAI,CAAC;AACd,CAAC;AAED,MAAM,UAAU,UAAU;IACxB,IAAI,WAAW;QAAE,OAAO,WAAW,CAAC;IAEpC,MAAM,UAAU,GAAG,cAAc,EAAE,CAAC;IAEpC,wCAAwC;IACxC,IAAI,CAAC,UAAU,EAAE,CAAC;QAChB,WAAW,GAAG,cAAc,CAAC;QAC7B,OAAO,WAAW,CAAC;IACrB,CAAC;IAED,IAAI,CAAC;QACH,MAAM,WAAW,GAAG,YAAY,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;QACtD,MAAM,MAAM,GAAG,KAAK,CAAC,WAAW,CAAQ,CAAC;QAEzC,mCAAmC;QACnC,MAAM,GAAG,GAAG,MAAM,CAAC,aAAa,IAAI,MAAM,CAAC;QAE3C,kDAAkD;QAClD,WAAW,GAAG;YACZ,QAAQ,EAAE;gBACR,CAAC,EAAE,GAAG,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC;gBACvB,KAAK,EAAE,GAAG,CAAC,QAAQ,EAAE,KAAK,IAAI,IAAI;gBAClC,IAAI,EAAE,GAAG,CAAC,QAAQ,EAAE,IAAI,IAAI,IAAI;gBAChC,KAAK,EAAE,GAAG,CAAC,QAAQ,EAAE,KAAK,IAAI,IAAI;gBAClC,KAAK,EAAE,GAAG,CAAC,QAAQ,EAAE,KAAK,IAAI,IAAI;gBAClC,sBAAsB,EAAE,GAAG,CAAC,QAAQ,EAAE,sBAAsB,IAAI,EAAE;gBAClE,SAAS,EAAE,GAAG,CAAC,QAAQ,EAAE,SAAS,IAAI,GAAG;aAC1C;YACD,KAAK,EAAE;gBACL,KAAK,EAAE,GAAG,CAAC,KAAK,EAAE,KAAK,IAAI,4BAA4B;gBACvD,UAAU,EAAE,GAAG,CAAC,KAAK,EAAE,UAAU,IAAI,GAAG;gBACxC,WAAW,EAAE,GAAG,CAAC,KAAK,EAAE,WAAW,IAAI,CAAC;gBACxC,oBAAoB,EAAE,GAAG,CAAC,KAAK,EAAE,mBAAmB,IAAI,GAAG;aAC5D;YACD,OAAO,EAAE;gBACP,KAAK,EAAE,GAAG,CAAC,OAAO,EAAE,KAAK;gBACzB,UAAU,EAAE,GAAG,CAAC,OAAO,EAAE,UAAU;gBACnC,WAAW,EAAE,GAAG,CAAC,OAAO,EAAE,WAAW;gBACrC,iBAAiB,EAAE,GAAG,CAAC,OAAO,EAAE,wBAAwB,IAAI,CAAC;gBAC7D,iBAAiB,EAAE,CAAC;gBACpB,wBAAwB,EAAE,GAAG,CAAC,OAAO,EAAE,wBAAwB,IAAI,IAAI;gBACvE,wBAAwB,EAAE,GAAG,CAAC,OAAO,EAAE,wBAAwB,IAAI,IAAI;aACxE;YACD,WAAW,EAAE;gBACX,mBAAmB,EAAE,GAAG,CAAC,WAAW,EAAE,0BAA0B,IAAI,IAAI;gBACxE,uBAAuB,EAAE,GAAG,CAAC,WAAW,EAAE,uBAAuB,IAAI,IAAI;gBACzE,iBAAiB,EAAE,GAAG,CAAC,WAAW,EAAE,mBAAmB,IAAI,EAAE;gBAC7D,cAAc,EAAE,GAAG,CAAC,WAAW,EAAE,cAAc,IAAI,GAAG;gBACtD,oBAAoB,EAAE,GAAG,CAAC,WAAW,EAAE,mBAAmB,IAAI,GAAG;gBACjE,mBAAmB,EAAE,GAAG,CAAC,WAAW,EAAE,mBAAmB,IAAI,GAAG;aACjE;YACD,KAAK,EAAE;gBACL,UAAU,EAAE,GAAG,CAAC,KAAK,EAAE,QAAQ,EAAE,CAAC,IAAI,CAAC;gBACvC,YAAY,EAAE,GAAG,CAAC,KAAK,EAAE,UAAU,EAAE,CAAC,IAAI,CAAC;gBAC3C,YAAY,EAAE,GAAG,CAAC,KAAK,EAAE,UAAU,EAAE,CAAC,IAAI,CAAC;gBAC3C,0BAA0B,EAAE,GAAG,CAAC,KAAK,EAAE,UAAU,EAAE,eAAe,IAAI,IAAI;gBAC1E,gBAAgB,EAAE,IAAI;aACvB;YACD,UAAU,EAAE;gBACV,QAAQ,EAAE,GAAG,CAAC,UAAU,EAAE,QAAQ,IAAI,QAAQ;gBAC9C,KAAK,EAAE,GAAG,CAAC,UAAU,EAAE,KAAK,IAAI,4BAA4B;gBAC5D,IAAI,EAAE,GAAG,CAAC,UAAU,EAAE,UAAU,IAAI,IAAI;gBACxC,UAAU,EAAE,GAAG,CAAC,UAAU,EAAE,UAAU,IAAI,IAAI;gBAC9C,iBAAiB,EAAE,GAAG,CAAC,UAAU,EAAE,iBAAiB,IAAI,IAAI;aAC7D;YACD,UAAU,EAAE;gBACV,SAAS,EAAE,GAAG,CAAC,UAAU,EAAE,YAAY,IAAI,IAAI;gBAC/C,YAAY,EAAE,GAAG,CAAC,UAAU,EAAE,YAAY,IAAI,IAAI;gBAClD,aAAa,EAAE,GAAG,CAAC,UAAU,EAAE,aAAa,IAAI,KAAK;aACtD;YACD,QAAQ,EAAE;gBACR,oBAAoB,EAAE,GAAG,CAAC,QAAQ,EAAE,oBAAoB,IAAI,IAAI;gBAChE,qBAAqB,EAAE,GAAG,CAAC,QAAQ,EAAE,qBAAqB,IAAI,IAAI;gBAClE,qBAAqB,EAAE,GAAG,CAAC,QAAQ,EAAE,qBAAqB,IAAI,IAAI;aACnE;SACF,CAAC;QAEF,OAAO,WAAW,CAAC;IACrB,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,wDAAwD;QACxD,OAAO,CAAC,IAAI,CAAC,8CAA8C,UAAU,mBAAmB,EAAE,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;QAClJ,WAAW,GAAG,cAAc,CAAC;QAC7B,OAAO,WAAW,CAAC;IACrB,CAAC;AACH,CAAC;AAED,MAAM,UAAU,gBAAgB;IAC9B,WAAW,GAAG,IAAI,CAAC;AACrB,CAAC","sourcesContent":["import { parse } from 'yaml';\nimport { readFileSync, existsSync } from 'fs';\nimport { join, dirname } from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nexport interface ReasoningBankConfig {\n  retrieve: {\n    k: number;\n    alpha: number;\n    beta: number;\n    gamma: number;\n    delta: number;\n    recency_half_life_days: number;\n    min_score: number;\n  };\n  judge: {\n    model: string;\n    max_tokens: number;\n    temperature: number;\n    confidence_threshold?: number;\n  };\n  distill: {\n    model?: string;\n    max_tokens?: number;\n    temperature?: number;\n    max_items_success: number;\n    max_items_failure: number;\n    confidence_prior_success: number;\n    confidence_prior_failure: number;\n  };\n  consolidate: {\n    duplicate_threshold: number;\n    contradiction_threshold: number;\n    trigger_threshold: number;\n    prune_age_days: number;\n    prune_min_confidence: number;\n    min_confidence_keep: number;\n  };\n  matts: {\n    parallel_k: number;\n    sequential_k: number;\n    sequential_r: number;\n    sequential_stop_on_success: boolean;\n    confidence_boost: number;\n  };\n  embeddings: {\n    provider: 'claude' | 'openai';\n    model: string;\n    dims: number;\n    dimensions: number;\n    cache_ttl_seconds: number;\n  };\n  governance: {\n    scrub_pii?: boolean;\n    pii_scrubber: boolean;\n    tenant_scoped?: boolean;\n  };\n  features?: {\n    enable_pre_task_hook?: boolean;\n    enable_post_task_hook?: boolean;\n    enable_matts_parallel?: boolean;\n  };\n}\n\nlet configCache: ReasoningBankConfig | null = null;\n\n// Default configuration\nconst DEFAULT_CONFIG: ReasoningBankConfig = {\n  retrieve: {\n    k: 3,\n    alpha: 0.65,\n    beta: 0.15,\n    gamma: 0.20,\n    delta: 0.10,\n    recency_half_life_days: 45,\n    min_score: 0.3\n  },\n  judge: {\n    model: 'claude-sonnet-4-5-20250929',\n    max_tokens: 512,\n    temperature: 0,\n    confidence_threshold: 0.5\n  },\n  distill: {\n    model: undefined,\n    max_tokens: undefined,\n    temperature: undefined,\n    max_items_success: 3,\n    max_items_failure: 2,\n    confidence_prior_success: 0.75,\n    confidence_prior_failure: 0.60\n  },\n  consolidate: {\n    duplicate_threshold: 0.95,\n    contradiction_threshold: 0.85,\n    trigger_threshold: 20,\n    prune_age_days: 180,\n    prune_min_confidence: 0.3,\n    min_confidence_keep: 0.5\n  },\n  matts: {\n    parallel_k: 3,\n    sequential_k: 5,\n    sequential_r: 5,\n    sequential_stop_on_success: true,\n    confidence_boost: 0.05\n  },\n  embeddings: {\n    provider: 'claude',\n    model: 'claude-sonnet-4-5-20250929',\n    dims: 1024,\n    dimensions: 1024,\n    cache_ttl_seconds: 3600\n  },\n  governance: {\n    scrub_pii: true,\n    pii_scrubber: true,\n    tenant_scoped: false\n  },\n  features: {\n    enable_pre_task_hook: true,\n    enable_post_task_hook: true,\n    enable_matts_parallel: true\n  }\n};\n\n// Try multiple paths to find config file\nfunction findConfigPath(): string | null {\n  const paths = [\n    // Development: relative to source file\n    join(__dirname, '../config/reasoningbank.yaml'),\n    // npm package: relative to dist file\n    join(__dirname, '../../config/reasoningbank.yaml'),\n    // User override: current working directory\n    join(process.cwd(), '.swarm/reasoningbank.yaml'),\n    join(process.cwd(), 'reasoningbank.yaml')\n  ];\n\n  for (const path of paths) {\n    if (existsSync(path)) {\n      return path;\n    }\n  }\n\n  return null;\n}\n\nexport function loadConfig(): ReasoningBankConfig {\n  if (configCache) return configCache;\n\n  const configPath = findConfigPath();\n\n  // If no config file found, use defaults\n  if (!configPath) {\n    configCache = DEFAULT_CONFIG;\n    return configCache;\n  }\n\n  try {\n    const yamlContent = readFileSync(configPath, 'utf-8');\n    const parsed = parse(yamlContent) as any;\n\n    // Handle nested reasoningbank: key\n    const raw = parsed.reasoningbank || parsed;\n\n    // Map the full config to our simplified interface\n    configCache = {\n      retrieve: {\n        k: raw.retrieve?.k ?? 3,\n        alpha: raw.retrieve?.alpha ?? 0.65,\n        beta: raw.retrieve?.beta ?? 0.15,\n        gamma: raw.retrieve?.gamma ?? 0.20,\n        delta: raw.retrieve?.delta ?? 0.10,\n        recency_half_life_days: raw.retrieve?.recency_half_life_days ?? 45,\n        min_score: raw.retrieve?.min_score ?? 0.3\n      },\n      judge: {\n        model: raw.judge?.model ?? 'claude-sonnet-4-5-20250929',\n        max_tokens: raw.judge?.max_tokens ?? 512,\n        temperature: raw.judge?.temperature ?? 0,\n        confidence_threshold: raw.judge?.fallback_confidence ?? 0.5\n      },\n      distill: {\n        model: raw.distill?.model,\n        max_tokens: raw.distill?.max_tokens,\n        temperature: raw.distill?.temperature,\n        max_items_success: raw.distill?.max_items_per_trajectory ?? 3,\n        max_items_failure: 2,\n        confidence_prior_success: raw.distill?.success_confidence_prior ?? 0.75,\n        confidence_prior_failure: raw.distill?.failure_confidence_prior ?? 0.60\n      },\n      consolidate: {\n        duplicate_threshold: raw.consolidate?.dedup_similarity_threshold ?? 0.95,\n        contradiction_threshold: raw.consolidate?.contradiction_threshold ?? 0.85,\n        trigger_threshold: raw.consolidate?.run_every_new_items ?? 20,\n        prune_age_days: raw.consolidate?.prune_age_days ?? 180,\n        prune_min_confidence: raw.consolidate?.min_confidence_keep ?? 0.3,\n        min_confidence_keep: raw.consolidate?.min_confidence_keep ?? 0.5\n      },\n      matts: {\n        parallel_k: raw.matts?.parallel?.k ?? 3,\n        sequential_k: raw.matts?.sequential?.r ?? 5,\n        sequential_r: raw.matts?.sequential?.r ?? 5,\n        sequential_stop_on_success: raw.matts?.sequential?.stop_on_success ?? true,\n        confidence_boost: 0.05\n      },\n      embeddings: {\n        provider: raw.embeddings?.provider ?? 'claude',\n        model: raw.embeddings?.model ?? 'claude-sonnet-4-5-20250929',\n        dims: raw.embeddings?.dimensions ?? 1024,\n        dimensions: raw.embeddings?.dimensions ?? 1024,\n        cache_ttl_seconds: raw.embeddings?.cache_ttl_seconds ?? 3600\n      },\n      governance: {\n        scrub_pii: raw.governance?.pii_scrubber ?? true,\n        pii_scrubber: raw.governance?.pii_scrubber ?? true,\n        tenant_scoped: raw.governance?.tenant_scoped ?? false\n      },\n      features: {\n        enable_pre_task_hook: raw.features?.enable_pre_task_hook ?? true,\n        enable_post_task_hook: raw.features?.enable_post_task_hook ?? true,\n        enable_matts_parallel: raw.features?.enable_matts_parallel ?? true\n      }\n    };\n\n    return configCache;\n  } catch (error) {\n    // If config file exists but can't be read, use defaults\n    console.warn(`[ReasoningBank] Could not load config from ${configPath}, using defaults:`, error instanceof Error ? error.message : String(error));\n    configCache = DEFAULT_CONFIG;\n    return configCache;\n  }\n}\n\nexport function clearConfigCache() {\n  configCache = null;\n}\n"]}