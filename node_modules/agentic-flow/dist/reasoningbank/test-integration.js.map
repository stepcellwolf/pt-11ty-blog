{"version":3,"file":"test-integration.js","sourceRoot":"","sources":["../../src/reasoningbank/test-integration.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n/**\n * Integration test for ReasoningBank\n * Tests the full workflow: retrieve â†’ judge â†’ distill â†’ consolidate\n */\n\nimport { initialize, runTask } from './index.js';\nimport type { Trajectory } from './db/schema.js';\n\nconsole.log('ğŸ§ª ReasoningBank Integration Test\\n');\n\nasync function main() {\n  // 1. Initialize\n  console.log('1ï¸âƒ£ Initializing ReasoningBank...');\n  await initialize();\n  console.log('   âœ… Initialization complete\\n');\n\n  // 2. Test full task execution\n  console.log('2ï¸âƒ£ Testing full task execution...');\n\n  const result = await runTask({\n    taskId: 'test-task-001',\n    agentId: 'test-agent',\n    query: 'Test login to admin panel with CSRF validation',\n    domain: 'test.web',\n    executeFn: async (memories) => {\n      console.log(`   ğŸ“ Received ${memories.length} memories for task execution`);\n\n      // Simulate a successful task trajectory\n      const trajectory: Trajectory = {\n        steps: [\n          { action: 'navigate', url: 'https://admin.test.com/login' },\n          { action: 'extract_csrf', location: 'meta[name=csrf-token]', success: true },\n          { action: 'fill_form', fields: { username: 'admin', password: '***', csrf: '[TOKEN]' } },\n          { action: 'submit', status: 200 },\n          { action: 'verify_redirect', url: '/dashboard', success: true },\n          { action: 'complete', message: 'Login successful' }\n        ],\n        metadata: {\n          duration_ms: 1234,\n          steps_count: 6\n        }\n      };\n\n      return trajectory;\n    }\n  });\n\n  console.log(`   âœ… Task complete:`);\n  console.log(`      - Verdict: ${result.verdict.label} (${result.verdict.confidence})`);\n  console.log(`      - Used memories: ${result.usedMemories.length}`);\n  console.log(`      - New memories: ${result.newMemories.length}`);\n  console.log(`      - Consolidated: ${result.consolidated ? 'Yes' : 'No'}\\n`);\n\n  // 3. Test retrieval\n  console.log('3ï¸âƒ£ Testing memory retrieval...');\n  const { retrieveMemories } = await import('./core/retrieve.js');\n\n  const memories = await retrieveMemories('How to handle CSRF tokens in login forms?', {\n    domain: 'test.web',\n    k: 3\n  });\n\n  console.log(`   âœ… Retrieved ${memories.length} memories`);\n  if (memories.length > 0) {\n    console.log(`      - Top memory: \"${memories[0].title}\"`);\n    console.log(`      - Score: ${memories[0].score.toFixed(3)}`);\n    console.log(`      - Similarity: ${(memories[0].components.similarity * 100).toFixed(1)}%\\n`);\n  }\n\n  // 4. Test MaTTS (if enabled)\n  const config = await import('./utils/config.js').then(m => m.loadConfig());\n  if (config.features?.enable_matts_parallel) {\n    console.log('4ï¸âƒ£ Testing MaTTS parallel mode...');\n    const { mattsParallel } = await import('./core/matts.js');\n\n    const mattsResult = await mattsParallel(\n      async () => ({\n        steps: [\n          { action: 'test', result: 'success' }\n        ],\n        metadata: {}\n      }),\n      'Test MaTTS execution',\n      { k: 3, taskId: 'matts-test', domain: 'test.matts' }\n    );\n\n    console.log(`   âœ… MaTTS complete:`);\n    console.log(`      - Trajectories: ${mattsResult.trajectories.length}`);\n    console.log(`      - Success rate: ${(mattsResult.successRate * 100).toFixed(1)}%`);\n    console.log(`      - Aggregated memories: ${mattsResult.aggregatedMemories.length}`);\n    console.log(`      - Duration: ${mattsResult.duration}ms\\n`);\n  }\n\n  // 5. Database statistics\n  console.log('5ï¸âƒ£ Database statistics...');\n  const { getDb } = await import('./db/queries.js');\n  const db = getDb();\n\n  const totalMemories = db.prepare(\"SELECT COUNT(*) as count FROM patterns WHERE type = 'reasoning_memory'\").get() as { count: number };\n  const totalEmbeddings = db.prepare('SELECT COUNT(*) as count FROM pattern_embeddings').get() as { count: number };\n\n  console.log(`   âœ… Database status:`);\n  console.log(`      - Total memories: ${totalMemories.count}`);\n  console.log(`      - Total embeddings: ${totalEmbeddings.count}\\n`);\n\n  console.log('âœ… Integration test complete!\\n');\n  process.exit(0);\n}\n\nmain().catch(error => {\n  console.error('âŒ Integration test failed:', error);\n  process.exit(1);\n});\n"]}