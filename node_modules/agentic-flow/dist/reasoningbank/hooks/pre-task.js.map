{"version":3,"file":"pre-task.js","sourceRoot":"","sources":["../../../src/reasoningbank/hooks/pre-task.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n/**\n * Pre-Task Hook for ReasoningBank\n * Retrieves and injects relevant memories before task execution\n *\n * Usage: tsx hooks/pre-task.ts --task-id <id> --query <query> [--domain <domain>] [--agent <agent>]\n */\n\nimport { retrieveMemories, formatMemoriesForPrompt } from '../core/retrieve.js';\nimport { loadConfig } from '../utils/config.js';\n\n// Parse command line arguments\nfunction parseArgs(): { taskId: string; query: string; domain?: string; agent?: string } {\n  const args = process.argv.slice(2);\n  const parsed: any = {};\n\n  for (let i = 0; i < args.length; i += 2) {\n    const key = args[i].replace(/^--/, '');\n    const value = args[i + 1];\n    if (key === 'task-id') parsed.taskId = value;\n    else if (key === 'query') parsed.query = value;\n    else if (key === 'domain') parsed.domain = value;\n    else if (key === 'agent') parsed.agent = value;\n  }\n\n  if (!parsed.taskId || !parsed.query) {\n    console.error('Usage: pre-task.ts --task-id <id> --query <query> [--domain <domain>] [--agent <agent>]');\n    process.exit(1);\n  }\n\n  return parsed;\n}\n\nasync function main() {\n  const config = loadConfig();\n\n  // Check if ReasoningBank is enabled\n  if (!config.features?.enable_pre_task_hook) {\n    console.log('[INFO] ReasoningBank pre-task hook is disabled');\n    process.exit(0);\n  }\n\n  const args = parseArgs();\n\n  console.log(`[PRE-TASK] Task ID: ${args.taskId}`);\n  console.log(`[PRE-TASK] Query: ${args.query}`);\n\n  try {\n    // Retrieve relevant memories\n    const memories = await retrieveMemories(args.query, {\n      domain: args.domain,\n      agent: args.agent,\n      k: config.retrieve.k\n    });\n\n    if (memories.length === 0) {\n      console.log('[PRE-TASK] No relevant memories found');\n      process.exit(0);\n    }\n\n    console.log(`[PRE-TASK] Retrieved ${memories.length} relevant memories`);\n\n    // Format for injection into system prompt\n    const formattedMemories = formatMemoriesForPrompt(memories);\n\n    // Output to stdout for injection\n    // The agent system should capture this and inject into the system prompt\n    console.log('\\n=== MEMORIES FOR INJECTION ===');\n    console.log(formattedMemories);\n    console.log('=== END MEMORIES ===\\n');\n\n    process.exit(0);\n  } catch (error) {\n    console.error('[PRE-TASK ERROR]', error);\n    process.exit(1);\n  }\n}\n\nmain();\n"]}