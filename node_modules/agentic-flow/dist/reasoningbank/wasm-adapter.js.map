{"version":3,"file":"wasm-adapter.js","sourceRoot":"","sources":["../../src/reasoningbank/wasm-adapter.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * ReasoningBank WASM Adapter\n *\n * TypeScript wrapper for the Rust WASM ReasoningBank implementation.\n * Provides browser and Node.js compatibility with auto-detection of storage backends.\n *\n * Features:\n * - IndexedDB storage (browser preferred)\n * - sql.js fallback (browser backup)\n * - Native performance via WASM\n * - Async/await API\n * - Type-safe interfaces\n */\n\nimport * as ReasoningBankWasm from '../../wasm/reasoningbank/reasoningbank_wasm.js';\n\nexport interface PatternInput {\n  task_description: string;\n  task_category: string;\n  strategy: string;\n  success_score: number;\n  duration_seconds?: number;\n}\n\nexport interface Pattern {\n  id: string;\n  task_description: string;\n  task_category: string;\n  strategy: string;\n  success_score?: number;\n  duration_seconds?: number;\n  created_at: string;\n  updated_at?: string;\n}\n\nexport interface SimilarPattern {\n  pattern: Pattern;\n  similarity_score: number;\n}\n\nexport interface StorageStats {\n  total_patterns: number;\n  categories: number;\n  avg_success_score: number;\n  storage_backend: string;\n}\n\n/**\n * ReasoningBank WASM Adapter\n *\n * Provides a TypeScript-friendly interface to the Rust WASM implementation.\n * Automatically selects the best storage backend for the environment.\n */\nexport class ReasoningBankAdapter {\n  private wasmInstance: ReasoningBankWasm.ReasoningBankWasm | null = null;\n  private initPromise: Promise<void>;\n\n  /**\n   * Create a new ReasoningBank instance\n   *\n   * @param dbName - Optional database name (default: \"reasoningbank\")\n   */\n  constructor(dbName?: string) {\n    this.initPromise = this.initialize(dbName);\n  }\n\n  private async initialize(dbName?: string): Promise<void> {\n    try {\n      this.wasmInstance = new ReasoningBankWasm.ReasoningBankWasm(dbName || 'reasoningbank');\n    } catch (error) {\n      throw new Error(`Failed to initialize ReasoningBank WASM: ${error}`);\n    }\n  }\n\n  private async ensureInitialized(): Promise<ReasoningBankWasm.ReasoningBankWasm> {\n    await this.initPromise;\n    if (!this.wasmInstance) {\n      throw new Error('ReasoningBank WASM not initialized');\n    }\n    return this.wasmInstance;\n  }\n\n  /**\n   * Store a reasoning pattern\n   *\n   * @param pattern - Pattern input data\n   * @returns Pattern UUID\n   */\n  async storePattern(pattern: PatternInput): Promise<string> {\n    const wasm = await this.ensureInitialized();\n    const json = JSON.stringify(pattern);\n    return await wasm.storePattern(json);\n  }\n\n  /**\n   * Retrieve a pattern by ID\n   *\n   * @param id - Pattern UUID\n   * @returns Pattern or null if not found\n   */\n  async getPattern(id: string): Promise<Pattern | null> {\n    const wasm = await this.ensureInitialized();\n    try {\n      const json = await wasm.getPattern(id);\n      return json ? JSON.parse(json) : null;\n    } catch (error) {\n      if (error instanceof Error && error.message.includes('not found')) {\n        return null;\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Search patterns by category\n   *\n   * @param category - Task category\n   * @param limit - Maximum number of results (default: 10)\n   * @returns Array of patterns\n   */\n  async searchByCategory(category: string, limit: number = 10): Promise<Pattern[]> {\n    const wasm = await this.ensureInitialized();\n    const json = await wasm.searchByCategory(category, limit);\n    return JSON.parse(json);\n  }\n\n  /**\n   * Find similar patterns\n   *\n   * @param taskDescription - Task description to match\n   * @param taskCategory - Task category\n   * @param topK - Number of similar patterns to return (default: 5)\n   * @returns Array of similar patterns with similarity scores\n   */\n  async findSimilar(\n    taskDescription: string,\n    taskCategory: string,\n    topK: number = 5\n  ): Promise<SimilarPattern[]> {\n    const wasm = await this.ensureInitialized();\n    const json = await wasm.findSimilar(taskDescription, taskCategory, topK);\n    return JSON.parse(json);\n  }\n\n  /**\n   * Get storage statistics\n   *\n   * @returns Storage stats including total patterns, categories, and backend info\n   */\n  async getStats(): Promise<StorageStats> {\n    const wasm = await this.ensureInitialized();\n    const json = await wasm.getStats();\n    return JSON.parse(json);\n  }\n}\n\n/**\n * Create a new ReasoningBank instance\n *\n * @param dbName - Optional database name\n * @returns ReasoningBank adapter instance\n */\nexport async function createReasoningBank(dbName?: string): Promise<ReasoningBankAdapter> {\n  const adapter = new ReasoningBankAdapter(dbName);\n  await adapter.getStats(); // Ensure initialization\n  return adapter;\n}\n\nexport default ReasoningBankAdapter;\n"]}