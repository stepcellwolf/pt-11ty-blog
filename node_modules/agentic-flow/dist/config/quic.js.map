{"version":3,"file":"quic.js","sourceRoot":"","sources":["../../src/config/quic.ts"],"names":[],"mappings":"AAAA,4BAA4B;AAC5B,qDAAqD;AAGrD,OAAO,EAAE,MAAM,EAAE,MAAM,oBAAoB,CAAC;AAiB5C;;GAEG;AACH,MAAM,CAAC,MAAM,mBAAmB,GAAqB;IACnD,OAAO,EAAE,KAAK;IACd,UAAU,EAAE,IAAI;IAChB,eAAe,EAAE,IAAI;IAErB,sBAAsB;IACtB,IAAI,EAAE,SAAS;IACf,IAAI,EAAE,IAAI;IACV,UAAU,EAAE,WAAW;IACvB,UAAU,EAAE,IAAI;IAChB,UAAU,EAAE,IAAI;IAEhB,mBAAmB;IACnB,QAAQ,EAAE,kBAAkB;IAC5B,OAAO,EAAE,iBAAiB;IAE1B,kBAAkB;IAClB,cAAc,EAAE,GAAG;IACnB,iBAAiB,EAAE,KAAK;IACxB,WAAW,EAAE,KAAK;IAElB,sBAAsB;IACtB,oBAAoB,EAAE,GAAG;IACzB,aAAa,EAAE,KAAK;IAEpB,qBAAqB;IACrB,uBAAuB,EAAE,EAAE;IAC3B,eAAe,EAAE,IAAI;IACrB,eAAe,EAAE,IAAI;IAErB,eAAe;IACf,WAAW,EAAE;QACX,OAAO,EAAE,IAAI;QACb,QAAQ,EAAE,KAAK,EAAE,aAAa;QAC9B,OAAO,EAAE,IAAI,CAAC,YAAY;KAC3B;IAED,aAAa;IACb,UAAU,EAAE;QACV,OAAO,EAAE,IAAI;QACb,WAAW,EAAE,KAAK,CAAC,WAAW;KAC/B;CACF,CAAC;AAEF;;GAEG;AACH,MAAM,UAAU,cAAc,CAAC,YAAuC,EAAE;IACtE,MAAM,MAAM,GAAqB;QAC/B,GAAG,mBAAmB;QACtB,GAAG,SAAS;KACb,CAAC;IAEF,iCAAiC;IACjC,IAAI,OAAO,CAAC,GAAG,CAAC,wBAAwB,KAAK,SAAS,EAAE,CAAC;QACvD,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,wBAAwB,KAAK,MAAM,CAAC;IACnE,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC;QAC1B,MAAM,CAAC,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;IAChD,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC;QAC1B,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC;IACtC,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACjC,MAAM,CAAC,UAAU,GAAG,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC;IACnD,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACjC,MAAM,CAAC,UAAU,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;IAC7D,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,CAAC;QAC/B,MAAM,CAAC,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC;IAC/C,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC;QAC9B,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC;IAC7C,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,CAAC;QACrC,MAAM,CAAC,cAAc,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;IACrE,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC;QACjC,MAAM,CAAC,oBAAoB,GAAG,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;IACvE,CAAC;IAED,IAAI,OAAO,CAAC,GAAG,CAAC,gBAAgB,KAAK,SAAS,EAAE,CAAC;QAC/C,MAAM,CAAC,UAAU,GAAG,OAAO,CAAC,GAAG,CAAC,gBAAgB,KAAK,MAAM,CAAC;IAC9D,CAAC;IAED,yBAAyB;IACzB,kBAAkB,CAAC,MAAM,CAAC,CAAC;IAE3B,MAAM,CAAC,IAAI,CAAC,2BAA2B,EAAE;QACvC,OAAO,EAAE,MAAM,CAAC,OAAO;QACvB,IAAI,EAAE,MAAM,CAAC,IAAI;QACjB,IAAI,EAAE,MAAM,CAAC,IAAI;QACjB,cAAc,EAAE,MAAM,CAAC,cAAc;QACrC,kBAAkB,EAAE,MAAM,CAAC,WAAW,CAAC,OAAO;KAC/C,CAAC,CAAC;IAEH,OAAO,MAAM,CAAC;AAChB,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,kBAAkB,CAAC,MAAwB;IACzD,MAAM,MAAM,GAAa,EAAE,CAAC;IAE5B,kBAAkB;IAClB,IAAI,MAAM,CAAC,IAAK,GAAG,CAAC,IAAI,MAAM,CAAC,IAAK,GAAG,KAAK,EAAE,CAAC;QAC7C,MAAM,CAAC,IAAI,CAAC,iBAAiB,MAAM,CAAC,IAAI,gCAAgC,CAAC,CAAC;IAC5E,CAAC;IAED,IAAI,MAAM,CAAC,UAAW,GAAG,CAAC,IAAI,MAAM,CAAC,UAAW,GAAG,KAAK,EAAE,CAAC;QACzD,MAAM,CAAC,IAAI,CAAC,wBAAwB,MAAM,CAAC,UAAU,gCAAgC,CAAC,CAAC;IACzF,CAAC;IAED,oBAAoB;IACpB,IAAI,MAAM,CAAC,cAAe,GAAG,CAAC,EAAE,CAAC;QAC/B,MAAM,CAAC,IAAI,CAAC,2BAA2B,MAAM,CAAC,cAAc,uBAAuB,CAAC,CAAC;IACvF,CAAC;IAED,IAAI,MAAM,CAAC,oBAAqB,GAAG,CAAC,EAAE,CAAC;QACrC,MAAM,CAAC,IAAI,CAAC,iCAAiC,MAAM,CAAC,oBAAoB,uBAAuB,CAAC,CAAC;IACnG,CAAC;IAED,WAAW;IACX,IAAI,MAAM,CAAC,iBAAkB,GAAG,IAAI,EAAE,CAAC;QACrC,MAAM,CAAC,IAAI,CAAC,8BAA8B,MAAM,CAAC,iBAAiB,4BAA4B,CAAC,CAAC;IAClG,CAAC;IAED,IAAI,MAAM,CAAC,WAAY,GAAG,IAAI,EAAE,CAAC;QAC/B,MAAM,CAAC,IAAI,CAAC,wBAAwB,MAAM,CAAC,WAAW,4BAA4B,CAAC,CAAC;IACtF,CAAC;IAED,IAAI,MAAM,CAAC,aAAc,GAAG,IAAI,EAAE,CAAC;QACjC,MAAM,CAAC,IAAI,CAAC,0BAA0B,MAAM,CAAC,aAAa,4BAA4B,CAAC,CAAC;IAC1F,CAAC;IAED,qBAAqB;IACrB,IAAI,MAAM,CAAC,uBAAwB,GAAG,CAAC,EAAE,CAAC;QACxC,MAAM,CAAC,IAAI,CAAC,oCAAoC,MAAM,CAAC,uBAAuB,uBAAuB,CAAC,CAAC;IACzG,CAAC;IAED,IAAI,MAAM,CAAC,eAAgB,GAAG,IAAI,IAAI,MAAM,CAAC,eAAgB,GAAG,KAAK,EAAE,CAAC;QACtE,MAAM,CAAC,IAAI,CAAC,4BAA4B,MAAM,CAAC,eAAe,mCAAmC,CAAC,CAAC;IACrG,CAAC;IAED,+BAA+B;IAC/B,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,UAAU,EAAE,CAAC;QACxC,MAAM,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;QACzB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC;YACpC,MAAM,CAAC,IAAI,CAAC,0BAA0B,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC3D,CAAC;QACD,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;YACnC,MAAM,CAAC,IAAI,CAAC,0BAA0B,MAAM,CAAC,OAAO,EAAE,CAAC,CAAC;QAC1D,CAAC;IACH,CAAC;IAED,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QACtB,MAAM,YAAY,GAAG,0CAA0C,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;QACnF,MAAM,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;QAC3B,MAAM,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC;IAChC,CAAC;AACH,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,mBAAmB,CAAC,MAAwB;IAC1D,OAAO;QACL,SAAS,EAAE;YACT,IAAI,EAAE;gBACJ,OAAO,EAAE,MAAM,CAAC,OAAO;gBACvB,IAAI,EAAE,MAAM,CAAC,IAAI;gBACjB,IAAI,EAAE,MAAM,CAAC,IAAI;gBACjB,cAAc,EAAE,MAAM,CAAC,cAAc;gBACrC,QAAQ,EAAE,MAAM,CAAC,QAAQ;gBACzB,OAAO,EAAE,MAAM,CAAC,OAAO;aACxB;YACD,QAAQ,EAAE;gBACR,OAAO,EAAE,MAAM,CAAC,eAAe;gBAC/B,QAAQ,EAAE,OAAO;aAClB;SACF;KACF,CAAC;AACJ,CAAC;AAED;;GAEG;AACH,MAAM,CAAC,KAAK,UAAU,qBAAqB;IAIzC,IAAI,CAAC;QACH,oCAAoC;QACpC,0DAA0D;QAC1D,MAAM,aAAa,GAAG,IAAI,CAAC,CAAC,cAAc;QAE1C,IAAI,CAAC,aAAa,EAAE,CAAC;YACnB,OAAO;gBACL,SAAS,EAAE,KAAK;gBAChB,MAAM,EAAE,gCAAgC;aACzC,CAAC;QACJ,CAAC;QAED,gDAAgD;QAChD,MAAM,MAAM,GAAG,cAAc,EAAE,CAAC;QAChC,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,UAAU,EAAE,CAAC;YACxC,MAAM,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;YACzB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;gBACtE,OAAO;oBACL,SAAS,EAAE,KAAK;oBAChB,MAAM,EAAE,4BAA4B;iBACrC,CAAC;YACJ,CAAC;QACH,CAAC;QAED,OAAO,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC;IAC7B,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,MAAM,CAAC,KAAK,CAAC,kCAAkC,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;QAC5D,OAAO;YACL,SAAS,EAAE,KAAK;YAChB,MAAM,EAAG,KAAe,CAAC,OAAO;SACjC,CAAC;IACJ,CAAC;AACH,CAAC;AAED;;GAEG;AACH,MAAM,UAAU,aAAa,CAAC,YAAuC,EAAE;IACrE,OAAO,cAAc,CAAC,SAAS,CAAC,CAAC;AACnC,CAAC","sourcesContent":["// QUIC Configuration Schema\n// Validates and manages QUIC transport configuration\n\nimport { QuicConfig } from '../transport/quic.js';\nimport { logger } from '../utils/logger.js';\n\nexport interface QuicConfigSchema extends QuicConfig {\n  enabled: boolean;\n  autoDetect: boolean;\n  fallbackToHttp2: boolean;\n  healthCheck: {\n    enabled: boolean;\n    interval: number;\n    timeout: number;\n  };\n  monitoring: {\n    enabled: boolean;\n    logInterval: number;\n  };\n}\n\n/**\n * Default QUIC configuration\n */\nexport const DEFAULT_QUIC_CONFIG: QuicConfigSchema = {\n  enabled: false,\n  autoDetect: true,\n  fallbackToHttp2: true,\n\n  // Connection settings\n  host: '0.0.0.0',\n  port: 4433,\n  serverHost: 'localhost',\n  serverPort: 4433,\n  verifyPeer: true,\n\n  // TLS certificates\n  certPath: './certs/cert.pem',\n  keyPath: './certs/key.pem',\n\n  // Connection pool\n  maxConnections: 100,\n  connectionTimeout: 30000,\n  idleTimeout: 60000,\n\n  // Stream multiplexing\n  maxConcurrentStreams: 100,\n  streamTimeout: 30000,\n\n  // Performance tuning\n  initialCongestionWindow: 10,\n  maxDatagramSize: 1200,\n  enableEarlyData: true,\n\n  // Health check\n  healthCheck: {\n    enabled: true,\n    interval: 30000, // 30 seconds\n    timeout: 5000 // 5 seconds\n  },\n\n  // Monitoring\n  monitoring: {\n    enabled: true,\n    logInterval: 60000 // 1 minute\n  }\n};\n\n/**\n * Load QUIC configuration from environment and config file\n */\nexport function loadQuicConfig(overrides: Partial<QuicConfigSchema> = {}): QuicConfigSchema {\n  const config: QuicConfigSchema = {\n    ...DEFAULT_QUIC_CONFIG,\n    ...overrides\n  };\n\n  // Environment variable overrides\n  if (process.env.AGENTIC_FLOW_ENABLE_QUIC !== undefined) {\n    config.enabled = process.env.AGENTIC_FLOW_ENABLE_QUIC === 'true';\n  }\n\n  if (process.env.QUIC_PORT) {\n    config.port = parseInt(process.env.QUIC_PORT);\n  }\n\n  if (process.env.QUIC_HOST) {\n    config.host = process.env.QUIC_HOST;\n  }\n\n  if (process.env.QUIC_SERVER_HOST) {\n    config.serverHost = process.env.QUIC_SERVER_HOST;\n  }\n\n  if (process.env.QUIC_SERVER_PORT) {\n    config.serverPort = parseInt(process.env.QUIC_SERVER_PORT);\n  }\n\n  if (process.env.QUIC_CERT_PATH) {\n    config.certPath = process.env.QUIC_CERT_PATH;\n  }\n\n  if (process.env.QUIC_KEY_PATH) {\n    config.keyPath = process.env.QUIC_KEY_PATH;\n  }\n\n  if (process.env.QUIC_MAX_CONNECTIONS) {\n    config.maxConnections = parseInt(process.env.QUIC_MAX_CONNECTIONS);\n  }\n\n  if (process.env.QUIC_MAX_STREAMS) {\n    config.maxConcurrentStreams = parseInt(process.env.QUIC_MAX_STREAMS);\n  }\n\n  if (process.env.QUIC_VERIFY_PEER !== undefined) {\n    config.verifyPeer = process.env.QUIC_VERIFY_PEER === 'true';\n  }\n\n  // Validate configuration\n  validateQuicConfig(config);\n\n  logger.info('QUIC configuration loaded', {\n    enabled: config.enabled,\n    host: config.host,\n    port: config.port,\n    maxConnections: config.maxConnections,\n    healthCheckEnabled: config.healthCheck.enabled\n  });\n\n  return config;\n}\n\n/**\n * Validate QUIC configuration\n */\nexport function validateQuicConfig(config: QuicConfigSchema): void {\n  const errors: string[] = [];\n\n  // Port validation\n  if (config.port! < 1 || config.port! > 65535) {\n    errors.push(`Invalid port: ${config.port}. Must be between 1 and 65535.`);\n  }\n\n  if (config.serverPort! < 1 || config.serverPort! > 65535) {\n    errors.push(`Invalid server port: ${config.serverPort}. Must be between 1 and 65535.`);\n  }\n\n  // Connection limits\n  if (config.maxConnections! < 1) {\n    errors.push(`Invalid maxConnections: ${config.maxConnections}. Must be at least 1.`);\n  }\n\n  if (config.maxConcurrentStreams! < 1) {\n    errors.push(`Invalid maxConcurrentStreams: ${config.maxConcurrentStreams}. Must be at least 1.`);\n  }\n\n  // Timeouts\n  if (config.connectionTimeout! < 1000) {\n    errors.push(`Invalid connectionTimeout: ${config.connectionTimeout}. Must be at least 1000ms.`);\n  }\n\n  if (config.idleTimeout! < 1000) {\n    errors.push(`Invalid idleTimeout: ${config.idleTimeout}. Must be at least 1000ms.`);\n  }\n\n  if (config.streamTimeout! < 1000) {\n    errors.push(`Invalid streamTimeout: ${config.streamTimeout}. Must be at least 1000ms.`);\n  }\n\n  // Performance tuning\n  if (config.initialCongestionWindow! < 1) {\n    errors.push(`Invalid initialCongestionWindow: ${config.initialCongestionWindow}. Must be at least 1.`);\n  }\n\n  if (config.maxDatagramSize! < 1200 || config.maxDatagramSize! > 65527) {\n    errors.push(`Invalid maxDatagramSize: ${config.maxDatagramSize}. Must be between 1200 and 65527.`);\n  }\n\n  // TLS certificates (warn only)\n  if (config.enabled && config.verifyPeer) {\n    const fs = require('fs');\n    if (!fs.existsSync(config.certPath)) {\n      logger.warn(`Certificate not found: ${config.certPath}`);\n    }\n    if (!fs.existsSync(config.keyPath)) {\n      logger.warn(`Private key not found: ${config.keyPath}`);\n    }\n  }\n\n  if (errors.length > 0) {\n    const errorMessage = `QUIC configuration validation failed:\\n${errors.join('\\n')}`;\n    logger.error(errorMessage);\n    throw new Error(errorMessage);\n  }\n}\n\n/**\n * Get QUIC configuration for router integration\n */\nexport function getQuicRouterConfig(config: QuicConfigSchema) {\n  return {\n    transport: {\n      quic: {\n        enabled: config.enabled,\n        port: config.port,\n        host: config.host,\n        maxConnections: config.maxConnections,\n        certPath: config.certPath,\n        keyPath: config.keyPath\n      },\n      fallback: {\n        enabled: config.fallbackToHttp2,\n        protocol: 'http2'\n      }\n    }\n  };\n}\n\n/**\n * Check if QUIC is available and properly configured\n */\nexport async function checkQuicAvailability(): Promise<{\n  available: boolean;\n  reason?: string;\n}> {\n  try {\n    // Check if WASM module is available\n    // This will be implemented when WASM module is integrated\n    const wasmAvailable = true; // Placeholder\n\n    if (!wasmAvailable) {\n      return {\n        available: false,\n        reason: 'QUIC WASM module not available'\n      };\n    }\n\n    // Check if certificates exist (for server mode)\n    const config = loadQuicConfig();\n    if (config.enabled && config.verifyPeer) {\n      const fs = require('fs');\n      if (!fs.existsSync(config.certPath) || !fs.existsSync(config.keyPath)) {\n        return {\n          available: false,\n          reason: 'TLS certificates not found'\n        };\n      }\n    }\n\n    return { available: true };\n  } catch (error) {\n    logger.error('Error checking QUIC availability', { error });\n    return {\n      available: false,\n      reason: (error as Error).message\n    };\n  }\n}\n\n/**\n * Simplified config getter (alias for loadQuicConfig)\n */\nexport function getQuicConfig(overrides: Partial<QuicConfigSchema> = {}): QuicConfigSchema {\n  return loadQuicConfig(overrides);\n}\n"]}