{"version":3,"file":"reasoningbankCommands.js","sourceRoot":"","sources":["../../src/utils/reasoningbankCommands.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * ReasoningBank CLI Commands\n * Handles demo, test, init, benchmark, status, consolidate, list\n */\n\nimport { spawn } from 'child_process';\nimport { join } from 'path';\nimport { fileURLToPath } from 'url';\nimport { dirname } from 'path';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nexport async function handleReasoningBankCommand(subcommand: string): Promise<void> {\n  const args = process.argv.slice(4); // Get args after 'reasoningbank <subcommand>'\n\n  try {\n    switch (subcommand) {\n      case 'demo':\n        await runExternalScript('../reasoningbank/demo-comparison.js');\n        break;\n\n      case 'test':\n        await runExternalScript('../reasoningbank/test-validation.js');\n        break;\n\n      case 'init':\n        await initDatabase();\n        break;\n\n      case 'benchmark':\n        await runExternalScript('../reasoningbank/benchmark.js');\n        break;\n\n      case 'status':\n        await showStatus();\n        break;\n\n      case 'consolidate':\n        await runConsolidation();\n        break;\n\n      case 'list':\n        await listMemories(args);\n        break;\n\n      case 'help':\n      default:\n        printHelp();\n        break;\n    }\n  } catch (error) {\n    console.error(`\\n‚ùå Error: ${error instanceof Error ? error.message : String(error)}\\n`);\n    process.exit(1);\n  }\n}\n\nasync function runExternalScript(relativePath: string): Promise<void> {\n  const scriptPath = join(__dirname, relativePath);\n\n  return new Promise((resolve, reject) => {\n    const child = spawn('node', [scriptPath], {\n      stdio: 'inherit',\n      cwd: process.cwd()\n    });\n\n    child.on('exit', (code) => {\n      if (code === 0) {\n        resolve();\n      } else {\n        reject(new Error(`Script exited with code ${code}`));\n      }\n    });\n\n    child.on('error', (error) => {\n      reject(error);\n    });\n  });\n}\n\nasync function initDatabase() {\n  console.log('\\nüîß Initializing ReasoningBank Database');\n  console.log('‚ïê'.repeat(50));\n\n  const { initialize } = await import('../reasoningbank/index.js');\n\n  console.log('\\nInitializing database with migrations...\\n');\n\n  await initialize();\n\n  console.log('\\n‚úÖ Database initialized successfully!');\n  console.log('\\nSchema created:');\n  console.log('  ‚Ä¢ patterns (reasoning memories)');\n  console.log('  ‚Ä¢ pattern_embeddings');\n  console.log('  ‚Ä¢ pattern_links');\n  console.log('  ‚Ä¢ task_trajectories');\n  console.log('  ‚Ä¢ matts_runs');\n  console.log('  ‚Ä¢ consolidation_runs');\n  console.log('  ‚Ä¢ metrics_log\\n');\n}\n\nasync function showStatus() {\n  console.log('\\nüìä ReasoningBank Status');\n  console.log('‚ïê'.repeat(50));\n\n  const { db } = await import('../reasoningbank/index.js');\n  const dbInstance = db.getDb();\n\n  const stats = {\n    totalMemories: dbInstance.prepare(\"SELECT COUNT(*) as count FROM patterns WHERE type = 'reasoning_memory'\").get() as { count: number },\n    avgConfidence: dbInstance.prepare(\"SELECT AVG(confidence) as avg FROM patterns WHERE type = 'reasoning_memory'\").get() as { avg: number },\n    totalEmbeddings: dbInstance.prepare('SELECT COUNT(*) as count FROM pattern_embeddings').get() as { count: number },\n    totalTrajectories: dbInstance.prepare('SELECT COUNT(*) as count FROM task_trajectories').get() as { count: number }\n  };\n\n  console.log(`\\nüìà Statistics:`);\n  console.log(`  ‚Ä¢ Total memories: ${stats.totalMemories.count}`);\n  console.log(`  ‚Ä¢ Average confidence: ${stats.avgConfidence.avg?.toFixed(2) || 'N/A'}`);\n  console.log(`  ‚Ä¢ Total embeddings: ${stats.totalEmbeddings.count}`);\n  console.log(`  ‚Ä¢ Total trajectories: ${stats.totalTrajectories.count}\\n`);\n}\n\nasync function runConsolidation() {\n  console.log('\\nüîÑ Running Memory Consolidation');\n  console.log('‚ïê'.repeat(50));\n  console.log('\\nDeduplicating and pruning memories...\\n');\n\n  const { consolidate } = await import('../reasoningbank/index.js');\n\n  const startTime = Date.now();\n  const result = await consolidate();\n  const duration = Date.now() - startTime;\n\n  console.log('‚úÖ Consolidation complete!\\n');\n  console.log(`üìä Results:`);\n  console.log(`  ‚Ä¢ Memories processed: ${result.itemsProcessed}`);\n  console.log(`  ‚Ä¢ Duplicates found: ${result.duplicatesFound}`);\n  console.log(`  ‚Ä¢ Contradictions found: ${result.contradictionsFound}`);\n  console.log(`  ‚Ä¢ Pruned: ${result.itemsPruned}`);\n  console.log(`  ‚Ä¢ Duration: ${result.durationMs}ms\\n`);\n}\n\nasync function listMemories(args: string[]) {\n  const { db } = await import('../reasoningbank/index.js');\n  const dbInstance = db.getDb();\n\n  // Parse arguments\n  const sortBy = args.includes('--sort') ? args[args.indexOf('--sort') + 1] : 'created_at';\n  const limit = args.includes('--limit') ? parseInt(args[args.indexOf('--limit') + 1], 10) : 10;\n\n  console.log('\\nüìö Memory Bank Contents');\n  console.log('‚ïê'.repeat(50));\n  console.log(`\\nShowing top ${limit} memories (sorted by ${sortBy})\\n`);\n\n  let orderBy = 'created_at DESC';\n  if (sortBy === 'confidence') {\n    orderBy = 'confidence DESC';\n  } else if (sortBy === 'usage') {\n    orderBy = 'usage_count DESC';\n  }\n\n  const memories = dbInstance.prepare(`\n    SELECT\n      id,\n      json_extract(pattern_data, '$.title') as title,\n      json_extract(pattern_data, '$.description') as description,\n      json_extract(pattern_data, '$.domain') as domain,\n      confidence,\n      usage_count,\n      created_at\n    FROM patterns\n    WHERE type = 'reasoning_memory'\n    ORDER BY ${orderBy}\n    LIMIT ?\n  `).all(limit) as any[];\n\n  if (memories.length === 0) {\n    console.log('No memories found. Run `npx agentic-flow reasoningbank demo` to create some!\\n');\n    return;\n  }\n\n  for (let i = 0; i < memories.length; i++) {\n    const mem = memories[i];\n    console.log(`${i + 1}. ${mem.title}`);\n    console.log(`   Confidence: ${parseFloat(mem.confidence).toFixed(2)} | Usage: ${mem.usage_count} | Created: ${mem.created_at}`);\n    console.log(`   Domain: ${mem.domain}`);\n    console.log(`   ${mem.description}`);\n    console.log('');\n  }\n}\n\nfunction printHelp() {\n  console.log(`\nüß† ReasoningBank - Closed-loop memory system for AI agents\n\nUSAGE:\n  npx agentic-flow reasoningbank <COMMAND>\n\nCOMMANDS:\n  demo          Run interactive demo showing learning progression\n  test          Run validation test suite\n  init          Initialize database schema\n  benchmark     Run performance benchmarks\n  status        Show memory statistics\n  consolidate   Run memory consolidation now\n  list          List memories with options\n  help          Show this help message\n\nLIST OPTIONS:\n  --sort <field>    Sort by: confidence, usage, created_at (default)\n  --limit <n>       Show top N memories (default: 10)\n\nEXAMPLES:\n  # Run demo to see 0% ‚Üí 100% success transformation\n  npx agentic-flow reasoningbank demo\n\n  # Initialize database\n  npx agentic-flow reasoningbank init\n\n  # Run validation tests\n  npx agentic-flow reasoningbank test\n\n  # Show current statistics\n  npx agentic-flow reasoningbank status\n\n  # Consolidate memories (dedupe + prune)\n  npx agentic-flow reasoningbank consolidate\n\n  # List top 10 memories by confidence\n  npx agentic-flow reasoningbank list --sort confidence --limit 10\n\n  # List top 5 most used memories\n  npx agentic-flow reasoningbank list --sort usage --limit 5\n\nFor more information: https://github.com/ruvnet/agentic-flow\n  `);\n}\n"]}