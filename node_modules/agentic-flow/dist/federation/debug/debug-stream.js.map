{"version":3,"file":"debug-stream.js","sourceRoot":"","sources":["../../../src/federation/debug/debug-stream.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Debug Streaming System for Federation\n *\n * Provides detailed, real-time visibility into agent operations\n * with multiple verbosity levels and customizable output formats.\n *\n * Features:\n * - Multiple debug levels (SILENT, BASIC, DETAILED, VERBOSE, TRACE)\n * - Real-time event streaming\n * - Performance metrics and timing\n * - Stack traces and context\n * - Customizable formatters\n * - File and console output\n * - JSON and human-readable formats\n */\n\nimport { EventEmitter } from 'events';\nimport { WriteStream, createWriteStream } from 'fs';\n\nexport enum DebugLevel {\n  SILENT = 0,   // No output\n  BASIC = 1,    // Major events only (init, shutdown, errors)\n  DETAILED = 2, // Include operations (queries, inserts, updates)\n  VERBOSE = 3,  // Include all events (presence, messages, tasks)\n  TRACE = 4,    // Everything including internal state changes\n}\n\nexport interface DebugEvent {\n  timestamp: string;\n  level: DebugLevel;\n  category: string;\n  operation: string;\n  agentId?: string;\n  tenantId?: string;\n  duration?: number;\n  data?: any;\n  error?: Error;\n  stackTrace?: string;\n  metadata?: Record<string, any>;\n}\n\nexport interface DebugStreamConfig {\n  level: DebugLevel;\n  output: 'console' | 'file' | 'both' | 'stream';\n  format: 'human' | 'json' | 'compact';\n  outputFile?: string;\n  includeTimestamps?: boolean;\n  includeStackTraces?: boolean;\n  includeMetadata?: boolean;\n  colorize?: boolean;\n  filterCategories?: string[];\n  filterAgents?: string[];\n  customStream?: WriteStream;\n}\n\nexport class DebugStream extends EventEmitter {\n  private config: DebugStreamConfig;\n  private fileStream?: WriteStream;\n  private eventBuffer: DebugEvent[] = [];\n  private metrics: Map<string, { count: number; totalDuration: number }> = new Map();\n\n  constructor(config: Partial<DebugStreamConfig> = {}) {\n    super();\n\n    this.config = {\n      level: config.level ?? DebugLevel.BASIC,\n      output: config.output ?? 'console',\n      format: config.format ?? 'human',\n      includeTimestamps: config.includeTimestamps ?? true,\n      includeStackTraces: config.includeStackTraces ?? false,\n      includeMetadata: config.includeMetadata ?? true,\n      colorize: config.colorize ?? true,\n      filterCategories: config.filterCategories,\n      filterAgents: config.filterAgents,\n      outputFile: config.outputFile,\n      customStream: config.customStream,\n    };\n\n    if (this.config.outputFile && (this.config.output === 'file' || this.config.output === 'both')) {\n      this.fileStream = createWriteStream(this.config.outputFile, { flags: 'a' });\n    }\n  }\n\n  /**\n   * Log a debug event\n   */\n  log(event: Omit<DebugEvent, 'timestamp'>): void {\n    // Check if event should be logged based on level\n    if (event.level > this.config.level) {\n      return;\n    }\n\n    // Apply filters\n    if (this.config.filterCategories && !this.config.filterCategories.includes(event.category)) {\n      return;\n    }\n\n    if (this.config.filterAgents && event.agentId && !this.config.filterAgents.includes(event.agentId)) {\n      return;\n    }\n\n    const fullEvent: DebugEvent = {\n      ...event,\n      timestamp: new Date().toISOString(),\n      stackTrace: this.config.includeStackTraces ? this.captureStackTrace() : undefined,\n    };\n\n    // Buffer event\n    this.eventBuffer.push(fullEvent);\n\n    // Update metrics\n    if (event.duration !== undefined) {\n      const key = `${event.category}:${event.operation}`;\n      const existing = this.metrics.get(key) || { count: 0, totalDuration: 0 };\n      this.metrics.set(key, {\n        count: existing.count + 1,\n        totalDuration: existing.totalDuration + event.duration,\n      });\n    }\n\n    // Output event\n    this.outputEvent(fullEvent);\n\n    // Emit for external listeners\n    this.emit('event', fullEvent);\n  }\n\n  /**\n   * Log connection events\n   */\n  logConnection(operation: string, data?: any, error?: Error): void {\n    this.log({\n      level: DebugLevel.BASIC,\n      category: 'connection',\n      operation,\n      data,\n      error,\n    });\n  }\n\n  /**\n   * Log database operations\n   */\n  logDatabase(operation: string, data?: any, duration?: number, error?: Error): void {\n    this.log({\n      level: DebugLevel.DETAILED,\n      category: 'database',\n      operation,\n      data,\n      duration,\n      error,\n    });\n  }\n\n  /**\n   * Log realtime events\n   */\n  logRealtime(operation: string, agentId?: string, data?: any, duration?: number): void {\n    this.log({\n      level: DebugLevel.VERBOSE,\n      category: 'realtime',\n      operation,\n      agentId,\n      data,\n      duration,\n    });\n  }\n\n  /**\n   * Log memory operations\n   */\n  logMemory(operation: string, agentId?: string, tenantId?: string, data?: any, duration?: number): void {\n    this.log({\n      level: DebugLevel.DETAILED,\n      category: 'memory',\n      operation,\n      agentId,\n      tenantId,\n      data,\n      duration,\n    });\n  }\n\n  /**\n   * Log task operations\n   */\n  logTask(operation: string, agentId?: string, tenantId?: string, data?: any, duration?: number): void {\n    this.log({\n      level: DebugLevel.VERBOSE,\n      category: 'task',\n      operation,\n      agentId,\n      tenantId,\n      data,\n      duration,\n    });\n  }\n\n  /**\n   * Log internal state changes\n   */\n  logTrace(operation: string, data?: any): void {\n    this.log({\n      level: DebugLevel.TRACE,\n      category: 'trace',\n      operation,\n      data,\n    });\n  }\n\n  /**\n   * Output event to configured destinations\n   */\n  private outputEvent(event: DebugEvent): void {\n    const formatted = this.formatEvent(event);\n\n    if (this.config.output === 'console' || this.config.output === 'both') {\n      console.log(formatted);\n    }\n\n    if (this.config.output === 'file' || this.config.output === 'both') {\n      if (this.fileStream) {\n        this.fileStream.write(formatted + '\\n');\n      }\n    }\n\n    if (this.config.output === 'stream' && this.config.customStream) {\n      this.config.customStream.write(formatted + '\\n');\n    }\n  }\n\n  /**\n   * Format event for output\n   */\n  private formatEvent(event: DebugEvent): string {\n    if (this.config.format === 'json') {\n      return JSON.stringify(event);\n    }\n\n    if (this.config.format === 'compact') {\n      return this.formatCompact(event);\n    }\n\n    return this.formatHuman(event);\n  }\n\n  /**\n   * Format event in human-readable format\n   */\n  private formatHuman(event: DebugEvent): string {\n    const parts: string[] = [];\n\n    // Timestamp\n    if (this.config.includeTimestamps) {\n      const timestamp = this.colorize(event.timestamp, 'gray');\n      parts.push(`[${timestamp}]`);\n    }\n\n    // Level\n    const levelStr = this.getLevelString(event.level);\n    parts.push(this.colorize(levelStr, this.getLevelColor(event.level)));\n\n    // Category\n    parts.push(this.colorize(event.category.toUpperCase(), 'cyan'));\n\n    // Agent/Tenant\n    if (event.agentId) {\n      parts.push(this.colorize(`agent=${event.agentId}`, 'blue'));\n    }\n    if (event.tenantId) {\n      parts.push(this.colorize(`tenant=${event.tenantId}`, 'blue'));\n    }\n\n    // Operation\n    parts.push(this.colorize(event.operation, 'white'));\n\n    // Duration\n    if (event.duration !== undefined) {\n      const durationStr = `${event.duration.toFixed(2)}ms`;\n      parts.push(this.colorize(durationStr, 'yellow'));\n    }\n\n    let output = parts.join(' ');\n\n    // Data\n    if (event.data && this.config.includeMetadata) {\n      const dataStr = typeof event.data === 'string'\n        ? event.data\n        : JSON.stringify(event.data, null, 2);\n      output += '\\n  ' + this.colorize('Data:', 'gray') + ' ' + dataStr;\n    }\n\n    // Metadata\n    if (event.metadata && this.config.includeMetadata) {\n      output += '\\n  ' + this.colorize('Metadata:', 'gray') + ' ' + JSON.stringify(event.metadata);\n    }\n\n    // Error\n    if (event.error) {\n      output += '\\n  ' + this.colorize('Error:', 'red') + ' ' + event.error.message;\n      if (event.error.stack) {\n        output += '\\n  ' + this.colorize('Stack:', 'red') + '\\n' + event.error.stack\n          .split('\\n')\n          .map(line => '    ' + line)\n          .join('\\n');\n      }\n    }\n\n    // Stack trace\n    if (event.stackTrace && this.config.includeStackTraces) {\n      output += '\\n  ' + this.colorize('Trace:', 'gray') + '\\n' + event.stackTrace\n        .split('\\n')\n        .slice(0, 5)\n        .map(line => '    ' + line)\n        .join('\\n');\n    }\n\n    return output;\n  }\n\n  /**\n   * Format event in compact format\n   */\n  private formatCompact(event: DebugEvent): string {\n    const parts: string[] = [];\n\n    if (this.config.includeTimestamps) {\n      parts.push(event.timestamp);\n    }\n\n    parts.push(this.getLevelString(event.level));\n    parts.push(event.category);\n\n    if (event.agentId) parts.push(`a=${event.agentId}`);\n    if (event.tenantId) parts.push(`t=${event.tenantId}`);\n\n    parts.push(event.operation);\n\n    if (event.duration !== undefined) {\n      parts.push(`${event.duration.toFixed(0)}ms`);\n    }\n\n    if (event.error) {\n      parts.push(`ERROR: ${event.error.message}`);\n    }\n\n    return parts.join(' | ');\n  }\n\n  /**\n   * Get level string\n   */\n  private getLevelString(level: DebugLevel): string {\n    switch (level) {\n      case DebugLevel.SILENT: return 'SILENT';\n      case DebugLevel.BASIC: return 'BASIC ';\n      case DebugLevel.DETAILED: return 'DETAIL';\n      case DebugLevel.VERBOSE: return 'VERBOS';\n      case DebugLevel.TRACE: return 'TRACE ';\n      default: return 'UNKNOWN';\n    }\n  }\n\n  /**\n   * Get color for level\n   */\n  private getLevelColor(level: DebugLevel): string {\n    switch (level) {\n      case DebugLevel.BASIC: return 'green';\n      case DebugLevel.DETAILED: return 'blue';\n      case DebugLevel.VERBOSE: return 'magenta';\n      case DebugLevel.TRACE: return 'gray';\n      default: return 'white';\n    }\n  }\n\n  /**\n   * Colorize text\n   */\n  private colorize(text: string, color: string): string {\n    if (!this.config.colorize) return text;\n\n    const colors: Record<string, string> = {\n      gray: '\\x1b[90m',\n      red: '\\x1b[31m',\n      green: '\\x1b[32m',\n      yellow: '\\x1b[33m',\n      blue: '\\x1b[34m',\n      magenta: '\\x1b[35m',\n      cyan: '\\x1b[36m',\n      white: '\\x1b[37m',\n    };\n\n    const reset = '\\x1b[0m';\n    return (colors[color] || '') + text + reset;\n  }\n\n  /**\n   * Capture stack trace\n   */\n  private captureStackTrace(): string {\n    const stack = new Error().stack || '';\n    return stack\n      .split('\\n')\n      .slice(3) // Skip DebugStream internal frames\n      .join('\\n');\n  }\n\n  /**\n   * Get metrics summary\n   */\n  getMetrics(): Record<string, { count: number; avgDuration: number }> {\n    const summary: Record<string, { count: number; avgDuration: number }> = {};\n\n    for (const [key, value] of this.metrics.entries()) {\n      summary[key] = {\n        count: value.count,\n        avgDuration: value.totalDuration / value.count,\n      };\n    }\n\n    return summary;\n  }\n\n  /**\n   * Print metrics summary\n   */\n  printMetrics(): void {\n    console.log('\\n' + this.colorize('='.repeat(60), 'cyan'));\n    console.log(this.colorize('Performance Metrics Summary', 'cyan'));\n    console.log(this.colorize('='.repeat(60), 'cyan') + '\\n');\n\n    const metrics = this.getMetrics();\n    const sorted = Object.entries(metrics).sort((a, b) => b[1].count - a[1].count);\n\n    console.log(this.colorize('Operation'.padEnd(40) + 'Count'.padEnd(10) + 'Avg Duration', 'white'));\n    console.log(this.colorize('-'.repeat(60), 'gray'));\n\n    for (const [key, value] of sorted) {\n      const countStr = value.count.toString().padEnd(10);\n      const durationStr = value.avgDuration.toFixed(2) + 'ms';\n      console.log(\n        key.padEnd(40) +\n        this.colorize(countStr, 'yellow') +\n        this.colorize(durationStr, 'green')\n      );\n    }\n\n    console.log('\\n' + this.colorize('='.repeat(60), 'cyan') + '\\n');\n  }\n\n  /**\n   * Get event buffer\n   */\n  getEvents(filter?: { category?: string; agentId?: string; since?: Date }): DebugEvent[] {\n    let events = [...this.eventBuffer];\n\n    if (filter?.category) {\n      events = events.filter(e => e.category === filter.category);\n    }\n\n    if (filter?.agentId) {\n      events = events.filter(e => e.agentId === filter.agentId);\n    }\n\n    if (filter?.since) {\n      events = events.filter(e => new Date(e.timestamp) >= filter.since!);\n    }\n\n    return events;\n  }\n\n  /**\n   * Clear event buffer\n   */\n  clearEvents(): void {\n    this.eventBuffer = [];\n  }\n\n  /**\n   * Clear metrics\n   */\n  clearMetrics(): void {\n    this.metrics.clear();\n  }\n\n  /**\n   * Close file stream\n   */\n  close(): void {\n    if (this.fileStream) {\n      this.fileStream.end();\n    }\n  }\n}\n\n/**\n * Create debug stream with sensible defaults\n */\nexport function createDebugStream(config?: Partial<DebugStreamConfig>): DebugStream {\n  return new DebugStream(config);\n}\n\n/**\n * Get debug level from environment variable\n */\nexport function getDebugLevelFromEnv(): DebugLevel {\n  const level = process.env.DEBUG_LEVEL?.toUpperCase();\n\n  switch (level) {\n    case 'SILENT': return DebugLevel.SILENT;\n    case 'BASIC': return DebugLevel.BASIC;\n    case 'DETAILED': return DebugLevel.DETAILED;\n    case 'VERBOSE': return DebugLevel.VERBOSE;\n    case 'TRACE': return DebugLevel.TRACE;\n    default: return DebugLevel.BASIC;\n  }\n}\n"]}