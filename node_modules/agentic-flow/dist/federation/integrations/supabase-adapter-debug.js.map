{"version":3,"file":"supabase-adapter-debug.js","sourceRoot":"","sources":["../../../src/federation/integrations/supabase-adapter-debug.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Supabase Database Adapter with Debug Streaming\n *\n * Enhanced version of SupabaseFederationAdapter with comprehensive\n * debug logging and performance tracking.\n */\n\nimport { createClient, SupabaseClient } from '@supabase/supabase-js';\nimport { DebugStream, DebugLevel, createDebugStream } from '../debug/debug-stream.js';\n\nexport interface SupabaseConfigDebug {\n  url: string;\n  anonKey: string;\n  serviceRoleKey?: string;\n  vectorBackend?: 'pgvector' | 'agentdb' | 'hybrid';\n  syncInterval?: number;\n  debug?: {\n    enabled?: boolean;\n    level?: DebugLevel;\n    output?: 'console' | 'file' | 'both';\n    format?: 'human' | 'json' | 'compact';\n    outputFile?: string;\n  };\n}\n\nexport interface AgentMemory {\n  id: string;\n  tenant_id: string;\n  agent_id: string;\n  session_id: string;\n  content: string;\n  embedding?: number[];\n  metadata?: Record<string, any>;\n  created_at?: string;\n  expires_at?: string;\n}\n\nexport class SupabaseFederationAdapterDebug {\n  private client: SupabaseClient;\n  private config: SupabaseConfigDebug;\n  private debug: DebugStream;\n\n  constructor(config: SupabaseConfigDebug) {\n    this.config = config;\n\n    // Initialize debug stream\n    this.debug = createDebugStream({\n      level: config.debug?.level ?? DebugLevel.BASIC,\n      output: config.debug?.output ?? 'console',\n      format: config.debug?.format ?? 'human',\n      outputFile: config.debug?.outputFile,\n    });\n\n    const startTime = Date.now();\n\n    // Use service role key for server-side operations\n    const key = config.serviceRoleKey || config.anonKey;\n    this.client = createClient(config.url, key);\n\n    this.debug.logConnection('client_created', {\n      url: config.url,\n      hasServiceRole: !!config.serviceRoleKey,\n      vectorBackend: config.vectorBackend,\n    });\n\n    const duration = Date.now() - startTime;\n    this.debug.logTrace('constructor_complete', { duration });\n  }\n\n  /**\n   * Initialize Supabase schema for federation\n   */\n  async initialize(): Promise<void> {\n    const startTime = Date.now();\n    this.debug.logConnection('initialize_start', {\n      vectorBackend: this.config.vectorBackend,\n    });\n\n    try {\n      // Check if tables exist\n      await this.ensureTables();\n\n      if (this.config.vectorBackend === 'pgvector') {\n        await this.ensureVectorExtension();\n      }\n\n      const duration = Date.now() - startTime;\n      this.debug.logConnection('initialize_complete', { duration }, duration);\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.debug.logConnection('initialize_error', { duration }, duration, error as Error);\n      throw error;\n    }\n  }\n\n  /**\n   * Ensure required tables exist\n   */\n  private async ensureTables(): Promise<void> {\n    const startTime = Date.now();\n    this.debug.logTrace('checking_tables');\n\n    const tables = ['agent_sessions', 'agent_memories', 'agent_tasks', 'agent_events'];\n    const results: Record<string, boolean> = {};\n\n    for (const table of tables) {\n      const tableStart = Date.now();\n\n      try {\n        const { data, error } = await this.client\n          .from(table)\n          .select('id')\n          .limit(1);\n\n        const exists = !error || error.code !== 'PGRST116';\n        results[table] = exists;\n\n        const tableDuration = Date.now() - tableStart;\n        this.debug.logDatabase('table_check', {\n          table,\n          exists,\n        }, tableDuration);\n\n        if (!exists) {\n          this.debug.logDatabase('table_missing', { table });\n        }\n      } catch (error) {\n        const tableDuration = Date.now() - tableStart;\n        this.debug.logDatabase('table_check_error', { table }, tableDuration, error as Error);\n      }\n    }\n\n    const duration = Date.now() - startTime;\n    this.debug.logDatabase('tables_checked', { results }, duration);\n  }\n\n  /**\n   * Ensure pgvector extension is enabled\n   */\n  private async ensureVectorExtension(): Promise<void> {\n    const startTime = Date.now();\n    this.debug.logTrace('checking_pgvector');\n\n    try {\n      const { error } = await this.client.rpc('exec_sql', {\n        sql: 'CREATE EXTENSION IF NOT EXISTS vector;'\n      });\n\n      const duration = Date.now() - startTime;\n\n      if (error) {\n        this.debug.logDatabase('pgvector_check_failed', {\n          message: error.message,\n        }, duration, error as any);\n      } else {\n        this.debug.logDatabase('pgvector_ready', {}, duration);\n      }\n    } catch (err) {\n      const duration = Date.now() - startTime;\n      this.debug.logDatabase('pgvector_error', {}, duration, err as Error);\n    }\n  }\n\n  /**\n   * Store agent memory in Supabase\n   */\n  async storeMemory(memory: AgentMemory): Promise<void> {\n    const startTime = Date.now();\n\n    this.debug.logMemory('store_start', memory.agent_id, memory.tenant_id, {\n      id: memory.id,\n      content_length: memory.content.length,\n      has_embedding: !!memory.embedding,\n      embedding_dims: memory.embedding?.length,\n    });\n\n    try {\n      const { error } = await this.client\n        .from('agent_memories')\n        .insert({\n          id: memory.id,\n          tenant_id: memory.tenant_id,\n          agent_id: memory.agent_id,\n          session_id: memory.session_id,\n          content: memory.content,\n          embedding: memory.embedding,\n          metadata: memory.metadata,\n          created_at: memory.created_at || new Date().toISOString(),\n          expires_at: memory.expires_at,\n        });\n\n      const duration = Date.now() - startTime;\n\n      if (error) {\n        this.debug.logMemory('store_error', memory.agent_id, memory.tenant_id, {\n          error: error.message,\n        }, duration);\n        throw new Error(`Failed to store memory: ${error.message}`);\n      }\n\n      this.debug.logMemory('store_complete', memory.agent_id, memory.tenant_id, {\n        id: memory.id,\n      }, duration);\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.debug.logMemory('store_failed', memory.agent_id, memory.tenant_id, {}, duration);\n      throw error;\n    }\n  }\n\n  /**\n   * Query memories by tenant and agent\n   */\n  async queryMemories(\n    tenantId: string,\n    agentId?: string,\n    limit: number = 100\n  ): Promise<AgentMemory[]> {\n    const startTime = Date.now();\n\n    this.debug.logMemory('query_start', agentId, tenantId, {\n      limit,\n      hasAgentFilter: !!agentId,\n    });\n\n    try {\n      let query = this.client\n        .from('agent_memories')\n        .select('*')\n        .eq('tenant_id', tenantId)\n        .order('created_at', { ascending: false })\n        .limit(limit);\n\n      if (agentId) {\n        query = query.eq('agent_id', agentId);\n      }\n\n      const { data, error } = await query;\n\n      const duration = Date.now() - startTime;\n\n      if (error) {\n        this.debug.logMemory('query_error', agentId, tenantId, {\n          error: error.message,\n        }, duration);\n        throw new Error(`Failed to query memories: ${error.message}`);\n      }\n\n      this.debug.logMemory('query_complete', agentId, tenantId, {\n        count: data?.length || 0,\n      }, duration);\n\n      return data as AgentMemory[];\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.debug.logMemory('query_failed', agentId, tenantId, {}, duration);\n      throw error;\n    }\n  }\n\n  /**\n   * Semantic search using pgvector\n   */\n  async semanticSearch(\n    embedding: number[],\n    tenantId: string,\n    limit: number = 10\n  ): Promise<AgentMemory[]> {\n    const startTime = Date.now();\n\n    this.debug.logMemory('semantic_search_start', undefined, tenantId, {\n      embedding_dims: embedding.length,\n      limit,\n    });\n\n    if (this.config.vectorBackend !== 'pgvector') {\n      this.debug.logMemory('semantic_search_disabled', undefined, tenantId, {\n        backend: this.config.vectorBackend,\n      });\n      throw new Error('pgvector backend not enabled');\n    }\n\n    try {\n      const { data, error} = await this.client.rpc('search_memories', {\n        query_embedding: embedding,\n        query_tenant_id: tenantId,\n        match_count: limit,\n      });\n\n      const duration = Date.now() - startTime;\n\n      if (error) {\n        this.debug.logMemory('semantic_search_error', undefined, tenantId, {\n          error: error.message,\n        }, duration);\n        throw new Error(`Semantic search failed: ${error.message}`);\n      }\n\n      this.debug.logMemory('semantic_search_complete', undefined, tenantId, {\n        results: data?.length || 0,\n      }, duration);\n\n      return data as AgentMemory[];\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.debug.logMemory('semantic_search_failed', undefined, tenantId, {}, duration);\n      throw error;\n    }\n  }\n\n  /**\n   * Register agent session\n   */\n  async registerSession(\n    sessionId: string,\n    tenantId: string,\n    agentId: string,\n    metadata?: Record<string, any>\n  ): Promise<void> {\n    const startTime = Date.now();\n\n    this.debug.logDatabase('register_session_start', {\n      sessionId,\n      tenantId,\n      agentId,\n    });\n\n    try {\n      const { error } = await this.client\n        .from('agent_sessions')\n        .insert({\n          session_id: sessionId,\n          tenant_id: tenantId,\n          agent_id: agentId,\n          metadata,\n          started_at: new Date().toISOString(),\n          status: 'active',\n        });\n\n      const duration = Date.now() - startTime;\n\n      if (error) {\n        this.debug.logDatabase('register_session_error', {\n          sessionId,\n          error: error.message,\n        }, duration, error as any);\n        throw new Error(`Failed to register session: ${error.message}`);\n      }\n\n      this.debug.logDatabase('register_session_complete', {\n        sessionId,\n      }, duration);\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.debug.logDatabase('register_session_failed', { sessionId }, duration);\n      throw error;\n    }\n  }\n\n  /**\n   * Update session status\n   */\n  async updateSessionStatus(\n    sessionId: string,\n    status: 'active' | 'completed' | 'failed'\n  ): Promise<void> {\n    const startTime = Date.now();\n\n    this.debug.logDatabase('update_session_start', {\n      sessionId,\n      status,\n    });\n\n    try {\n      const updates: any = { status };\n\n      if (status !== 'active') {\n        updates.ended_at = new Date().toISOString();\n      }\n\n      const { error } = await this.client\n        .from('agent_sessions')\n        .update(updates)\n        .eq('session_id', sessionId);\n\n      const duration = Date.now() - startTime;\n\n      if (error) {\n        this.debug.logDatabase('update_session_error', {\n          sessionId,\n          error: error.message,\n        }, duration, error as any);\n        throw new Error(`Failed to update session: ${error.message}`);\n      }\n\n      this.debug.logDatabase('update_session_complete', {\n        sessionId,\n        status,\n      }, duration);\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.debug.logDatabase('update_session_failed', { sessionId }, duration);\n      throw error;\n    }\n  }\n\n  /**\n   * Get hub statistics\n   */\n  async getStats(tenantId?: string): Promise<any> {\n    const startTime = Date.now();\n\n    this.debug.logDatabase('get_stats_start', { tenantId });\n\n    try {\n      // Total memories\n      let memoriesQuery = this.client\n        .from('agent_memories')\n        .select('id', { count: 'exact', head: true });\n\n      if (tenantId) {\n        memoriesQuery = memoriesQuery.eq('tenant_id', tenantId);\n      }\n\n      const { count: totalMemories } = await memoriesQuery;\n\n      // Active sessions\n      let sessionsQuery = this.client\n        .from('agent_sessions')\n        .select('session_id', { count: 'exact', head: true })\n        .eq('status', 'active');\n\n      if (tenantId) {\n        sessionsQuery = sessionsQuery.eq('tenant_id', tenantId);\n      }\n\n      const { count: activeSessions } = await sessionsQuery;\n\n      const duration = Date.now() - startTime;\n\n      const stats = {\n        total_memories: totalMemories || 0,\n        active_sessions: activeSessions || 0,\n        backend: 'supabase',\n        vector_backend: this.config.vectorBackend,\n        timestamp: new Date().toISOString(),\n      };\n\n      this.debug.logDatabase('get_stats_complete', stats, duration);\n\n      return stats;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.debug.logDatabase('get_stats_error', {}, duration, error as Error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get debug stream for external use\n   */\n  getDebugStream(): DebugStream {\n    return this.debug;\n  }\n\n  /**\n   * Print performance metrics\n   */\n  printMetrics(): void {\n    this.debug.printMetrics();\n  }\n\n  /**\n   * Close connection\n   */\n  async close(): Promise<void> {\n    const startTime = Date.now();\n    this.debug.logConnection('close_start');\n\n    this.debug.close();\n\n    const duration = Date.now() - startTime;\n    this.debug.logConnection('close_complete', {}, duration);\n  }\n}\n\n/**\n * Create Supabase adapter from environment variables with debug support\n */\nexport function createSupabaseAdapterDebug(): SupabaseFederationAdapterDebug {\n  const url = process.env.SUPABASE_URL;\n  const anonKey = process.env.SUPABASE_ANON_KEY;\n  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n  if (!url || !anonKey) {\n    throw new Error(\n      'Missing Supabase credentials. Set SUPABASE_URL and SUPABASE_ANON_KEY'\n    );\n  }\n\n  const debugLevel = process.env.DEBUG_LEVEL?.toUpperCase() as keyof typeof DebugLevel || 'BASIC';\n\n  return new SupabaseFederationAdapterDebug({\n    url,\n    anonKey,\n    serviceRoleKey,\n    vectorBackend: (process.env.FEDERATION_VECTOR_BACKEND as any) || 'hybrid',\n    syncInterval: parseInt(process.env.FEDERATION_SYNC_INTERVAL || '60000'),\n    debug: {\n      enabled: process.env.DEBUG_ENABLED !== 'false',\n      level: DebugLevel[debugLevel] || DebugLevel.BASIC,\n      output: (process.env.DEBUG_OUTPUT as any) || 'console',\n      format: (process.env.DEBUG_FORMAT as any) || 'human',\n      outputFile: process.env.DEBUG_OUTPUT_FILE,\n    },\n  });\n}\n"]}