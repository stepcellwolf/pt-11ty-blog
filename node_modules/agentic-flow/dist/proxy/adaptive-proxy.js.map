{"version":3,"file":"adaptive-proxy.js","sourceRoot":"","sources":["../../src/proxy/adaptive-proxy.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Adaptive Multi-Protocol Proxy\n *\n * Automatically selects optimal protocol based on:\n * - Client capabilities\n * - Network conditions\n * - Configuration priorities\n *\n * Fallback chain: HTTP/3 â†’ HTTP/2 â†’ HTTP/1.1 â†’ WebSocket\n */\n\nimport { HTTP2Proxy } from './http2-proxy.js';\nimport { HTTP3Proxy } from './http3-proxy.js';\nimport { WebSocketProxy } from './websocket-proxy.js';\nimport { AnthropicToGeminiProxy } from './anthropic-to-gemini.js';\nimport { logger } from '../utils/logger.js';\n\nexport interface AdaptiveProxyConfig {\n  enableHTTP2?: boolean;\n  enableHTTP3?: boolean;\n  enableWebSocket?: boolean;\n  enableHTTP1?: boolean; // Always enabled as fallback\n\n  http1Port?: number;\n  http2Port?: number;\n  http3Port?: number;\n  wsPort?: number;\n\n  cert?: string;\n  key?: string;\n\n  geminiApiKey?: string;\n  geminiBaseUrl?: string;\n}\n\ninterface ProxyServer {\n  protocol: string;\n  port: number;\n  url: string;\n  proxy: any;\n}\n\nexport class AdaptiveProxy {\n  private config: AdaptiveProxyConfig;\n  private servers: ProxyServer[] = [];\n  private isRunning: boolean = false;\n\n  constructor(config: AdaptiveProxyConfig) {\n    this.config = {\n      enableHTTP1: true, // Always enabled\n      enableHTTP2: config.enableHTTP2 ?? true,\n      enableHTTP3: config.enableHTTP3 ?? false, // Disabled by default (requires QUIC)\n      enableWebSocket: config.enableWebSocket ?? true,\n\n      http1Port: config.http1Port || 3000,\n      http2Port: config.http2Port || 3001,\n      http3Port: config.http3Port || 4433,\n      wsPort: config.wsPort || 8080,\n\n      ...config\n    };\n\n    logger.info('Adaptive proxy created', {\n      protocols: this.getEnabledProtocols()\n    });\n  }\n\n  private getEnabledProtocols(): string[] {\n    const protocols = [];\n    if (this.config.enableHTTP3) protocols.push('HTTP/3');\n    if (this.config.enableHTTP2) protocols.push('HTTP/2');\n    if (this.config.enableHTTP1) protocols.push('HTTP/1.1');\n    if (this.config.enableWebSocket) protocols.push('WebSocket');\n    return protocols;\n  }\n\n  async start(): Promise<ProxyServer[]> {\n    console.log('\\nðŸš€ Starting Adaptive Multi-Protocol Proxy...\\n');\n\n    // Try HTTP/3 first (fastest)\n    if (this.config.enableHTTP3) {\n      try {\n        const http3 = new HTTP3Proxy({\n          port: this.config.http3Port!,\n          cert: this.config.cert,\n          key: this.config.key,\n          geminiApiKey: this.config.geminiApiKey,\n          geminiBaseUrl: this.config.geminiBaseUrl\n        });\n\n        await http3.start();\n\n        this.servers.push({\n          protocol: 'HTTP/3',\n          port: this.config.http3Port!,\n          url: `https://localhost:${this.config.http3Port}`,\n          proxy: http3\n        });\n\n        console.log(`âœ… HTTP/3 (QUIC)   â†’ Port ${this.config.http3Port} (fastest, 50-70% improvement)`);\n\n      } catch (error) {\n        logger.warn('HTTP/3 unavailable, skipping', { error: (error as Error).message });\n        console.log(`âš ï¸  HTTP/3 (QUIC)   â†’ Unavailable (${(error as Error).message})`);\n      }\n    }\n\n    // Try HTTP/2 next\n    if (this.config.enableHTTP2) {\n      try {\n        const http2 = new HTTP2Proxy({\n          port: this.config.http2Port!,\n          cert: this.config.cert,\n          key: this.config.key,\n          geminiApiKey: this.config.geminiApiKey,\n          geminiBaseUrl: this.config.geminiBaseUrl\n        });\n\n        await http2.start();\n\n        this.servers.push({\n          protocol: 'HTTP/2',\n          port: this.config.http2Port!,\n          url: `https://localhost:${this.config.http2Port}`,\n          proxy: http2\n        });\n\n        console.log(`âœ… HTTP/2          â†’ Port ${this.config.http2Port} (30-50% improvement)`);\n\n      } catch (error) {\n        logger.warn('HTTP/2 unavailable, skipping', { error: (error as Error).message });\n        console.log(`âš ï¸  HTTP/2          â†’ Unavailable (${(error as Error).message})`);\n      }\n    }\n\n    // HTTP/1.1 (always available)\n    if (this.config.enableHTTP1) {\n      try {\n        const http1 = new AnthropicToGeminiProxy({\n          geminiApiKey: this.config.geminiApiKey!,\n          geminiBaseUrl: this.config.geminiBaseUrl,\n          defaultModel: 'gemini-2.0-flash-exp'\n        });\n\n        http1.start(this.config.http1Port!);\n\n        this.servers.push({\n          protocol: 'HTTP/1.1',\n          port: this.config.http1Port!,\n          url: `http://localhost:${this.config.http1Port}`,\n          proxy: http1\n        });\n\n        console.log(`âœ… HTTP/1.1        â†’ Port ${this.config.http1Port} (baseline, always available)`);\n\n      } catch (error) {\n        logger.error('HTTP/1.1 failed to start', { error: (error as Error).message });\n        throw error; // HTTP/1.1 failure is fatal\n      }\n    }\n\n    // WebSocket fallback for unreliable connections\n    if (this.config.enableWebSocket) {\n      try {\n        const ws = new WebSocketProxy({\n          port: this.config.wsPort!,\n          geminiApiKey: this.config.geminiApiKey,\n          geminiBaseUrl: this.config.geminiBaseUrl\n        });\n\n        await ws.start();\n\n        this.servers.push({\n          protocol: 'WebSocket',\n          port: this.config.wsPort!,\n          url: `ws://localhost:${this.config.wsPort}`,\n          proxy: ws\n        });\n\n        console.log(`âœ… WebSocket       â†’ Port ${this.config.wsPort} (mobile/unstable connections)`);\n\n      } catch (error) {\n        logger.warn('WebSocket unavailable, skipping', { error: (error as Error).message });\n        console.log(`âš ï¸  WebSocket       â†’ Unavailable (${(error as Error).message})`);\n      }\n    }\n\n    this.isRunning = true;\n\n    console.log(`\\nðŸ“Š Active Protocols: ${this.servers.length}/${this.getEnabledProtocols().length}`);\n    console.log(`\\nðŸ’¡ Usage:`);\n    this.servers.forEach(s => {\n      console.log(`   ${s.protocol.padEnd(12)} â†’ curl ${s.url}/health`);\n    });\n    console.log('');\n\n    logger.info('Adaptive proxy started', {\n      activeServers: this.servers.length,\n      protocols: this.servers.map(s => s.protocol)\n    });\n\n    return this.servers;\n  }\n\n  async stop(): Promise<void> {\n    if (!this.isRunning) return;\n\n    console.log('\\nðŸ›‘ Stopping all proxy servers...\\n');\n\n    for (const server of this.servers) {\n      try {\n        if (server.proxy.stop) {\n          await server.proxy.stop();\n        }\n        console.log(`âœ… Stopped ${server.protocol}`);\n      } catch (error) {\n        logger.error(`Failed to stop ${server.protocol}`, { error: (error as Error).message });\n      }\n    }\n\n    this.servers = [];\n    this.isRunning = false;\n\n    logger.info('Adaptive proxy stopped');\n    console.log('\\nâœ… All proxy servers stopped\\n');\n  }\n\n  getServers(): ProxyServer[] {\n    return [...this.servers];\n  }\n\n  getStatus(): {\n    isRunning: boolean;\n    servers: Array<{ protocol: string; port: number; url: string }>;\n    enabledProtocols: string[];\n  } {\n    return {\n      isRunning: this.isRunning,\n      servers: this.servers.map(s => ({\n        protocol: s.protocol,\n        port: s.port,\n        url: s.url\n      })),\n      enabledProtocols: this.getEnabledProtocols()\n    };\n  }\n}\n\n// CLI entry point\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const geminiApiKey = process.env.GOOGLE_GEMINI_API_KEY;\n\n  if (!geminiApiKey) {\n    console.error('âŒ Error: GOOGLE_GEMINI_API_KEY environment variable required');\n    process.exit(1);\n  }\n\n  const proxy = new AdaptiveProxy({\n    enableHTTP1: true,\n    enableHTTP2: true,\n    enableHTTP3: false, // Requires QUIC setup\n    enableWebSocket: true,\n\n    http1Port: 3000,\n    http2Port: 3001,\n    http3Port: 4433,\n    wsPort: 8080,\n\n    cert: process.env.TLS_CERT,\n    key: process.env.TLS_KEY,\n\n    geminiApiKey,\n    geminiBaseUrl: process.env.GEMINI_BASE_URL\n  });\n\n  proxy.start().catch((error) => {\n    console.error('âŒ Failed to start adaptive proxy:', error);\n    process.exit(1);\n  });\n\n  // Graceful shutdown\n  process.on('SIGINT', async () => {\n    await proxy.stop();\n    process.exit(0);\n  });\n\n  process.on('SIGTERM', async () => {\n    await proxy.stop();\n    process.exit(0);\n  });\n}\n"]}