{"version":3,"file":"transport-router.js","sourceRoot":"","sources":["../../src/swarm/transport-router.ts"],"names":[],"mappings":"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","sourcesContent":["// Transport Router - Protocol selection and routing with transparent fallback\n// Routes agent messages through QUIC or HTTP/2 based on availability\n\nimport { QuicClient, QuicConnectionPool } from '../transport/quic.js';\nimport { QuicCoordinator, SwarmMessage, SwarmAgent } from './quic-coordinator.js';\nimport { logger } from '../utils/logger.js';\nimport http2 from 'http2';\n\nexport type TransportProtocol = 'quic' | 'http2' | 'auto';\n\nexport interface TransportConfig {\n  protocol: TransportProtocol;\n  enableFallback: boolean;\n  quicConfig?: {\n    host: string;\n    port: number;\n    maxConnections: number;\n    certPath?: string;\n    keyPath?: string;\n  };\n  http2Config?: {\n    host: string;\n    port: number;\n    maxConnections: number;\n    secure: boolean;\n  };\n}\n\nexport interface TransportStats {\n  protocol: 'quic' | 'http2';\n  messagesSent: number;\n  messagesReceived: number;\n  bytesTransferred: number;\n  averageLatency: number;\n  errorRate: number;\n}\n\nexport interface RouteResult {\n  success: boolean;\n  protocol: 'quic' | 'http2';\n  latency: number;\n  error?: string;\n}\n\n/**\n * TransportRouter - Intelligent transport layer with automatic protocol selection\n *\n * Features:\n * - Automatic QUIC/HTTP2 protocol selection\n * - Transparent fallback on failure\n * - Connection pooling for both protocols\n * - Per-protocol statistics tracking\n * - Health checking and availability detection\n */\nexport class TransportRouter {\n  private config: Required<TransportConfig>;\n  private quicClient?: QuicClient;\n  private quicPool?: QuicConnectionPool;\n  private quicCoordinator?: QuicCoordinator;\n  private http2Sessions: Map<string, http2.ClientHttp2Session>;\n  private currentProtocol: 'quic' | 'http2';\n  private stats: Map<'quic' | 'http2', TransportStats>;\n  private healthCheckTimer?: NodeJS.Timeout;\n  private quicAvailable: boolean;\n\n  constructor(config: TransportConfig) {\n    this.config = {\n      protocol: config.protocol || 'auto',\n      enableFallback: config.enableFallback ?? true,\n      quicConfig: config.quicConfig || {\n        host: 'localhost',\n        port: 4433,\n        maxConnections: 100\n      },\n      http2Config: config.http2Config || {\n        host: 'localhost',\n        port: 8443,\n        maxConnections: 100,\n        secure: true\n      }\n    };\n\n    this.http2Sessions = new Map();\n    this.currentProtocol = 'http2'; // Default to HTTP2\n    this.quicAvailable = false;\n\n    // Initialize stats\n    this.stats = new Map([\n      ['quic', {\n        protocol: 'quic',\n        messagesSent: 0,\n        messagesReceived: 0,\n        bytesTransferred: 0,\n        averageLatency: 0,\n        errorRate: 0\n      }],\n      ['http2', {\n        protocol: 'http2',\n        messagesSent: 0,\n        messagesReceived: 0,\n        bytesTransferred: 0,\n        averageLatency: 0,\n        errorRate: 0\n      }]\n    ]);\n\n    logger.info('Transport Router initialized', {\n      protocol: config.protocol,\n      enableFallback: config.enableFallback\n    });\n  }\n\n  /**\n   * Initialize transport router\n   */\n  async initialize(): Promise<void> {\n    logger.info('Initializing transport router...');\n\n    // Try to initialize QUIC\n    if (this.config.protocol === 'quic' || this.config.protocol === 'auto') {\n      try {\n        await this.initializeQuic();\n        this.quicAvailable = true;\n        this.currentProtocol = 'quic';\n        logger.info('QUIC transport initialized successfully');\n      } catch (error) {\n        logger.warn('QUIC initialization failed, using HTTP/2', { error });\n        this.quicAvailable = false;\n        this.currentProtocol = 'http2';\n      }\n    }\n\n    // Always initialize HTTP/2 as fallback\n    if (!this.quicAvailable || this.config.enableFallback) {\n      await this.initializeHttp2();\n      logger.info('HTTP/2 transport initialized successfully');\n    }\n\n    // Start health checks if auto mode\n    if (this.config.protocol === 'auto') {\n      this.startHealthChecks();\n    }\n\n    logger.info('Transport router initialized', {\n      currentProtocol: this.currentProtocol,\n      quicAvailable: this.quicAvailable\n    });\n  }\n\n  /**\n   * Initialize QUIC transport\n   */\n  private async initializeQuic(): Promise<void> {\n    this.quicClient = new QuicClient({\n      serverHost: this.config.quicConfig.host,\n      serverPort: this.config.quicConfig.port,\n      maxConnections: this.config.quicConfig.maxConnections,\n      certPath: this.config.quicConfig.certPath,\n      keyPath: this.config.quicConfig.keyPath\n    });\n\n    await this.quicClient.initialize();\n\n    this.quicPool = new QuicConnectionPool(\n      this.quicClient,\n      this.config.quicConfig.maxConnections\n    );\n\n    logger.debug('QUIC client and pool initialized');\n  }\n\n  /**\n   * Initialize HTTP/2 transport\n   */\n  private async initializeHttp2(): Promise<void> {\n    // HTTP/2 sessions are created on-demand in sendViaHttp2\n    logger.debug('HTTP/2 transport configured');\n  }\n\n  /**\n   * Initialize QUIC coordinator for swarm\n   */\n  async initializeSwarm(\n    swarmId: string,\n    topology: 'mesh' | 'hierarchical' | 'ring' | 'star',\n    maxAgents: number = 10\n  ): Promise<QuicCoordinator> {\n    if (!this.quicClient || !this.quicPool) {\n      throw new Error('QUIC not initialized. Cannot create swarm with QUIC transport.');\n    }\n\n    this.quicCoordinator = new QuicCoordinator({\n      swarmId,\n      topology,\n      maxAgents,\n      quicClient: this.quicClient,\n      connectionPool: this.quicPool\n    });\n\n    await this.quicCoordinator.start();\n\n    logger.info('QUIC swarm coordinator initialized', { swarmId, topology, maxAgents });\n\n    return this.quicCoordinator;\n  }\n\n  /**\n   * Route message through appropriate transport\n   */\n  async route(message: SwarmMessage, target: SwarmAgent): Promise<RouteResult> {\n    const startTime = Date.now();\n\n    try {\n      // Try primary protocol\n      if (this.currentProtocol === 'quic' && this.quicAvailable) {\n        try {\n          await this.sendViaQuic(message, target);\n          const latency = Date.now() - startTime;\n          this.updateStats('quic', true, latency, this.estimateMessageSize(message));\n          return { success: true, protocol: 'quic', latency };\n        } catch (error) {\n          logger.warn('QUIC send failed, attempting fallback', { error });\n\n          if (!this.config.enableFallback) {\n            throw error;\n          }\n\n          // Fallback to HTTP/2\n          await this.sendViaHttp2(message, target);\n          const latency = Date.now() - startTime;\n          this.updateStats('http2', true, latency, this.estimateMessageSize(message));\n          return { success: true, protocol: 'http2', latency };\n        }\n      } else {\n        // Use HTTP/2\n        await this.sendViaHttp2(message, target);\n        const latency = Date.now() - startTime;\n        this.updateStats('http2', true, latency, this.estimateMessageSize(message));\n        return { success: true, protocol: 'http2', latency };\n      }\n    } catch (error) {\n      const latency = Date.now() - startTime;\n      this.updateStats(this.currentProtocol, false, latency, 0);\n      return {\n        success: false,\n        protocol: this.currentProtocol,\n        latency,\n        error: (error as Error).message\n      };\n    }\n  }\n\n  /**\n   * Send message via QUIC\n   */\n  private async sendViaQuic(message: SwarmMessage, target: SwarmAgent): Promise<void> {\n    if (!this.quicClient || !this.quicPool) {\n      throw new Error('QUIC not initialized');\n    }\n\n    // Get or create connection\n    const connection = await this.quicPool.getConnection(target.host, target.port);\n\n    // Create stream and send\n    const stream = await this.quicClient.createStream(connection.id);\n\n    try {\n      const messageBytes = this.serializeMessage(message);\n      await stream.send(messageBytes);\n      logger.debug('Message sent via QUIC', {\n        messageId: message.id,\n        target: target.id,\n        bytes: messageBytes.length\n      });\n    } finally {\n      await stream.close();\n    }\n  }\n\n  /**\n   * Send message via HTTP/2\n   */\n  private async sendViaHttp2(message: SwarmMessage, target: SwarmAgent): Promise<void> {\n    const sessionKey = `${target.host}:${target.port}`;\n\n    // Get or create HTTP/2 session\n    let session = this.http2Sessions.get(sessionKey);\n    if (!session || session.destroyed) {\n      const protocol = this.config.http2Config.secure ? 'https' : 'http';\n      session = http2.connect(`${protocol}://${target.host}:${target.port}`);\n      this.http2Sessions.set(sessionKey, session);\n    }\n\n    return new Promise((resolve, reject) => {\n      const req = session!.request({\n        ':method': 'POST',\n        ':path': '/message',\n        'content-type': 'application/json'\n      });\n\n      const messageJson = JSON.stringify(message);\n\n      req.on('response', (headers) => {\n        const status = headers[':status'];\n        if (status === 200) {\n          logger.debug('Message sent via HTTP/2', {\n            messageId: message.id,\n            target: target.id,\n            bytes: messageJson.length\n          });\n          resolve();\n        } else {\n          reject(new Error(`HTTP/2 request failed with status ${status}`));\n        }\n      });\n\n      req.on('error', (error) => {\n        logger.error('HTTP/2 request error', { error });\n        reject(error);\n      });\n\n      req.write(messageJson);\n      req.end();\n    });\n  }\n\n  /**\n   * Get current transport protocol\n   */\n  getCurrentProtocol(): 'quic' | 'http2' {\n    return this.currentProtocol;\n  }\n\n  /**\n   * Check if QUIC is available\n   */\n  isQuicAvailable(): boolean {\n    return this.quicAvailable;\n  }\n\n  /**\n   * Get transport statistics\n   */\n  getStats(protocol?: 'quic' | 'http2'): TransportStats | Map<'quic' | 'http2', TransportStats> {\n    if (protocol) {\n      return this.stats.get(protocol)!;\n    }\n    return this.stats;\n  }\n\n  /**\n   * Get QUIC coordinator (if initialized)\n   */\n  getCoordinator(): QuicCoordinator | undefined {\n    return this.quicCoordinator;\n  }\n\n  /**\n   * Shutdown transport router\n   */\n  async shutdown(): Promise<void> {\n    logger.info('Shutting down transport router');\n\n    // Stop health checks\n    if (this.healthCheckTimer) {\n      clearInterval(this.healthCheckTimer);\n    }\n\n    // Shutdown QUIC coordinator\n    if (this.quicCoordinator) {\n      await this.quicCoordinator.stop();\n    }\n\n    // Close QUIC pool\n    if (this.quicPool) {\n      await this.quicPool.clear();\n    }\n\n    // Shutdown QUIC client\n    if (this.quicClient) {\n      await this.quicClient.shutdown();\n    }\n\n    // Close HTTP/2 sessions\n    for (const session of this.http2Sessions.values()) {\n      session.close();\n    }\n    this.http2Sessions.clear();\n\n    logger.info('Transport router shutdown complete');\n  }\n\n  // ========== Private Methods ==========\n\n  /**\n   * Start health checks for protocol availability\n   */\n  private startHealthChecks(): void {\n    this.healthCheckTimer = setInterval(async () => {\n      await this.checkQuicHealth();\n    }, 30000); // Check every 30 seconds\n  }\n\n  /**\n   * Check QUIC health\n   */\n  private async checkQuicHealth(): Promise<void> {\n    if (!this.quicClient) {\n      return;\n    }\n\n    try {\n      // Try to get stats as health check\n      const stats = this.quicClient.getStats();\n\n      if (!this.quicAvailable) {\n        this.quicAvailable = true;\n        this.currentProtocol = 'quic';\n        logger.info('QUIC became available, switching protocol');\n      }\n    } catch (error) {\n      if (this.quicAvailable) {\n        this.quicAvailable = false;\n        this.currentProtocol = 'http2';\n        logger.warn('QUIC became unavailable, switching to HTTP/2', { error });\n      }\n    }\n  }\n\n  /**\n   * Update transport statistics\n   */\n  private updateStats(\n    protocol: 'quic' | 'http2',\n    success: boolean,\n    latency: number,\n    bytes: number\n  ): void {\n    const stats = this.stats.get(protocol)!;\n\n    if (success) {\n      stats.messagesSent++;\n      stats.bytesTransferred += bytes;\n\n      // Update average latency (exponential moving average)\n      const alpha = 0.1;\n      stats.averageLatency = stats.averageLatency * (1 - alpha) + latency * alpha;\n    } else {\n      // Update error rate (exponential moving average)\n      const alpha = 0.1;\n      const errorCount = stats.messagesSent * stats.errorRate + 1;\n      stats.errorRate = errorCount / (stats.messagesSent + 1);\n    }\n  }\n\n  /**\n   * Serialize message to bytes\n   */\n  private serializeMessage(message: SwarmMessage): Uint8Array {\n    const json = JSON.stringify(message);\n    const encoder = new TextEncoder();\n    return encoder.encode(json);\n  }\n\n  /**\n   * Estimate message size in bytes\n   */\n  private estimateMessageSize(message: SwarmMessage): number {\n    return JSON.stringify(message).length;\n  }\n}\n"]}