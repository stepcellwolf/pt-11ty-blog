{"version":3,"file":"quic-coordinator.js","sourceRoot":"","sources":["../../src/swarm/quic-coordinator.ts"],"names":[],"mappings":"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","sourcesContent":["// QUIC-enabled Swarm Coordinator\n// Manages agent-to-agent communication over QUIC transport with fallback to HTTP/2\n\nimport { QuicClient, QuicConnectionPool, QuicConnection, QuicStream, QuicStats } from '../transport/quic.js';\nimport { logger } from '../utils/logger.js';\n\nexport type SwarmTopology = 'mesh' | 'hierarchical' | 'ring' | 'star';\nexport type AgentRole = 'coordinator' | 'worker' | 'aggregator' | 'validator';\n\nexport interface SwarmAgent {\n  id: string;\n  role: AgentRole;\n  host: string;\n  port: number;\n  capabilities: string[];\n  metadata?: Record<string, any>;\n}\n\nexport interface SwarmMessage {\n  id: string;\n  from: string;\n  to: string | string[];\n  type: 'task' | 'result' | 'state' | 'heartbeat' | 'sync';\n  payload: any;\n  timestamp: number;\n  ttl?: number;\n}\n\nexport interface SwarmState {\n  swarmId: string;\n  topology: SwarmTopology;\n  agents: Map<string, SwarmAgent>;\n  connections: Map<string, QuicConnection>;\n  stats: SwarmStats;\n}\n\nexport interface SwarmStats {\n  totalAgents: number;\n  activeAgents: number;\n  totalMessages: number;\n  messagesPerSecond: number;\n  averageLatency: number;\n  quicStats: QuicStats;\n}\n\nexport interface QuicCoordinatorConfig {\n  swarmId: string;\n  topology: SwarmTopology;\n  maxAgents: number;\n  quicClient: QuicClient;\n  connectionPool: QuicConnectionPool;\n  heartbeatInterval?: number;\n  statesSyncInterval?: number;\n  enableCompression?: boolean;\n}\n\n/**\n * QuicCoordinator - Manages multi-agent swarm coordination over QUIC\n *\n * Features:\n * - Agent-to-agent communication via QUIC streams\n * - Topology-aware message routing (mesh, hierarchical, ring, star)\n * - Connection pooling for efficient resource usage\n * - Real-time state synchronization\n * - Per-agent statistics tracking\n */\nexport class QuicCoordinator {\n  private config: Required<QuicCoordinatorConfig>;\n  private state: SwarmState;\n  private messageQueue: SwarmMessage[];\n  private heartbeatTimer?: NodeJS.Timeout;\n  private syncTimer?: NodeJS.Timeout;\n  private messageStats: Map<string, { sent: number; received: number; latency: number[] }>;\n\n  constructor(config: QuicCoordinatorConfig) {\n    this.config = {\n      ...config,\n      heartbeatInterval: config.heartbeatInterval || 10000,\n      statesSyncInterval: config.statesSyncInterval || 5000,\n      enableCompression: config.enableCompression ?? true\n    };\n\n    this.state = {\n      swarmId: config.swarmId,\n      topology: config.topology,\n      agents: new Map(),\n      connections: new Map(),\n      stats: {\n        totalAgents: 0,\n        activeAgents: 0,\n        totalMessages: 0,\n        messagesPerSecond: 0,\n        averageLatency: 0,\n        quicStats: {\n          totalConnections: 0,\n          activeConnections: 0,\n          totalStreams: 0,\n          activeStreams: 0,\n          bytesReceived: 0,\n          bytesSent: 0,\n          packetsLost: 0,\n          rttMs: 0\n        }\n      }\n    };\n\n    this.messageQueue = [];\n    this.messageStats = new Map();\n\n    logger.info('QUIC Coordinator initialized', {\n      swarmId: config.swarmId,\n      topology: config.topology,\n      maxAgents: config.maxAgents\n    });\n  }\n\n  /**\n   * Start the coordinator (heartbeat and state sync)\n   */\n  async start(): Promise<void> {\n    logger.info('Starting QUIC Coordinator', { swarmId: this.config.swarmId });\n\n    // Initialize QUIC client\n    await this.config.quicClient.initialize();\n\n    // Start heartbeat\n    this.startHeartbeat();\n\n    // Start state synchronization\n    this.startStateSync();\n\n    logger.info('QUIC Coordinator started successfully');\n  }\n\n  /**\n   * Stop the coordinator\n   */\n  async stop(): Promise<void> {\n    logger.info('Stopping QUIC Coordinator', { swarmId: this.config.swarmId });\n\n    // Stop timers\n    if (this.heartbeatTimer) {\n      clearInterval(this.heartbeatTimer);\n    }\n    if (this.syncTimer) {\n      clearInterval(this.syncTimer);\n    }\n\n    // Close all connections\n    for (const [agentId, connection] of this.state.connections.entries()) {\n      await this.config.quicClient.closeConnection(connection.id);\n      logger.debug('Closed connection', { agentId, connectionId: connection.id });\n    }\n\n    // Shutdown QUIC client\n    await this.config.quicClient.shutdown();\n\n    logger.info('QUIC Coordinator stopped');\n  }\n\n  /**\n   * Register an agent in the swarm\n   */\n  async registerAgent(agent: SwarmAgent): Promise<void> {\n    if (this.state.agents.size >= this.config.maxAgents) {\n      throw new Error(`Maximum agents (${this.config.maxAgents}) reached`);\n    }\n\n    logger.info('Registering agent', {\n      agentId: agent.id,\n      role: agent.role,\n      host: agent.host,\n      port: agent.port\n    });\n\n    // Establish QUIC connection to agent\n    const connection = await this.config.connectionPool.getConnection(agent.host, agent.port);\n\n    // Store agent and connection\n    this.state.agents.set(agent.id, agent);\n    this.state.connections.set(agent.id, connection);\n    this.messageStats.set(agent.id, { sent: 0, received: 0, latency: [] });\n\n    // Update stats\n    this.state.stats.totalAgents = this.state.agents.size;\n    this.state.stats.activeAgents = this.state.agents.size;\n\n    // Establish topology-specific connections\n    await this.establishTopologyConnections(agent);\n\n    logger.info('Agent registered successfully', { agentId: agent.id });\n  }\n\n  /**\n   * Unregister an agent from the swarm\n   */\n  async unregisterAgent(agentId: string): Promise<void> {\n    const agent = this.state.agents.get(agentId);\n    if (!agent) {\n      logger.warn('Agent not found', { agentId });\n      return;\n    }\n\n    logger.info('Unregistering agent', { agentId });\n\n    // Close connection\n    const connection = this.state.connections.get(agentId);\n    if (connection) {\n      await this.config.quicClient.closeConnection(connection.id);\n    }\n\n    // Remove from state\n    this.state.agents.delete(agentId);\n    this.state.connections.delete(agentId);\n    this.messageStats.delete(agentId);\n\n    // Update stats\n    this.state.stats.totalAgents = this.state.agents.size;\n    this.state.stats.activeAgents = this.state.agents.size;\n\n    logger.info('Agent unregistered successfully', { agentId });\n  }\n\n  /**\n   * Send message to one or more agents\n   */\n  async sendMessage(message: SwarmMessage): Promise<void> {\n    const startTime = Date.now();\n\n    logger.debug('Sending message', {\n      messageId: message.id,\n      from: message.from,\n      to: message.to,\n      type: message.type\n    });\n\n    // Determine recipients based on topology\n    const recipients = this.resolveRecipients(message);\n\n    // Send message to each recipient\n    for (const recipientId of recipients) {\n      await this.sendToAgent(recipientId, message);\n    }\n\n    // Update stats\n    const latency = Date.now() - startTime;\n    this.updateMessageStats(message.from, 'sent', latency);\n    this.state.stats.totalMessages++;\n\n    logger.debug('Message sent successfully', {\n      messageId: message.id,\n      recipients: recipients.length,\n      latency\n    });\n  }\n\n  /**\n   * Broadcast message to all agents (except sender)\n   */\n  async broadcast(message: Omit<SwarmMessage, 'to'>): Promise<void> {\n    const broadcastMessage: SwarmMessage = {\n      ...message,\n      to: '*'\n    };\n\n    await this.sendMessage(broadcastMessage);\n  }\n\n  /**\n   * Get current swarm state\n   */\n  async getState(): Promise<SwarmState> {\n    return {\n      ...this.state,\n      stats: await this.calculateStats()\n    };\n  }\n\n  /**\n   * Get agent statistics\n   */\n  getAgentStats(agentId: string): { sent: number; received: number; avgLatency: number } | null {\n    const stats = this.messageStats.get(agentId);\n    if (!stats) {\n      return null;\n    }\n\n    return {\n      sent: stats.sent,\n      received: stats.received,\n      avgLatency: stats.latency.length > 0\n        ? stats.latency.reduce((sum, l) => sum + l, 0) / stats.latency.length\n        : 0\n    };\n  }\n\n  /**\n   * Get all agent statistics\n   */\n  getAllAgentStats(): Map<string, { sent: number; received: number; avgLatency: number }> {\n    const allStats = new Map();\n    for (const [agentId, stats] of this.messageStats.entries()) {\n      allStats.set(agentId, {\n        sent: stats.sent,\n        received: stats.received,\n        avgLatency: stats.latency.length > 0\n          ? stats.latency.reduce((sum, l) => sum + l, 0) / stats.latency.length\n          : 0\n      });\n    }\n    return allStats;\n  }\n\n  /**\n   * Synchronize state across all agents\n   */\n  async syncState(): Promise<void> {\n    logger.debug('Synchronizing swarm state', { swarmId: this.config.swarmId });\n\n    const stateMessage: SwarmMessage = {\n      id: `sync-${Date.now()}`,\n      from: 'coordinator',\n      to: '*',\n      type: 'sync',\n      payload: {\n        swarmId: this.state.swarmId,\n        topology: this.state.topology,\n        agents: Array.from(this.state.agents.values()),\n        stats: this.calculateStats()\n      },\n      timestamp: Date.now()\n    };\n\n    await this.broadcast(stateMessage);\n  }\n\n  // ========== Private Methods ==========\n\n  /**\n   * Establish topology-specific connections\n   */\n  private async establishTopologyConnections(agent: SwarmAgent): Promise<void> {\n    switch (this.config.topology) {\n      case 'mesh':\n        // In mesh, each agent connects to all others (handled by caller)\n        logger.debug('Mesh topology: agent connects to all', { agentId: agent.id });\n        break;\n\n      case 'hierarchical':\n        // In hierarchical, workers connect to coordinators\n        if (agent.role === 'worker') {\n          const coordinators = Array.from(this.state.agents.values())\n            .filter(a => a.role === 'coordinator');\n          logger.debug('Hierarchical topology: connecting worker to coordinators', {\n            agentId: agent.id,\n            coordinators: coordinators.length\n          });\n        }\n        break;\n\n      case 'ring':\n        // In ring, each agent connects to next agent in circular order\n        const agents = Array.from(this.state.agents.values());\n        if (agents.length > 1) {\n          logger.debug('Ring topology: establishing ring connections', {\n            agentId: agent.id,\n            totalAgents: agents.length\n          });\n        }\n        break;\n\n      case 'star':\n        // In star, all agents connect to central coordinator\n        if (agent.role === 'coordinator') {\n          logger.debug('Star topology: coordinator established', { agentId: agent.id });\n        } else {\n          const coordinator = Array.from(this.state.agents.values())\n            .find(a => a.role === 'coordinator');\n          if (coordinator) {\n            logger.debug('Star topology: connecting to coordinator', {\n              agentId: agent.id,\n              coordinator: coordinator.id\n            });\n          }\n        }\n        break;\n    }\n  }\n\n  /**\n   * Resolve message recipients based on topology\n   */\n  private resolveRecipients(message: SwarmMessage): string[] {\n    const recipients: string[] = [];\n    const to = Array.isArray(message.to) ? message.to : [message.to];\n\n    for (const target of to) {\n      if (target === '*') {\n        // Broadcast to all (except sender)\n        recipients.push(\n          ...Array.from(this.state.agents.keys())\n            .filter(id => id !== message.from)\n        );\n      } else {\n        recipients.push(target);\n      }\n    }\n\n    // Apply topology-specific routing\n    return this.applyTopologyRouting(message.from, recipients);\n  }\n\n  /**\n   * Apply topology-specific routing rules\n   */\n  private applyTopologyRouting(senderId: string, recipients: string[]): string[] {\n    switch (this.config.topology) {\n      case 'mesh':\n        // Direct routing in mesh topology\n        return recipients;\n\n      case 'hierarchical':\n        // Route through coordinator in hierarchical\n        const sender = this.state.agents.get(senderId);\n        if (sender?.role === 'worker') {\n          // Worker messages go through coordinator\n          const coordinators = Array.from(this.state.agents.values())\n            .filter(a => a.role === 'coordinator')\n            .map(a => a.id);\n          return coordinators.length > 0 ? coordinators : recipients;\n        }\n        return recipients;\n\n      case 'ring':\n        // Forward to next agent in ring\n        const agents = Array.from(this.state.agents.keys());\n        const currentIndex = agents.indexOf(senderId);\n        const nextIndex = (currentIndex + 1) % agents.length;\n        return [agents[nextIndex]];\n\n      case 'star':\n        // Route through central coordinator\n        const coordinator = Array.from(this.state.agents.values())\n          .find(a => a.role === 'coordinator');\n        if (coordinator && senderId !== coordinator.id) {\n          return [coordinator.id];\n        }\n        return recipients;\n\n      default:\n        return recipients;\n    }\n  }\n\n  /**\n   * Send message to specific agent\n   */\n  private async sendToAgent(agentId: string, message: SwarmMessage): Promise<void> {\n    const connection = this.state.connections.get(agentId);\n    if (!connection) {\n      logger.warn('Connection not found for agent', { agentId });\n      return;\n    }\n\n    try {\n      // Create QUIC stream\n      const stream = await this.config.quicClient.createStream(connection.id);\n\n      // Serialize message\n      const messageBytes = this.serializeMessage(message);\n\n      // Send message\n      await stream.send(messageBytes);\n\n      // Close stream\n      await stream.close();\n\n      logger.debug('Message sent to agent', { agentId, messageId: message.id });\n    } catch (error) {\n      logger.error('Failed to send message to agent', { agentId, error });\n      throw error;\n    }\n  }\n\n  /**\n   * Serialize message to bytes\n   */\n  private serializeMessage(message: SwarmMessage): Uint8Array {\n    const json = JSON.stringify(message);\n    const encoder = new TextEncoder();\n    return encoder.encode(json);\n  }\n\n  /**\n   * Start heartbeat timer\n   */\n  private startHeartbeat(): void {\n    this.heartbeatTimer = setInterval(async () => {\n      logger.debug('Sending heartbeat', { swarmId: this.config.swarmId });\n\n      const heartbeat: SwarmMessage = {\n        id: `heartbeat-${Date.now()}`,\n        from: 'coordinator',\n        to: '*',\n        type: 'heartbeat',\n        payload: { timestamp: Date.now() },\n        timestamp: Date.now()\n      };\n\n      try {\n        await this.broadcast(heartbeat);\n      } catch (error) {\n        logger.error('Heartbeat failed', { error });\n      }\n    }, this.config.heartbeatInterval);\n  }\n\n  /**\n   * Start state sync timer\n   */\n  private startStateSync(): void {\n    this.syncTimer = setInterval(async () => {\n      try {\n        await this.syncState();\n      } catch (error) {\n        logger.error('State sync failed', { error });\n      }\n    }, this.config.statesSyncInterval);\n  }\n\n  /**\n   * Update message statistics\n   */\n  private updateMessageStats(agentId: string, type: 'sent' | 'received', latency: number): void {\n    const stats = this.messageStats.get(agentId);\n    if (!stats) {\n      return;\n    }\n\n    if (type === 'sent') {\n      stats.sent++;\n    } else {\n      stats.received++;\n    }\n\n    stats.latency.push(latency);\n\n    // Keep only last 100 latency measurements\n    if (stats.latency.length > 100) {\n      stats.latency.shift();\n    }\n  }\n\n  /**\n   * Calculate current swarm statistics\n   */\n  private async calculateStats(): Promise<SwarmStats> {\n    const quicStats = await this.config.quicClient.getStats();\n\n    // Calculate messages per second (last minute average)\n    const messagesPerSecond = this.state.stats.totalMessages / 60;\n\n    // Calculate average latency across all agents\n    let totalLatency = 0;\n    let latencyCount = 0;\n    for (const stats of this.messageStats.values()) {\n      if (stats.latency.length > 0) {\n        totalLatency += stats.latency.reduce((sum, l) => sum + l, 0);\n        latencyCount += stats.latency.length;\n      }\n    }\n    const averageLatency = latencyCount > 0 ? totalLatency / latencyCount : 0;\n\n    return {\n      totalAgents: this.state.agents.size,\n      activeAgents: this.state.agents.size,\n      totalMessages: this.state.stats.totalMessages,\n      messagesPerSecond,\n      averageLatency,\n      quicStats\n    };\n  }\n}\n"]}