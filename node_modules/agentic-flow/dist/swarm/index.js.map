{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/swarm/index.ts"],"names":[],"mappings":"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","sourcesContent":["// Swarm Integration - Main export file for QUIC-enabled swarm coordination\n// Provides unified interface for multi-agent swarm initialization and management\n\nexport { QuicCoordinator, type SwarmAgent, type SwarmMessage, type SwarmState, type SwarmStats, type QuicCoordinatorConfig } from './quic-coordinator.js';\nexport { TransportRouter, type TransportProtocol, type TransportConfig, type TransportStats, type RouteResult } from './transport-router.js';\n\nimport { QuicClient, QuicConnectionPool } from '../transport/quic.js';\nimport { QuicCoordinator, SwarmAgent } from './quic-coordinator.js';\nimport { TransportRouter, TransportConfig } from './transport-router.js';\nimport { logger } from '../utils/logger.js';\n\nexport interface SwarmInitOptions {\n  swarmId: string;\n  topology: 'mesh' | 'hierarchical' | 'ring' | 'star';\n  transport?: 'quic' | 'http2' | 'auto';\n  maxAgents?: number;\n  quicPort?: number;\n  quicHost?: string;\n  enableFallback?: boolean;\n}\n\nexport interface SwarmInstance {\n  swarmId: string;\n  topology: 'mesh' | 'hierarchical' | 'ring' | 'star';\n  transport: 'quic' | 'http2';\n  coordinator?: QuicCoordinator;\n  router: TransportRouter;\n  registerAgent: (agent: SwarmAgent) => Promise<void>;\n  unregisterAgent: (agentId: string) => Promise<void>;\n  getStats: () => any;\n  shutdown: () => Promise<void>;\n}\n\n/**\n * Initialize a multi-agent swarm with QUIC transport\n *\n * @example\n * ```typescript\n * const swarm = await initSwarm({\n *   swarmId: 'my-swarm',\n *   topology: 'mesh',\n *   transport: 'quic',\n *   quicPort: 4433\n * });\n *\n * await swarm.registerAgent({\n *   id: 'agent-1',\n *   role: 'worker',\n *   host: 'localhost',\n *   port: 4434,\n *   capabilities: ['compute', 'analyze']\n * });\n * ```\n */\nexport async function initSwarm(options: SwarmInitOptions): Promise<SwarmInstance> {\n  const {\n    swarmId,\n    topology,\n    transport = 'auto',\n    maxAgents = 10,\n    quicPort = 4433,\n    quicHost = 'localhost',\n    enableFallback = true\n  } = options;\n\n  logger.info('Initializing swarm', {\n    swarmId,\n    topology,\n    transport,\n    maxAgents,\n    quicPort\n  });\n\n  // Create transport router configuration\n  const transportConfig: TransportConfig = {\n    protocol: transport,\n    enableFallback,\n    quicConfig: {\n      host: quicHost,\n      port: quicPort,\n      maxConnections: maxAgents * 2 // Allow some overhead\n    },\n    http2Config: {\n      host: quicHost,\n      port: quicPort + 1000, // HTTP/2 fallback port\n      maxConnections: maxAgents * 2,\n      secure: true\n    }\n  };\n\n  // Initialize transport router\n  const router = new TransportRouter(transportConfig);\n  await router.initialize();\n\n  const actualProtocol = router.getCurrentProtocol();\n  logger.info('Transport initialized', {\n    requestedProtocol: transport,\n    actualProtocol,\n    quicAvailable: router.isQuicAvailable()\n  });\n\n  // Initialize swarm coordinator if using QUIC\n  let coordinator: QuicCoordinator | undefined;\n  if (actualProtocol === 'quic') {\n    coordinator = await router.initializeSwarm(swarmId, topology, maxAgents);\n  }\n\n  // Create swarm instance\n  const swarm: SwarmInstance = {\n    swarmId,\n    topology,\n    transport: actualProtocol,\n    coordinator,\n    router,\n\n    async registerAgent(agent: SwarmAgent): Promise<void> {\n      if (coordinator) {\n        await coordinator.registerAgent(agent);\n      } else {\n        logger.warn('QUIC coordinator not available, agent registration skipped', {\n          agentId: agent.id\n        });\n      }\n    },\n\n    async unregisterAgent(agentId: string): Promise<void> {\n      if (coordinator) {\n        await coordinator.unregisterAgent(agentId);\n      } else {\n        logger.warn('QUIC coordinator not available, agent unregistration skipped', {\n          agentId\n        });\n      }\n    },\n\n    async getStats() {\n      return {\n        swarmId,\n        topology,\n        transport: actualProtocol,\n        coordinatorStats: coordinator ? (await coordinator.getState()).stats : undefined,\n        transportStats: router.getStats(),\n        quicAvailable: router.isQuicAvailable()\n      };\n    },\n\n    async shutdown(): Promise<void> {\n      logger.info('Shutting down swarm', { swarmId });\n      await router.shutdown();\n      logger.info('Swarm shutdown complete', { swarmId });\n    }\n  };\n\n  logger.info('Swarm initialized successfully', {\n    swarmId,\n    topology,\n    transport: actualProtocol,\n    quicEnabled: coordinator !== undefined\n  });\n\n  return swarm;\n}\n\n/**\n * Check if QUIC transport is available\n */\nexport async function checkQuicAvailability(): Promise<boolean> {\n  try {\n    const client = new QuicClient();\n    await client.initialize();\n    await client.shutdown();\n    return true;\n  } catch (error) {\n    logger.debug('QUIC not available', { error });\n    return false;\n  }\n}\n"]}