<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Secure containers with gVisor sandboxing—prevent kernel exploits in Kubernetes clusters while managing 59% startup overhead for untrusted workloads.">
    <meta name="author" content="William Zujkowski">
    <meta name="keywords" content="cybersecurity, information security, AI security, Zero-Trust, homelab, security engineering, NIST compliance, federal security">
    
    <title>Sandboxing Untrusted Containers with gVisor: Lessons from G-Fuzz Vulnerability Research - William Zujkowski</title>
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://williamzujkowski.github.io/posts/sandboxing-untrusted-containers-with-gvisor-lessons-from-g-fuzz-vulnerability-research/">
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/atom+xml" title="William Zujkowski Feed" href="https://williamzujkowski.github.io/feed.xml">
    
    <!-- Favicons and PWA -->
    
<!-- Primary Favicons -->
<link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">

<!-- SVG Icons for PWA -->
<link rel="icon" type="image/svg+xml" sizes="192x192" href="/assets/images/icon-192.svg">
<link rel="icon" type="image/svg+xml" sizes="512x512" href="/assets/images/icon-512.svg">

<!-- Theme Colors -->
<meta name="msapplication-TileColor" content="#1e40af">
<meta name="theme-color" content="#1e40af">

<!-- Web App Manifest -->
<link rel="manifest" href="/manifest.json">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Sandboxing Untrusted Containers with gVisor: Lessons from G-Fuzz Vulnerability Research">
    <meta property="og:description" content="Secure containers with gVisor sandboxing—prevent kernel exploits in Kubernetes clusters while managing 59% startup overhead for untrusted workloads.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://williamzujkowski.github.io/posts/sandboxing-untrusted-containers-with-gvisor-lessons-from-g-fuzz-vulnerability-research/">
    <meta property="og:image" content="https://williamzujkowski.github.io/assets/images/og-image.jpg">
    <meta property="og:site_name" content="William Zujkowski">
    <meta property="og:locale" content="en_US">
    
    <meta property="article:author" content="William Zujkowski">
    <meta property="article:published_time" content="2024-09-25">
    
    
    
    <!-- Additional SEO Meta -->
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        
        "headline": "Sandboxing Untrusted Containers with gVisor: Lessons from G-Fuzz Vulnerability Research",
        "description": "Secure containers with gVisor sandboxing—prevent kernel exploits in Kubernetes clusters while managing 59% startup overhead for untrusted workloads.",
        "datePublished": "2024-09-25",
        "dateModified": "2025-11-14",
        "author": {
            "@type": "Person",
            "name": "William Zujkowski",
            "url": "https://williamzujkowski.github.io/about/",
            "sameAs": [
                "https://github.com/williamzujkowski",
                "https://www.linkedin.com/in/williamzujkowski"
            ]
        },
        "publisher": {
            "@type": "Person",
            "name": "William Zujkowski",
            "url": "https://williamzujkowski.github.io",
            "logo": {
                "@type": "ImageObject",
                "url": "https://williamzujkowski.github.io/assets/images/headshot.png"
            }
        },
        "image": {
            "@type": "ImageObject",
            "url": "https://williamzujkowski.github.io/assets/images/og-image.jpg"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://williamzujkowski.github.io/posts/sandboxing-untrusted-containers-with-gvisor-lessons-from-g-fuzz-vulnerability-research/"
        },
        "url": "https://williamzujkowski.github.io/posts/sandboxing-untrusted-containers-with-gvisor-lessons-from-g-fuzz-vulnerability-research/"
        
    }
    </script>
    
    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://rsms.me">
    <link rel="dns-prefetch" href="https://rsms.me">
    
    <!-- Inter font -->
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    
    <!-- Dark mode script -->
    <script>
        // Initialize dark mode and theme color
        (function() {
            const isDark = localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            
            if (isDark) {
                document.documentElement.classList.add('dark');
                if (themeColorMeta) themeColorMeta.content = '#111827';
            } else {
                document.documentElement.classList.remove('dark');
                if (themeColorMeta) themeColorMeta.content = '#1e40af';
            }
        })();
    </script>
</head>
<body class="min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-300 antialiased">
    <a href="#main" class="skip-to-main">Skip to main content</a>


    
    <!-- Header -->
    <header role="banner" aria-label="Site header" class="site-header sticky top-0 z-50 w-full">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8" aria-label="Primary navigation">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <a href="/" class="text-xl font-semibold gradient-text">
                        William Zujkowski
                    </a>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1">
                        <ul class="flex items-center space-x-1"><li><a href="/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Home</a></li>
<li><a href="/about/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">About</a></li>
<li><a href="/posts/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Posts</a></li>
<li><a href="/resources/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Resources</a></li>
<li><a href="/stats/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Stats</a></li>
<li><a href="/uses/" class="px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Uses</a></li></ul>
                    </div>
                </div>
                
                <!-- Dark mode toggle & Mobile menu button -->
                <div class="flex items-center space-x-4">
                    <!-- Dark mode toggle -->
                    <button type="button" onclick="toggleDarkMode()" class="min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200" aria-label="Toggle dark mode">
                        <!-- Light mode icon -->
                        <svg class="w-5 h-5 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <!-- Dark mode icon -->
                        <svg class="w-5 h-5 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                    
                    <!-- Mobile menu button -->
                    <button type="button" onclick="toggleMobileMenu()" class="md:hidden min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200" aria-label="Toggle menu" data-mobile-menu-button>
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div id="mobile-menu" class="hidden md:hidden" data-mobile-menu-panel>
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <ul class="space-y-1"><li><a href="/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Home</a></li>
<li><a href="/about/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">About</a></li>
<li><a href="/posts/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Posts</a></li>
<li><a href="/resources/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Resources</a></li>
<li><a href="/stats/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Stats</a></li>
<li><a href="/uses/" class="block px-4 py-3 min-h-[44px] rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200">Uses</a></li></ul>
                </div>
            </div>
        </nav>
    </header>
    
    <!-- Breadcrumbs -->
    
    
    <!-- Main content -->
    <main id="main" class="flex-grow">
        <!-- Enhanced Breadcrumbs for Blog Posts -->
<nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-4" aria-label="Breadcrumb">
  <ol class="flex items-center space-x-2 text-sm flex-wrap">
    <li>
      <a href="/" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors">
        <svg class="w-4 h-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
        Home
      </a>
    </li>
    <li class="flex items-center">
      <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <a href="/posts/" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors">
        Blog
      </a>
    </li>
    
      
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
      
      <li class="flex items-center">
        <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <a href="/tags/container-orchestration/" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors">
          container-orchestration
        </a>
      </li>
      
    
    <li class="flex items-center">
      <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <span class="text-gray-900 dark:text-gray-100 font-medium truncate max-w-xs">Sandboxing Untrusted Containers with gVisor: Lesso...</span>
    </li>
  </ol>
</nav>

<article class="py-16 sm:py-24">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="mx-auto max-w-3xl">
            <header role="banner" aria-label="Site header" class="mb-12">
                <div class="text-center">
                    <div class="flex items-center justify-center space-x-4 text-sm font-medium">
                        <time datetime="2024-09-25" class="text-primary-600 dark:text-primary-400">
                            September 25, 2024
                        </time>
                        <span class="text-gray-400 dark:text-gray-600">•</span>
                        <span class="text-gray-600 dark:text-gray-400">
                            9 min read
                        </span>
                    </div>
                    <h1 class="mt-4 text-4xl font-bold tracking-tight text-gray-900 dark:text-gray-100 sm:text-5xl animate-fade-in-up">
                        Sandboxing Untrusted Containers with gVisor: Lessons from G-Fuzz Vulnerability Research
                    </h1>
                    
                    <p class="mt-6 text-lg leading-8 text-gray-600 dark:text-gray-300 animate-fade-in-up animation-delay-200">
                        Secure containers with gVisor sandboxing—prevent kernel exploits in Kubernetes clusters while managing 59% startup overhead for untrusted workloads.
                    </p>
                    
                </div>
                
                
                <div class="mt-8 flex flex-wrap justify-center gap-2 animate-fade-in-up animation-delay-400">
                    
                        
                    
                        
                        <a href="/tags/container-orchestration/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            container-orchestration
                        </a>
                        
                    
                        
                        <a href="/tags/container-security/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            container-security
                        </a>
                        
                    
                        
                        <a href="/tags/docker/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            docker
                        </a>
                        
                    
                        
                        <a href="/tags/homelab/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            homelab
                        </a>
                        
                    
                        
                        <a href="/tags/security/" class="inline-flex items-center rounded-full bg-primary-50 dark:bg-primary-900/20 px-3 py-1 text-sm font-medium text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/30 transition-colors">
                            security
                        </a>
                        
                    
                </div>
                
            </header>

            <!-- Table of Contents Accordion -->
            <nav aria-label="Table of contents" class="toc-accordion mb-8 animate-fade-in-up animation-delay-500">
                <details class="group">
                    <summary class="cursor-pointer select-none font-medium flex items-center justify-between">
                        <span>Table of Contents</span>
                        <svg class="w-5 h-5 transform group-open:rotate-180 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </summary>
                    <div class="toc-content mt-4" id="toc-content">
                        <!-- ToC will be generated here by JavaScript -->
                    </div>
                </details>
            </nav>

            <div class="prose prose-lg prose-gray dark:prose-invert mx-auto animate-fade-in-up animation-delay-600">
                <h2>Bottom Line Up Front</h2>
<p><strong>gVisor adds OS-level sandboxing to containers, preventing kernel exploits by intercepting syscalls in userspace.</strong> Google's G-Fuzz framework discovered multiple vulnerabilities in gVisor, but it still outperforms runc for untrusted workloads. In my K3s cluster, gVisor increased container startup time from 42ms to 67ms (59% overhead) yet stopped every container escape attempt I tested.</p>
<p><strong>Why it matters:</strong> <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-21626">CVE-2024-21626 (CVSS 8.6)</a> enabled runc container escapes in January 2024. <a href="https://www.docker.com/blog/docker-security-advisory-multiple-vulnerabilities-in-runc-buildkit-and-moby/">Docker patched it</a>, but the vulnerability existed for years. gVisor's userspace kernel prevents entire classes of these exploits.</p>
<p><strong>The research:</strong> <a href="https://arxiv.org/abs/2409.13139">G-Fuzz</a>, published September 2024 in IEEE Transactions on Dependable and Secure Computing, uses directed fuzzing to test gVisor's 1.2 million lines of Go code. It found vulnerabilities that Syzkaller missed.</p>
<h2>The Container Escape Problem</h2>
<p>Containers share the host kernel. One bad syscall can break containment. This is why <a href="/posts/2025-08-18-container-security-hardening-homelab">container security hardening</a> requires multiple layers of defense beyond just namespaces and cgroups.</p>
<p><strong>Recent escapes:</strong></p>
<ul>
<li><strong>CVE-2024-21626:</strong> runc working directory manipulation → host filesystem access</li>
<li><strong>CVE-2024-23651:</strong> BuildKit race condition → host file exposure</li>
<li><strong>CVE-2024-23652:</strong> BuildKit cache mount → arbitrary file read</li>
<li><strong>CVE-2024-23653:</strong> BuildKit GRPC API → privilege escalation</li>
</ul>
<p><a href="https://snyk.io/blog/leaky-vessels-docker-runc-container-breakout-vulnerabilities/">Snyk's &quot;Leaky Vessels&quot; advisory</a> details how attackers weaponized these. The common thread: kernel syscall filtering isn't enough.</p>
<p><strong>Standard container security relies on:</strong></p>
<ul>
<li><strong><a href="https://man7.org/linux/man-pages/man7/namespaces.7.html">Namespaces</a>:</strong> Isolate process trees, networks, filesystems</li>
<li><strong><a href="https://www.kernel.org/doc/Documentation/cgroup-v2.txt">Cgroups</a>:</strong> Limit CPU, memory, I/O</li>
<li><strong><a href="https://www.kernel.org/doc/html/latest/userspace-api/seccomp_filter.html">Seccomp-BPF</a>:</strong> Block dangerous syscalls</li>
<li><strong>AppArmor/SELinux:</strong> Mandatory access control</li>
</ul>
<p><strong>But:</strong> All these run in the kernel. Kernel bugs bypass them.</p>
<p><strong>Why it matters:</strong> You can harden seccomp profiles for weeks. One kernel 0-day undoes it all.</p>
<h2>What gVisor Actually Does</h2>
<p>gVisor inserts a userspace kernel between containers and the host.</p>
<p><strong>Architecture:</strong></p>
<pre><code>Container → gVisor Sentry (userspace) → Host Kernel
</code></pre>
<p><strong>The Sentry:</strong></p>
<ul>
<li>Written in Go (memory-safe, no buffer overflows)</li>
<li>Intercepts every syscall</li>
<li>Re-implements 200+ Linux syscalls in userspace</li>
<li>Only safe operations reach the host kernel</li>
</ul>
<p><strong>The Gofer:</strong></p>
<ul>
<li>Handles filesystem access via <a href="https://9p.io/magic/man2html/5/intro">9P protocol</a></li>
<li>Runs with minimal privileges</li>
<li>Cannot access host filesystem directly</li>
</ul>
<p><strong>Key insight:</strong> Even if a container exploits a syscall bug, it's exploiting Go code in userspace, not the kernel. No privilege escalation to host.</p>
<p><strong>Trade-off:</strong> Performance. Every syscall crosses userspace boundary twice (container → Sentry → kernel → Sentry → container).</p>
<h2>G-Fuzz: Finding Bugs in the Sandbox</h2>
<p><a href="https://arxiv.org/abs/2409.13139">G-Fuzz</a> is a directed fuzzing framework targeting gVisor's Go-based kernel.</p>
<p><strong>The challenge:</strong> Traditional fuzzers like <a href="https://github.com/google/syzkaller">Syzkaller</a> target C kernels. gVisor is Go. Different memory model, different vulnerabilities.</p>
<p><strong>G-Fuzz innovations:</strong></p>
<ol>
<li><strong>Lightweight distance calculation:</strong> Measures how close inputs are to reaching target code paths without heavyweight instrumentation</li>
<li><strong>Syscall inference:</strong> Identifies which syscalls are most likely to trigger bugs in specific code regions</li>
<li><strong>Dynamic switching:</strong> Alternates between exploration (finding new code) and exploitation (triggering bugs)</li>
</ol>
<p><strong>Results:</strong></p>
<ul>
<li>Outperformed Syzkaller on gVisor by significant margins</li>
<li>Detected multiple serious vulnerabilities</li>
<li>Methods transferable to other OS kernels</li>
</ul>
<p><strong>What the paper doesn't say:</strong> Exact CVE numbers or vulnerability details. Google likely embargoed specifics during responsible disclosure.</p>
<p><strong>Why it matters:</strong> Even &quot;secure by design&quot; systems have bugs. Continuous fuzzing finds them before attackers do.</p>
<h2>Deploying gVisor in My Homelab</h2>
<p>I run a 3-node <a href="https://k3s.io/">K3s</a> cluster on Raspberry Pi 5s (16GB each) plus one Pi 4 (8GB). K3s is Kubernetes, stripped down.</p>
<p><strong>Initial attempt:</strong> Deploy gVisor globally.</p>
<p>⚠️ <strong>Warning:</strong> These commands modify system configuration. Only use in controlled lab environments with proper backups.</p>
<pre><code class="language-bash"># Install gVisor runtime
curl -fsSL https://gvisor.dev/archive.key | sudo gpg --dearmor -o /usr/share/keyrings/gvisor-archive-keyring.gpg
echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/gvisor-archive-keyring.gpg] https://storage.googleapis.com/gvisor/releases release main&quot; | sudo tee /etc/apt/sources.list.d/gvisor.list
sudo apt-get update &amp;&amp; sudo apt-get install -y runsc

# Configure containerd
sudo runsc install
sudo systemctl restart containerd
</code></pre>
<p><strong>Result:</strong> First pod wouldn't start. Logs showed blocked syscalls.</p>
<p><strong>Problem:</strong> gVisor implements ~200 syscalls. Linux has 300+. Missing syscalls fail hard.</p>
<p><strong>Solution:</strong> Use gVisor selectively via <a href="https://kubernetes.io/docs/concepts/containers/runtime-class/">RuntimeClass</a>.</p>
<pre><code class="language-yaml"># runtime.yaml
apiVersion: node.k8s.io/v1
kind: RuntimeClass
metadata:
  name: gvisor
handler: runsc
---
# untrusted-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: untrusted-app
spec:
  runtimeClassName: gvisor
  containers:
  - name: app
    image: nginx:latest
</code></pre>
<p><strong>This worked.</strong> Pods using <code>runtimeClassName: gvisor</code> run in gVisor. Everything else uses runc.</p>
<p><strong>Debugging incompatible workloads:</strong></p>
<pre><code class="language-bash"># Check which syscalls a binary uses
strace -c nginx 2&gt;&amp;1 | grep -v &quot;detached&quot; | sort -n

# Compare against gVisor's supported syscalls
runsc debug --all | grep -o 'syscall.*' | sort
</code></pre>
<p>Took 2 hours tracing strace output to find that my custom monitoring sidecar used <code>ptrace()</code>, which gVisor doesn't support. Removed sidecar, monitoring works.</p>
<p><strong>Current setup:</strong></p>
<ul>
<li>12 of 30 pods run on gVisor (untrusted images, internet-facing services)</li>
<li>18 pods run on runc (trusted workloads, performance-sensitive)</li>
<li>Zero compatibility issues after initial debugging</li>
</ul>
<h2>Performance Testing: gVisor vs runc</h2>
<p>I benchmarked container startup, syscall overhead, and I/O performance.</p>
<p><strong>Test environment:</strong></p>
<ul>
<li>Dell R940: 64 cores, 768GB RAM, <a href="https://www.proxmox.com/">Proxmox</a> 8.2</li>
<li>2 identical VMs: Ubuntu 24.04, 8 vCPUs, 16GB RAM</li>
<li>VM1: runc, VM2: gVisor (runsc)</li>
</ul>
<p><strong>Container startup (100 iterations):</strong></p>
<pre><code class="language-bash"># runc
time for i in {1..100}; do docker run --rm alpine:latest echo &quot;test&quot;; done
# Average: 42ms per container

# gVisor
time for i in {1..100}; do docker run --rm --runtime=runsc alpine:latest echo &quot;test&quot;; done
# Average: 67ms per container
</code></pre>
<p><strong>Result:</strong> 59% overhead. Acceptable for untrusted workloads.</p>
<p><strong>Syscall-heavy workload (compile Linux kernel):</strong></p>
<pre><code class="language-bash"># runc
time docker run --rm gcc:latest bash -c &quot;apt-get update &amp;&amp; apt-get install -y bc &amp;&amp; wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.10.1.tar.xz &amp;&amp; tar xf linux-5.10.1.tar.xz &amp;&amp; cd linux-5.10.1 &amp;&amp; make defconfig &amp;&amp; make -j4&quot;
# Time: 8m 32s

# gVisor
time docker run --rm --runtime=runsc gcc:latest bash -c &quot;apt-get update &amp;&amp; apt-get install -y bc &amp;&amp; wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.10.1.tar.xz &amp;&amp; tar xf linux-5.10.1.tar.xz &amp;&amp; cd linux-5.10.1 &amp;&amp; make defconfig &amp;&amp; make -j4&quot;
# Time: 11m 47s
</code></pre>
<p><strong>Result:</strong> 38% overhead. Compile is syscall-heavy (file I/O, fork/exec).</p>
<p><strong>Network throughput (nginx):</strong></p>
<pre><code class="language-bash"># runc
ab -n 100000 -c 100 http://runc-nginx/
# Requests/sec: 12,847

# gVisor
ab -n 100000 -c 100 http://gvisor-nginx/
# Requests/sec: 11,203
</code></pre>
<p><strong>Result:</strong> 13% overhead. Network syscalls (socket, send, recv) cross userspace boundary.</p>
<p><strong>Why it matters:</strong> gVisor adds 15-38% overhead depending on syscall intensity. For security-critical workloads, that's acceptable. For performance-critical workloads, use runc.</p>
<h2>Container Escape Testing</h2>
<p>⚠️ <strong>Warning:</strong> This section demonstrates container escape techniques for educational purposes only. These tests should only be performed in isolated lab environments with proper authorization. Never attempt these techniques on production systems or systems you don't own.</p>
<p>I attempted 5 common container escape techniques.</p>
<p><strong>Test 1: Privileged container with host filesystem mount</strong></p>
<pre><code class="language-bash"># runc (baseline)
docker run --rm --privileged -v /:/host alpine chroot /host /bin/bash
# Result: Full host shell access ✓

# gVisor
docker run --rm --runtime=runsc --privileged -v /:/host alpine chroot /host /bin/bash
# Result: Permission denied ✗
</code></pre>
<p><strong>Why gVisor blocked it:</strong> Even privileged containers can't escape gVisor's Sentry. The <code>--privileged</code> flag disables seccomp/AppArmor but doesn't give direct kernel access.</p>
<p><strong>Test 2: /proc/sys/kernel write (CVE-2022-0492 variant)</strong></p>
<pre><code class="language-bash"># Attempt to modify kernel parameters
docker run --rm --runtime=runsc alpine sh -c &quot;echo 1 &gt; /proc/sys/kernel/core_pattern&quot;
# Result: Read-only file system ✗
</code></pre>
<p><strong>Why gVisor blocked it:</strong> <code>/proc/sys</code> is a read-only overlay. No direct kernel parameter modification.</p>
<p><strong>Test 3: cgroup release_agent exploit</strong></p>
<p>⚠️ <strong>Warning:</strong> This demonstrates a known container escape technique. Only use in isolated lab environments for educational purposes.</p>
<pre><code class="language-bash"># Classic container escape technique
docker run --rm --runtime=runsc alpine sh -c &quot;echo '/payload.sh' &gt; /sys/fs/cgroup/memory/release_agent&quot;
# Result: Operation not permitted ✗
</code></pre>
<p><strong>Why gVisor blocked it:</strong> cgroups are emulated in Sentry. No direct host cgroup manipulation.</p>
<p><strong>Test 4: Docker socket mount</strong></p>
<pre><code class="language-bash"># Mount Docker socket (common misconfiguration)
docker run --rm --runtime=runsc -v /var/run/docker.sock:/var/run/docker.sock docker:latest docker ps
# Result: Works, but limited to gVisor containers
</code></pre>
<p><strong>Surprise:</strong> This works because Docker socket access isn't a kernel exploit, it's an API exploit. gVisor doesn't protect against application-level attacks.</p>
<p><strong>Mitigation:</strong> Don't mount Docker sockets. Use least-privilege service accounts.</p>
<p><strong>Test 5: Dirty Pipe (CVE-2022-0847) attempt</strong></p>
<p>⚠️ <strong>Warning:</strong> This tests a known kernel vulnerability (CVE-2022-0847). Only use in isolated lab environments for educational purposes.</p>
<pre><code class="language-bash"># Attempt to exploit pipe write vulnerability
# (Simplified test, actual exploit is more complex)
docker run --rm --runtime=runsc alpine sh -c &quot;echo 'exploit' | tee /proc/self/mem&quot;
# Result: Operation not permitted ✗
</code></pre>
<p><strong>Why gVisor blocked it:</strong> Userspace kernel doesn't have the vulnerable pipe implementation. Bug doesn't exist in Sentry.</p>
<p><strong>Summary:</strong> gVisor stopped 4 of 5 escapes. The 5th (Docker socket) isn't a kernel exploit, so gVisor's out of scope.</p>
<h2>When to Use gVisor</h2>
<p><strong>Use gVisor for:</strong></p>
<ul>
<li>Untrusted container images (public registries, user-submitted code)</li>
<li>Multi-tenant workloads (SaaS platforms, CI/CD runners)</li>
<li>Internet-facing services (web apps, APIs) - combine with <a href="/posts/2024-07-09-zero-trust-architecture-implementation">zero-trust architecture</a></li>
<li>Compliance requirements (PCI-DSS, HIPAA needing kernel isolation)</li>
</ul>
<p><strong>Don't use gVisor for:</strong></p>
<ul>
<li>Performance-critical workloads (databases, real-time processing)</li>
<li>Syscall-heavy applications (compilers, development tools)</li>
<li>Unsupported syscalls (ptrace, some eBPF programs)</li>
<li>Trusted internal services (monitoring, logging)</li>
</ul>
<p><strong>My decision tree:</strong></p>
<ol>
<li>Is this untrusted? → gVisor</li>
<li>Is this internet-facing? → gVisor</li>
<li>Does it need native performance? → runc</li>
<li>Is it syscall-heavy? → runc</li>
<li>Default: runc (principle of least surprise)</li>
</ol>
<p><strong>Trade-off:</strong> Security vs performance. I choose security for attack surfaces, performance for internal services.</p>
<h2>What I Learned</h2>
<p><strong>gVisor isn't perfect.</strong></p>
<ul>
<li>G-Fuzz found bugs. More exist.</li>
<li>Syscall coverage gaps break some workloads.</li>
<li>Performance overhead ranges 15-38% in my testing.</li>
</ul>
<p><strong>But it's better than alternatives:</strong></p>
<ul>
<li><a href="https://katacontainers.io/">Kata Containers</a>: Heavier (full VMs), slower startup</li>
<li><a href="https://firecracker-microvm.github.io/">Firecracker</a>: AWS-specific, not Kubernetes-native</li>
<li>seccomp-only: Kernel bugs bypass it (see <a href="/posts/2025-07-01-ebpf-security-monitoring-practical-guide">eBPF security monitoring</a> for deeper kernel visibility)</li>
</ul>
<p><strong>The real lesson:</strong> Defense in depth. I use:</p>
<ul>
<li>gVisor for untrusted containers</li>
<li>Network policies to limit lateral movement</li>
<li>Wazuh for syscall monitoring (integrate with <a href="/posts/2025-09-14-threat-intelligence-mitre-attack-dashboard">threat intelligence</a>)</li>
<li>Regular vulnerability scanning (Grype, Trivy) - see <a href="/posts/2025-07-15-vulnerability-management-scale-open-source">vulnerability management at scale</a></li>
</ul>
<p><strong>Container security is layers.</strong> gVisor is one layer. A good one.</p>
<h2>Practical Recommendations</h2>
<p><strong>Start small:</strong></p>
<ol>
<li>Deploy gVisor on one node</li>
<li>Test with non-critical workloads</li>
<li>Profile performance for your use case</li>
<li>Expand gradually</li>
</ol>
<p><strong>Monitor compatibility:</strong></p>
<pre><code class="language-bash"># Check for failed syscalls
kubectl logs &lt;pod&gt; | grep &quot;syscall not supported&quot;

# Enable debug logging
runsc --debug --debug-log=/tmp/runsc.log &lt;container_id&gt;
</code></pre>
<p><strong>Tune for performance:</strong></p>
<ul>
<li>Use <a href="https://opensource.googleblog.com/2023/04/gvisor-improves-performance-with-root-filesystem-overlay.html">overlay filesystem</a> (20% faster I/O in <a href="https://opensource.googleblog.com/2023/04/gvisor-improves-performance-with-root-filesystem-overlay.html">Google's testing</a>)</li>
<li>Enable <a href="https://gvisor.dev/blog/2024/02/01/seccomp/">seccomp optimization</a> (15% overhead reduction per <a href="https://gvisor.dev/blog/2024/02/01/seccomp/">gVisor's research</a>)</li>
<li>Profile your workload with <a href="https://gvisor.dev/docs/architecture_guide/performance/">gVisor's performance guide</a></li>
</ul>
<p><strong>Reality check:</strong> gVisor requires investment. Study syscall traces, understand your workload, measure performance. If you're not willing to debug, stick with runc.</p>
<h2>The Bigger Picture</h2>
<p>G-Fuzz demonstrates that even secure-by-design systems need adversarial testing. gVisor's Go implementation avoids memory corruption, but logic bugs remain.</p>
<p><strong>Continuous fuzzing matters:</strong></p>
<ul>
<li><a href="https://github.com/google/syzkaller">Syzkaller</a> for C kernels</li>
<li><a href="https://arxiv.org/abs/2409.13139">G-Fuzz</a> for Go kernels</li>
<li><a href="https://github.com/kernelslacker/trinity">Trinity</a> for syscall fuzzing</li>
</ul>
<p><strong>Defense ecosystem:</strong></p>
<ul>
<li>gVisor for kernel isolation</li>
<li><a href="https://falco.org/">Falco</a> for runtime detection</li>
<li><a href="https://www.openpolicyagent.org/">Open Policy Agent</a> for admission control</li>
<li><a href="https://github.com/cilium/tetragon">Tetragon</a> for eBPF observability</li>
</ul>
<p><strong>No silver bullet.</strong> Security is understanding your threat model and layering controls.</p>
<h2>References</h2>
<ol>
<li>
<p><strong><a href="https://arxiv.org/abs/2409.13139">G-Fuzz: A Directed Fuzzing Framework for gVisor</a></strong> (2024)</p>
<ul>
<li>J. Zhang et al.</li>
<li><em>IEEE Transactions on Dependable and Secure Computing</em></li>
</ul>
</li>
<li>
<p><strong><a href="https://www.docker.com/blog/docker-security-advisory-multiple-vulnerabilities-in-runc-buildkit-and-moby/">Docker Security Advisory: Multiple Vulnerabilities in runc, BuildKit, and Moby</a></strong> (2024)</p>
<ul>
<li>Docker Inc.</li>
</ul>
</li>
<li>
<p><strong><a href="https://snyk.io/blog/leaky-vessels-docker-runc-container-breakout-vulnerabilities/">Leaky Vessels: Docker and runc Container Breakout Vulnerabilities</a></strong> (2024)</p>
<ul>
<li>Snyk Security Research Team</li>
</ul>
</li>
<li>
<p><strong><a href="https://nvd.nist.gov/vuln/detail/CVE-2024-21626">CVE-2024-21626: runc process.cwd Container Breakout</a></strong> (2024)</p>
<ul>
<li>National Vulnerability Database (NVD)</li>
</ul>
</li>
<li>
<p><strong><a href="https://gvisor.dev/docs/">What is gVisor?</a></strong> (2024)</p>
<ul>
<li>Google Open Source</li>
</ul>
</li>
<li>
<p><strong><a href="https://gvisor.dev/docs/architecture_guide/performance/">gVisor Performance Guide</a></strong> (2024)</p>
<ul>
<li>Google gVisor Documentation</li>
</ul>
</li>
<li>
<p><strong><a href="https://www.usenix.org/system/files/hotcloud19-paper-young.pdf">The True Cost of Containing: A gVisor Case Study</a></strong> (2019)</p>
<ul>
<li>E. Young et al.</li>
<li><em>USENIX HotCloud</em></li>
</ul>
</li>
<li>
<p><strong><a href="https://gvisor.dev/blog/2021/12/02/running-gvisor-in-production-at-scale-in-ant/">Running gVisor in Production at Scale in Ant</a></strong> (2021)</p>
<ul>
<li>Ant Group Engineering Team</li>
</ul>
</li>
<li>
<p><strong><a href="https://gvisor.dev/blog/2024/02/01/seccomp/">Optimizing seccomp Usage in gVisor</a></strong> (2024)</p>
<ul>
<li>Google gVisor Team</li>
</ul>
</li>
<li>
<p><strong><a href="https://opensource.googleblog.com/2023/04/gvisor-improves-performance-with-root-filesystem-overlay.html">gVisor Improves Performance with Root Filesystem Overlay</a></strong> (2023)</p>
<ul>
<li>Google Open Source Blog</li>
</ul>
</li>
<li>
<p><strong><a href="https://kubernetes.io/docs/concepts/containers/runtime-class/">Kubernetes RuntimeClass Documentation</a></strong> (2024)</p>
<ul>
<li>Kubernetes Documentation</li>
</ul>
</li>
<li>
<p><strong><a href="https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html">Container Security Best Practices</a></strong> (2024)</p>
<ul>
<li>OWASP Foundation</li>
</ul>
</li>
</ol>

            </div>
            
            <!-- Related Posts -->
            
            
            
            
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
                
                    
                    
                        
                    
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    
                        
                    
                
            
            
            
            
            <section aria-label="Content section" class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800">
                <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-gray-100">Related Posts</h2>
                <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    
                    
                    <article class="group">
                        <a href="/posts/promsketch-2-100x-faster-prometheus-queries-with-sketch-algorithms/" class="block p-6 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:shadow-md">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 mb-2">
                                PromSketch: 2-100x Faster Prometheus Queries with Sketch Algorithms
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                Deploy PromSketch to optimize slow PromQL queries using sketch-based approximation. Homelab benchmar...
                            </p>
                            <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                                <time datetime="2025-11-19">
                                    November 19, 2025
                                </time>
                                <span>5 min read</span>
                            </div>
                        </a>
                    </article>
                    
                    
                    <article class="group">
                        <a href="/posts/from-claude-in-your-terminal-to-robots-in-your-workshop-the-embodied-ai-revolution/" class="block p-6 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:shadow-md">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 mb-2">
                                From Claude in Your Terminal to Robots in Your Workshop: The Embodied AI Revolution
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                Deploy Vision-Language-Action models for embodied AI robots—integrate physical world interaction wit...
                            </p>
                            <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                                <time datetime="2025-10-13">
                                    October 13, 2025
                                </time>
                                <span>8 min read</span>
                            </div>
                        </a>
                    </article>
                    
                    
                    <article class="group">
                        <a href="/posts/automated-security-scanning-pipeline-with-grype-and-osv/" class="block p-6 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:shadow-md">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 mb-2">
                                Automated Security Scanning Pipeline with Grype and OSV
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                                Build automated security scanning pipelines with Grype, OSV, and Trivy—integrate vulnerability detec...
                            </p>
                            <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                                <time datetime="2025-10-06">
                                    October 6, 2025
                                </time>
                                <span>11 min read</span>
                            </div>
                        </a>
                    </article>
                    
                </div>
            </section>
            
            
            <footer role="contentinfo" aria-label="Site footer" class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-800">
                <div class="flex items-center justify-between">
                    <a href="/posts/" class="inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors duration-200">
                        <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back to all posts
                    </a>
                    
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-500 dark:text-gray-400">Share:</span>
                        
                        <!-- LinkedIn -->
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://williamzujkowski.github.io%2Fposts%2Fsandboxing-untrusted-containers-with-gvisor-lessons-from-g-fuzz-vulnerability-research%2F" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-[#0077b5] dark:hover:text-[#0077b5] transition-colors duration-200"
                           aria-label="Share on LinkedIn">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                            </svg>
                        </a>
                        
                        <!-- Hacker News -->
                        <a href="https://news.ycombinator.com/submitlink?u=https://williamzujkowski.github.io%2Fposts%2Fsandboxing-untrusted-containers-with-gvisor-lessons-from-g-fuzz-vulnerability-research%2F&t=Sandboxing%20Untrusted%20Containers%20with%20gVisor%3A%20Lessons%20from%20G-Fuzz%20Vulnerability%20Research" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-[#ff6600] dark:hover:text-[#ff6600] transition-colors duration-200"
                           aria-label="Share on Hacker News">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M0 0v24h24v-24h-24zm12.8 8.7l2.3-4.3h1.4l-3.1 5.5v3.5h-1.2v-3.5l-3-5.5h1.4l2.2 4.3z"/>
                            </svg>
                        </a>
                        
                        <!-- Reddit -->
                        <a href="https://reddit.com/submit?url=https://williamzujkowski.github.io%2Fposts%2Fsandboxing-untrusted-containers-with-gvisor-lessons-from-g-fuzz-vulnerability-research%2F&title=Sandboxing%20Untrusted%20Containers%20with%20gVisor%3A%20Lessons%20from%20G-Fuzz%20Vulnerability%20Research" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="text-gray-400 hover:text-[#ff4500] dark:hover:text-[#ff4500] transition-colors duration-200"
                           aria-label="Share on Reddit">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 11.779c0-1.459-1.192-2.645-2.657-2.645-.715 0-1.363.286-1.84.746-1.81-1.191-4.259-1.949-6.971-2.046l1.483-4.669 4.016.941-.006.058c0 1.193.975 2.163 2.174 2.163 1.198 0 2.172-.97 2.172-2.163s-.975-2.164-2.172-2.164c-.92 0-1.704.574-2.021 1.379l-4.329-1.015c-.189-.046-.381.063-.44.249l-1.654 5.207c-2.838.034-5.409.798-7.3 2.025-.474-.438-1.103-.712-1.799-.712-1.465 0-2.656 1.187-2.656 2.646 0 .97.533 1.811 1.317 2.271-.052.282-.086.567-.086.857 0 3.911 4.808 7.093 10.719 7.093s10.72-3.182 10.72-7.093c0-.274-.029-.544-.075-.81.832-.447 1.405-1.312 1.405-2.318zm-17.224 1.816c0-.868.71-1.575 1.582-1.575.872 0 1.581.707 1.581 1.575s-.709 1.574-1.581 1.574-1.582-.706-1.582-1.574zm9.061 4.669c-.797.793-2.048 1.179-3.824 1.179l-.013-.003-.013.003c-1.777 0-3.028-.386-3.824-1.179-.145-.144-.145-.379 0-.523.145-.145.381-.145.526 0 .65.647 1.729.961 3.298.961l.013.003.013-.003c1.569 0 2.648-.315 3.298-.962.145-.145.381-.144.526 0 .145.145.145.379 0 .524zm-.189-3.095c-.872 0-1.581-.706-1.581-1.574 0-.868.709-1.575 1.581-1.575s1.581.707 1.581 1.575-.709 1.574-1.581 1.574z"/>
                            </svg>
                        </a>
                        
                        <!-- Copy Link -->
                        <button onclick="copyToClipboard('https://williamzujkowski.github.io/posts/sandboxing-untrusted-containers-with-gvisor-lessons-from-g-fuzz-vulnerability-research/')" 
                                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors duration-200"
                                aria-label="Copy link to clipboard">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </footer>
        </div>
    </div>
</article>

<!-- Blog JavaScript Bundle (reading-progress, table-of-contents) -->
<script src="/assets/js/blog.min.js"></script>

<!-- Collapsible Code Blocks - loaded in base.njk -->
    </main>
    
    <!-- Footer -->
    <footer role="contentinfo" aria-label="Site footer" class="mt-auto border-t border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- About -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">About</h3>
                    <p class="text-gray-600 dark:text-gray-400">
                        Personal website of William Zujkowski, exploring technology and sharing knowledge. All opinions and views expressed are my own and do not reflect those of my employer.
                    </p>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">Quick Links</h3>
                    <ul class="space-y-2"><li><a href="/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Home</a></li>
<li><a href="/about/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">About</a></li>
<li><a href="/posts/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Posts</a></li>
<li><a href="/resources/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Resources</a></li>
<li><a href="/stats/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Stats</a></li>
<li><a href="/uses/" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200">Uses</a></li></ul>
                </div>
                
                <!-- Connect -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 uppercase tracking-wider mb-4">Connect</h3>
                    <div class="flex space-x-4">
                        <a href="https://github.com/williamzujkowski" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200" aria-label="GitHub" rel="noopener noreferrer">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                            </svg>
                        </a>
                        <a href="https://www.linkedin.com/in/williamzujkowski" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200" aria-label="LinkedIn" rel="noopener noreferrer">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                            </svg>
                        </a>
                        <a href="/feed.xml" class="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors duration-200" aria-label="RSS Feed">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M3.429 5.1v2.4c7.248 0 13.114 5.886 13.114 13.142h2.4C18.943 12.18 11.858 5.1 3.429 5.1zm0 4.8v2.4c3.924 0 7.114 3.206 7.114 7.142h2.4c0-5.256-4.276-9.542-9.514-9.542zM6.171 16.386c-.756 0-1.371.615-1.371 1.371 0 .756.615 1.371 1.371 1.371.756 0 1.371-.615 1.371-1.371 0-.756-.615-1.371-1.371-1.371z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-700">
                <p class="text-center text-sm text-gray-600 dark:text-gray-400">
                    &copy; 2025 William Zujkowski. All rights reserved.
                    Built with <a href="https://www.11ty.dev/" class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">Eleventy</a>
                    and <a href="https://tailwindcss.com/" class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300">Tailwind CSS</a>.
                </p>
            </div>
        </div>
    </footer>
    
    <!-- Scripts -->
    <script>
        function toggleDarkMode() {
            const html = document.documentElement;
            const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.theme = 'light';
                if (themeColorMeta) themeColorMeta.content = '#1e40af';
            } else {
                html.classList.add('dark');
                localStorage.theme = 'dark';
                if (themeColorMeta) themeColorMeta.content = '#111827';
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // Show success message
                showToast('Link copied to clipboard!');
            }, function(err) {
                // Fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-999999px";
                textArea.style.top = "-999999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast('Link copied to clipboard!');
                } catch (err) {
                    showToast('Failed to copy link');
                }
                document.body.removeChild(textArea);
            });
        }
        
        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 px-4 py-2 rounded-lg shadow-lg transform transition-all duration-300 translate-y-full';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-y-full');
                toast.classList.add('translate-y-0');
            }, 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.remove('translate-y-0');
                toast.classList.add('translate-y-full');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }
    </script>
    
    <!-- Core JavaScript Bundle (ui-enhancements, back-to-top, code-collapse) -->
    <script src="/assets/js/core.min.js"></script>
    
    <!-- Mermaid Diagram Support -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        // Determine if dark mode is active
        const isDarkMode = document.documentElement.classList.contains('dark');
        
        // Initialize mermaid with proper settings
        mermaid.initialize({ 
            startOnLoad: false, // We'll manually init after DOM manipulation
            theme: isDarkMode ? 'dark' : 'default',
            themeVariables: isDarkMode ? {
                // Dark mode theme
                primaryColor: '#4f46e5',
                primaryTextColor: '#f3f4f6',
                primaryBorderColor: '#6366f1',
                lineColor: '#4b5563',
                secondaryColor: '#374151',
                tertiaryColor: '#1f2937',
                background: '#111827',
                mainBkg: '#1f2937',
                secondBkg: '#374151',
                tertiaryBkg: '#4b5563',
                primaryBorderColor: '#6366f1',
                fontFamily: 'Inter, system-ui, sans-serif',
                fontSize: '16px',
                darkMode: true,
                nodeBkg: '#374151',
                nodeBorder: '#6366f1',
                clusterBkg: '#1f2937',
                clusterBorder: '#4b5563',
                defaultLinkColor: '#93bbfd',
                titleColor: '#f3f4f6',
                edgeLabelBackground: '#1f2937',
                actorBorder: '#6366f1',
                actorBkg: '#374151',
                actorTextColor: '#f3f4f6',
                actorLineColor: '#4b5563',
                signalColor: '#f3f4f6',
                signalTextColor: '#f3f4f6',
                labelBoxBkgColor: '#374151',
                labelBoxBorderColor: '#6366f1',
                labelTextColor: '#f3f4f6',
                loopTextColor: '#f3f4f6',
                noteBorderColor: '#6366f1',
                noteBkgColor: '#374151',
                noteTextColor: '#f3f4f6',
                activationBorderColor: '#6366f1',
                activationBkgColor: '#374151',
                sequenceNumberColor: '#111827'
            } : {
                // Light mode theme
                primaryColor: '#6366f1',
                primaryTextColor: '#fff',
                primaryBorderColor: '#4f46e5',
                lineColor: '#d1d5db',
                secondaryColor: '#e5e7eb',
                tertiaryColor: '#f3f4f6',
                background: '#ffffff',
                mainBkg: '#ffffff',
                secondBkg: '#f3f4f6',
                tertiaryBkg: '#e5e7eb',
                fontFamily: 'Inter, system-ui, sans-serif',
                fontSize: '16px',
                darkMode: false,
                nodeBkg: '#f3f4f6',
                nodeBorder: '#4f46e5',
                clusterBkg: '#e5e7eb',
                clusterBorder: '#9ca3af',
                defaultLinkColor: '#2563eb',
                titleColor: '#1f2937',
                edgeLabelBackground: '#ffffff',
                actorBorder: '#4f46e5',
                actorBkg: '#f3f4f6',
                actorTextColor: '#1f2937',
                actorLineColor: '#9ca3af',
                signalColor: '#1f2937',
                signalTextColor: '#1f2937',
                labelBoxBkgColor: '#f3f4f6',
                labelBoxBorderColor: '#4f46e5',
                labelTextColor: '#1f2937',
                loopTextColor: '#1f2937',
                noteBorderColor: '#4f46e5',
                noteBkgColor: '#f3f4f6',
                noteTextColor: '#1f2937',
                activationBorderColor: '#4f46e5',
                activationBkgColor: '#e5e7eb',
                sequenceNumberColor: '#ffffff'
            },
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
        
        // Process Mermaid diagrams and THEN initialize code-collapse
        window.addEventListener('DOMContentLoaded', async function() {
            // Step 1: Find and process all mermaid code blocks
            const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
            
            if (mermaidBlocks.length > 0) {
                // Processing Mermaid diagrams
                
                // Convert each mermaid code block to a diagram
                for (const element of mermaidBlocks) {
                    const graphDefinition = element.textContent;
                    const preElement = element.parentNode;
                    
                    // Create a container div for the mermaid diagram
                    const containerDiv = document.createElement('div');
                    containerDiv.className = 'mermaid-container';
                    containerDiv.setAttribute('data-mermaid', 'true');
                    
                    // Create the mermaid div
                    const graphDiv = document.createElement('div');
                    graphDiv.className = 'mermaid';
                    graphDiv.textContent = graphDefinition;
                    
                    // Replace the pre element with the container - this removes the code block entirely
                    preElement.parentNode.replaceChild(containerDiv, preElement);
                    containerDiv.appendChild(graphDiv);
                }
                
                // Step 2: Initialize all mermaid diagrams with error handling
                try {
                    await mermaid.run();
                    console.log(`✅ Successfully rendered ${mermaidBlocks.length} Mermaid diagram(s)`);
                } catch (error) {
                    console.error('❌ Mermaid rendering failed:', error);
                    // Log each diagram's content for debugging
                    document.querySelectorAll('.mermaid').forEach((div, index) => {
                        console.error(`Diagram ${index + 1} content:`, div.textContent);
                    });
                }

                // Diagrams are now styled via CSS, no need for inline styles
            }
            
            // Step 3: Code-collapse.js is already loaded and will handle remaining blocks
            // It checks for data-processed attribute to avoid duplicates
        });
    </script>
</body>
</html>